<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 Advanced R, MAUP and more regression | CASA0005 Geographic Information Systems and Science</title>
  <meta name="description" content="The CASA0005 Geographic Information Systems and Science practical book" />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 Advanced R, MAUP and more regression | CASA0005 Geographic Information Systems and Science" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="https://andrewmaclachlan.github.io/CASA0005repo//general_images/casa_logo.png" />
  <meta property="og:description" content="The CASA0005 Geographic Information Systems and Science practical book" />
  <meta name="github-repo" content="andrewmaclachlan/CASA0005repo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 Advanced R, MAUP and more regression | CASA0005 Geographic Information Systems and Science" />
  
  <meta name="twitter:description" content="The CASA0005 Geographic Information Systems and Science practical book" />
  <meta name="twitter:image" content="https://andrewmaclachlan.github.io/CASA0005repo//general_images/casa_logo.png" />

<meta name="author" content="Andy MacLachlan and Adam Dennett" />


<meta name="date" content="2022-06-20" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="assets/apple-touch-icon.png" />
  <link rel="shortcut icon" href="assets/favicon.ico" type="image/x-icon" />
<link rel="prev" href="gwr-and-spatially-lagged-regression.html"/>
<link rel="next" href="assignment-resources-1.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.23/datatables.js"></script>
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
<link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize-0.12.0/selectize.min.js"></script>
<link href="libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>
<script src="libs/plotly-binding-4.10.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.5.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.5.1/plotly-latest.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-151934476-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-151934476-1');
</script>
<script src="assets/book.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="assets/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="toc-logo"><a href="https://www.ucl.ac.uk/module-catalogue/modules/geographic-information-systems-and-science-CASA0005"><img src="general_images/casa_logo.jpg"></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgement"><i class="fa fa-check"></i>Acknowledgement</a></li>
</ul></li>
<li class="part"><span><b>Course information</b></span></li>
<li class="chapter" data-level="" data-path="hello-gis.html"><a href="hello-gis.html"><i class="fa fa-check"></i>Hello GIS</a>
<ul>
<li class="chapter" data-level="" data-path="hello-gis.html"><a href="hello-gis.html#intended-course-learning-outcomes"><i class="fa fa-check"></i>Intended course learning outcomes</a></li>
<li class="chapter" data-level="" data-path="hello-gis.html"><a href="hello-gis.html#how-to-use-this-book"><i class="fa fa-check"></i>How to use this book</a></li>
<li class="chapter" data-level="" data-path="hello-gis.html"><a href="hello-gis.html#getting-started"><i class="fa fa-check"></i>Getting started</a></li>
<li class="chapter" data-level="" data-path="hello-gis.html"><a href="hello-gis.html#how-to-download-data-and-files-from-github"><i class="fa fa-check"></i>How to download data and files from GitHub</a>
<ul>
<li class="chapter" data-level="" data-path="hello-gis.html"><a href="hello-gis.html#option-1"><i class="fa fa-check"></i>Option 1</a></li>
<li class="chapter" data-level="" data-path="hello-gis.html"><a href="hello-gis.html#option-2"><i class="fa fa-check"></i>Option 2</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="hello-gis.html"><a href="hello-gis.html#self-guided-learning"><i class="fa fa-check"></i>Self guided learning</a></li>
<li class="chapter" data-level="" data-path="hello-gis.html"><a href="hello-gis.html#interactive-lectures"><i class="fa fa-check"></i>Interactive lectures</a></li>
<li class="chapter" data-level="" data-path="hello-gis.html"><a href="hello-gis.html#more-help"><i class="fa fa-check"></i>More help</a></li>
<li class="chapter" data-level="" data-path="hello-gis.html"><a href="hello-gis.html#noticed-a-mistake"><i class="fa fa-check"></i>Noticed a mistake?</a></li>
<li class="chapter" data-level="" data-path="hello-gis.html"><a href="hello-gis.html#assignment-resources"><i class="fa fa-check"></i>Assignment resources</a></li>
<li class="chapter" data-level="" data-path="hello-gis.html"><a href="hello-gis.html#reading-list"><i class="fa fa-check"></i>Reading list</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="software-installation.html"><a href="software-installation.html"><i class="fa fa-check"></i>Software installation</a>
<ul>
<li class="chapter" data-level="" data-path="software-installation.html"><a href="software-installation.html#qgis"><i class="fa fa-check"></i>QGIS</a></li>
<li class="chapter" data-level="" data-path="software-installation.html"><a href="software-installation.html#r"><i class="fa fa-check"></i>R</a>
<ul>
<li class="chapter" data-level="" data-path="software-installation.html"><a href="software-installation.html#setup-1"><i class="fa fa-check"></i>Setup 1</a></li>
<li class="chapter" data-level="" data-path="software-installation.html"><a href="software-installation.html#setup-2"><i class="fa fa-check"></i>Setup 2</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="software-installation.html"><a href="software-installation.html#arcgis"><i class="fa fa-check"></i>ArcGIS</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="external-usage.html"><a href="external-usage.html"><i class="fa fa-check"></i>External usage</a>
<ul>
<li class="chapter" data-level="" data-path="external-usage.html"><a href="external-usage.html#how-to-adopt-this-course"><i class="fa fa-check"></i>How to adopt this course</a></li>
<li class="chapter" data-level="" data-path="external-usage.html"><a href="external-usage.html#issues-contributions"><i class="fa fa-check"></i>Issues / contributions</a></li>
<li class="chapter" data-level="" data-path="external-usage.html"><a href="external-usage.html#license"><i class="fa fa-check"></i>License</a></li>
<li class="chapter" data-level="" data-path="external-usage.html"><a href="external-usage.html#version"><i class="fa fa-check"></i>Version</a></li>
<li class="chapter" data-level="" data-path="external-usage.html"><a href="external-usage.html#packages"><i class="fa fa-check"></i>Packages</a></li>
</ul></li>
<li class="part"><span><b>I GIS tools</b></span></li>
<li class="chapter" data-level="1" data-path="geographic-information.html"><a href="geographic-information.html"><i class="fa fa-check"></i><b>1</b> Geographic Information</a>
<ul>
<li class="chapter" data-level="1.1" data-path="geographic-information.html"><a href="geographic-information.html#learning-outcomes"><i class="fa fa-check"></i><b>1.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="1.2" data-path="geographic-information.html"><a href="geographic-information.html#homework"><i class="fa fa-check"></i><b>1.2</b> Homework</a></li>
<li class="chapter" data-level="1.3" data-path="geographic-information.html"><a href="geographic-information.html#recommended-listening"><i class="fa fa-check"></i><b>1.3</b> Recommended listening ðŸŽ§</a></li>
<li class="chapter" data-level="1.4" data-path="geographic-information.html"><a href="geographic-information.html#the-basics-of-geographic-information"><i class="fa fa-check"></i><b>1.4</b> The Basics of Geographic Information</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="geographic-information.html"><a href="geographic-information.html#data-types-in-statistics"><i class="fa fa-check"></i><b>1.4.1</b> Data types in statistics</a></li>
<li class="chapter" data-level="1.4.2" data-path="geographic-information.html"><a href="geographic-information.html#important-gis-data-formats"><i class="fa fa-check"></i><b>1.4.2</b> Important GIS data formats</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="geographic-information.html"><a href="geographic-information.html#general-data-flow"><i class="fa fa-check"></i><b>1.5</b> General data flow</a></li>
<li class="chapter" data-level="1.6" data-path="geographic-information.html"><a href="geographic-information.html#data"><i class="fa fa-check"></i><b>1.6</b> Data</a>
<ul>
<li class="chapter" data-level="1.6.1" data-path="geographic-information.html"><a href="geographic-information.html#file-paths"><i class="fa fa-check"></i><b>1.6.1</b> File paths</a></li>
<li class="chapter" data-level="1.6.2" data-path="geographic-information.html"><a href="geographic-information.html#data-download"><i class="fa fa-check"></i><b>1.6.2</b> Data download</a></li>
<li class="chapter" data-level="1.6.3" data-path="geographic-information.html"><a href="geographic-information.html#data-pre-processing"><i class="fa fa-check"></i><b>1.6.3</b> Data pre-processing</a></li>
<li class="chapter" data-level="1.6.4" data-path="geographic-information.html"><a href="geographic-information.html#qgis-1"><i class="fa fa-check"></i><b>1.6.4</b> QGIS</a></li>
<li class="chapter" data-level="1.6.5" data-path="geographic-information.html"><a href="geographic-information.html#r-1"><i class="fa fa-check"></i><b>1.6.5</b> R</a></li>
<li class="chapter" data-level="1.6.6" data-path="geographic-information.html"><a href="geographic-information.html#export-data-1"><i class="fa fa-check"></i><b>1.6.6</b> Export data</a></li>
<li class="chapter" data-level="1.6.7" data-path="geographic-information.html"><a href="geographic-information.html#what-will-i-use-1"><i class="fa fa-check"></i><b>1.6.7</b> What will I use</a></li>
</ul></li>
<li class="chapter" data-level="1.7" data-path="geographic-information.html"><a href="geographic-information.html#data-sources-and-task"><i class="fa fa-check"></i><b>1.7</b> Data sources and task</a>
<ul>
<li class="chapter" data-level="1.7.1" data-path="geographic-information.html"><a href="geographic-information.html#uk-data-service"><i class="fa fa-check"></i><b>1.7.1</b> UK Data Service</a></li>
<li class="chapter" data-level="1.7.2" data-path="geographic-information.html"><a href="geographic-information.html#ons"><i class="fa fa-check"></i><b>1.7.2</b> ONS</a></li>
<li class="chapter" data-level="1.7.3" data-path="geographic-information.html"><a href="geographic-information.html#nomis"><i class="fa fa-check"></i><b>1.7.3</b> nomis</a></li>
<li class="chapter" data-level="1.7.4" data-path="geographic-information.html"><a href="geographic-information.html#os"><i class="fa fa-check"></i><b>1.7.4</b> OS</a></li>
<li class="chapter" data-level="1.7.5" data-path="geographic-information.html"><a href="geographic-information.html#edina-digimap"><i class="fa fa-check"></i><b>1.7.5</b> Edina Digimap</a></li>
<li class="chapter" data-level="1.7.6" data-path="geographic-information.html"><a href="geographic-information.html#osm"><i class="fa fa-check"></i><b>1.7.6</b> OSM</a></li>
<li class="chapter" data-level="1.7.7" data-path="geographic-information.html"><a href="geographic-information.html#defra"><i class="fa fa-check"></i><b>1.7.7</b> DEFRA</a></li>
<li class="chapter" data-level="1.7.8" data-path="geographic-information.html"><a href="geographic-information.html#data-lists"><i class="fa fa-check"></i><b>1.7.8</b> Data lists</a></li>
</ul></li>
<li class="chapter" data-level="1.8" data-path="geographic-information.html"><a href="geographic-information.html#summary"><i class="fa fa-check"></i><b>1.8</b> Summary</a></li>
<li class="chapter" data-level="1.9" data-path="geographic-information.html"><a href="geographic-information.html#feedback"><i class="fa fa-check"></i><b>1.9</b> Feedback</a></li>
<li class="chapter" data-level="1.10" data-path="geographic-information.html"><a href="geographic-information.html#mac-r-issues"><i class="fa fa-check"></i><b>1.10</b> Mac R issues</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-r.html"><a href="introduction-to-r.html"><i class="fa fa-check"></i><b>2</b> Introduction to R</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#learning-outcomes-1"><i class="fa fa-check"></i><b>2.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="2.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#homework-1"><i class="fa fa-check"></i><b>2.2</b> Homework</a></li>
<li class="chapter" data-level="2.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#recommended-listening-1"><i class="fa fa-check"></i><b>2.3</b> Recommended listening ðŸŽ§</a></li>
<li class="chapter" data-level="2.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#introduction-1"><i class="fa fa-check"></i><b>2.4</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#online-forums-are-your-friend"><i class="fa fa-check"></i><b>2.4.1</b> Online forums are your friend!!</a></li>
<li class="chapter" data-level="2.4.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#health-warning"><i class="fa fa-check"></i><b>2.4.2</b> Health warning</a></li>
<li class="chapter" data-level="2.4.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#r-and-rstudio"><i class="fa fa-check"></i><b>2.4.3</b> R and RStudio</a></li>
<li class="chapter" data-level="2.4.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#getting-started-1"><i class="fa fa-check"></i><b>2.4.4</b> Getting started</a></li>
<li class="chapter" data-level="2.4.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#basics"><i class="fa fa-check"></i><b>2.4.5</b> Basics</a></li>
<li class="chapter" data-level="2.4.6" data-path="introduction-to-r.html"><a href="introduction-to-r.html#scripts-and-some-basic-commands"><i class="fa fa-check"></i><b>2.4.6</b> Scripts and some basic commands</a></li>
<li class="chapter" data-level="2.4.7" data-path="introduction-to-r.html"><a href="introduction-to-r.html#functions"><i class="fa fa-check"></i><b>2.4.7</b> Functions</a></li>
<li class="chapter" data-level="2.4.8" data-path="introduction-to-r.html"><a href="introduction-to-r.html#basic-plotting"><i class="fa fa-check"></i><b>2.4.8</b> Basic plotting</a></li>
<li class="chapter" data-level="2.4.9" data-path="introduction-to-r.html"><a href="introduction-to-r.html#help"><i class="fa fa-check"></i><b>2.4.9</b> Help</a></li>
<li class="chapter" data-level="2.4.10" data-path="introduction-to-r.html"><a href="introduction-to-r.html#data-structures"><i class="fa fa-check"></i><b>2.4.10</b> Data structures</a></li>
<li class="chapter" data-level="2.4.11" data-path="introduction-to-r.html"><a href="introduction-to-r.html#elements-of-a-data-frame"><i class="fa fa-check"></i><b>2.4.11</b> Elements of a data frame</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#reading-data-into-r"><i class="fa fa-check"></i><b>2.5</b> Reading data into R</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="introduction-to-r.html"><a href="introduction-to-r.html#old-skool-cleaning"><i class="fa fa-check"></i><b>2.5.1</b> Old skool cleaning</a></li>
<li class="chapter" data-level="2.5.2" data-path="introduction-to-r.html"><a href="introduction-to-r.html#here"><i class="fa fa-check"></i><b>2.5.2</b> Here</a></li>
<li class="chapter" data-level="2.5.3" data-path="introduction-to-r.html"><a href="introduction-to-r.html#new-skool-cleaning"><i class="fa fa-check"></i><b>2.5.3</b> New skool cleaning</a></li>
<li class="chapter" data-level="2.5.4" data-path="introduction-to-r.html"><a href="introduction-to-r.html#examining-your-new-data"><i class="fa fa-check"></i><b>2.5.4</b> Examining your new data</a></li>
<li class="chapter" data-level="2.5.5" data-path="introduction-to-r.html"><a href="introduction-to-r.html#data-manipulation-in-r"><i class="fa fa-check"></i><b>2.5.5</b> Data manipulation in R</a></li>
<li class="chapter" data-level="2.5.6" data-path="introduction-to-r.html"><a href="introduction-to-r.html#plotting"><i class="fa fa-check"></i><b>2.5.6</b> Plotting</a></li>
<li class="chapter" data-level="2.5.7" data-path="introduction-to-r.html"><a href="introduction-to-r.html#pimp-my-graph"><i class="fa fa-check"></i><b>2.5.7</b> Pimp my graph!</a></li>
<li class="chapter" data-level="2.5.8" data-path="introduction-to-r.html"><a href="introduction-to-r.html#spatial-data-in-r"><i class="fa fa-check"></i><b>2.5.8</b> Spatial Data in R</a></li>
<li class="chapter" data-level="2.5.9" data-path="introduction-to-r.html"><a href="introduction-to-r.html#simple-mapping"><i class="fa fa-check"></i><b>2.5.9</b> Simple mapping</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="introduction-to-r.html"><a href="introduction-to-r.html#tidying-data"><i class="fa fa-check"></i><b>2.6</b> Tidying data</a></li>
<li class="chapter" data-level="2.7" data-path="introduction-to-r.html"><a href="introduction-to-r.html#feedback-1"><i class="fa fa-check"></i><b>2.7</b> Feedback</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html"><i class="fa fa-check"></i><b>3</b> Rasters, descriptive statistics and interpolation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#learning-outcomes-2"><i class="fa fa-check"></i><b>3.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="3.2" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#homework-2"><i class="fa fa-check"></i><b>3.2</b> Homework</a></li>
<li class="chapter" data-level="3.3" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#recommended-listening-2"><i class="fa fa-check"></i><b>3.3</b> Recommended listening ðŸŽ§</a></li>
<li class="chapter" data-level="3.4" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#introduction-2"><i class="fa fa-check"></i><b>3.4</b> Introduction</a></li>
<li class="chapter" data-level="3.5" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#part-1-projections"><i class="fa fa-check"></i><b>3.5</b> Part 1 projections</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#changing-projections"><i class="fa fa-check"></i><b>3.5.1</b> Changing projections</a></li>
<li class="chapter" data-level="3.5.2" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#worldclim-data"><i class="fa fa-check"></i><b>3.5.2</b> WorldClim data</a></li>
<li class="chapter" data-level="3.5.3" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#worldclim-data-loading-efficiently"><i class="fa fa-check"></i><b>3.5.3</b> WorldClim data loading efficiently</a></li>
<li class="chapter" data-level="3.5.4" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#location-data-from-a-raster"><i class="fa fa-check"></i><b>3.5.4</b> Location data from a raster</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#part-2-descriptive-statistics"><i class="fa fa-check"></i><b>3.6</b> Part 2 descriptive statistics</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#data-preparation"><i class="fa fa-check"></i><b>3.6.1</b> Data preparation</a></li>
<li class="chapter" data-level="3.6.2" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#histogram"><i class="fa fa-check"></i><b>3.6.2</b> Histogram</a></li>
<li class="chapter" data-level="3.6.3" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#using-more-data"><i class="fa fa-check"></i><b>3.6.3</b> Using more data</a></li>
<li class="chapter" data-level="3.6.4" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#histogram-with-ggplot"><i class="fa fa-check"></i><b>3.6.4</b> Histogram with ggplot</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#part-3-interpolation"><i class="fa fa-check"></i><b>3.7</b> Part 3 interpolation</a></li>
<li class="chapter" data-level="3.8" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#auto-data-download"><i class="fa fa-check"></i><b>3.8</b> Auto data download</a></li>
<li class="chapter" data-level="3.9" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#advanced-analysis"><i class="fa fa-check"></i><b>3.9</b> Advanced analysis</a></li>
<li class="chapter" data-level="3.10" data-path="rasters-descriptive-statistics-and-interpolation.html"><a href="rasters-descriptive-statistics-and-interpolation.html#feedback-2"><i class="fa fa-check"></i><b>3.10</b> Feedback</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html"><i class="fa fa-check"></i><b>4</b> Git, GitHub and RMarkdown</a>
<ul>
<li class="chapter" data-level="4.1" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#learning-outcomes-3"><i class="fa fa-check"></i><b>4.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="4.2" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#homework-3"><i class="fa fa-check"></i><b>4.2</b> Homework</a></li>
<li class="chapter" data-level="4.3" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#recommended-listening-3"><i class="fa fa-check"></i><b>4.3</b> Recommended listening ðŸŽ§</a></li>
<li class="chapter" data-level="4.4" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#introduction-3"><i class="fa fa-check"></i><b>4.4</b> Introduction</a></li>
<li class="chapter" data-level="4.5" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#git-and-github"><i class="fa fa-check"></i><b>4.5</b> Git and GitHub</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#the-three-ways"><i class="fa fa-check"></i><b>4.5.1</b> The three ways</a></li>
<li class="chapter" data-level="4.5.2" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#set-up-your-github"><i class="fa fa-check"></i><b>4.5.2</b> Set up your GitHub</a></li>
<li class="chapter" data-level="4.5.3" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#using-rstudio-with-git"><i class="fa fa-check"></i><b>4.5.3</b> Using RStudio with Git</a></li>
<li class="chapter" data-level="4.5.4" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#using-the-git-gui---way-1"><i class="fa fa-check"></i><b>4.5.4</b> Using the Git GUI - way 1</a></li>
<li class="chapter" data-level="4.5.5" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#create-a-new-version-control-in-rstudio---way-2"><i class="fa fa-check"></i><b>4.5.5</b> Create a new version control in RStudio - way 2</a></li>
<li class="chapter" data-level="4.5.6" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#if-have-have-an-existing-project---way-3"><i class="fa fa-check"></i><b>4.5.6</b> If have have an existing project - way 3</a></li>
<li class="chapter" data-level="4.5.7" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#commiting-to-git"><i class="fa fa-check"></i><b>4.5.7</b> Commiting to Git</a></li>
<li class="chapter" data-level="4.5.8" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#using-git-outside-rstudio"><i class="fa fa-check"></i><b>4.5.8</b> Using Git outside RStudio</a></li>
<li class="chapter" data-level="4.5.9" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#push-to-github"><i class="fa fa-check"></i><b>4.5.9</b> Push to Github</a></li>
<li class="chapter" data-level="4.5.10" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#pull-from-github"><i class="fa fa-check"></i><b>4.5.10</b> Pull from GitHub</a></li>
<li class="chapter" data-level="4.5.11" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#troubleshooting"><i class="fa fa-check"></i><b>4.5.11</b> Troubleshooting</a></li>
<li class="chapter" data-level="4.5.12" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#fork-a-repository"><i class="fa fa-check"></i><b>4.5.12</b> Fork a repository</a></li>
<li class="chapter" data-level="4.5.13" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#branches"><i class="fa fa-check"></i><b>4.5.13</b> Branches</a></li>
<li class="chapter" data-level="4.5.14" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#back-in-time"><i class="fa fa-check"></i><b>4.5.14</b> Back in time</a></li>
<li class="chapter" data-level="4.5.15" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#health-warning-1"><i class="fa fa-check"></i><b>4.5.15</b> Health warning</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#rmarkdown"><i class="fa fa-check"></i><b>4.6</b> RMarkdown</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#html"><i class="fa fa-check"></i><b>4.6.1</b> HTML</a></li>
<li class="chapter" data-level="4.6.2" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#flexdashboard"><i class="fa fa-check"></i><b>4.6.2</b> Flexdashboard</a></li>
<li class="chapter" data-level="4.6.3" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#word-document"><i class="fa fa-check"></i><b>4.6.3</b> Word document</a></li>
<li class="chapter" data-level="4.6.4" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#knit-options"><i class="fa fa-check"></i><b>4.6.4</b> Knit options</a></li>
<li class="chapter" data-level="4.6.5" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#shortcuts"><i class="fa fa-check"></i><b>4.6.5</b> Shortcuts</a></li>
<li class="chapter" data-level="4.6.6" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#adding-references"><i class="fa fa-check"></i><b>4.6.6</b> Adding references</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#binder"><i class="fa fa-check"></i><b>4.7</b> Binder</a></li>
<li class="chapter" data-level="4.8" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#further-reading"><i class="fa fa-check"></i><b>4.8</b> Further reading</a></li>
<li class="chapter" data-level="4.9" data-path="git-github-and-rmarkdown.html"><a href="git-github-and-rmarkdown.html#feedback-3"><i class="fa fa-check"></i><b>4.9</b> Feedback</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="map-making.html"><a href="map-making.html"><i class="fa fa-check"></i><b>5</b> Map making</a>
<ul>
<li class="chapter" data-level="5.1" data-path="map-making.html"><a href="map-making.html#learning-outcomes-4"><i class="fa fa-check"></i><b>5.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="5.2" data-path="map-making.html"><a href="map-making.html#homework-4"><i class="fa fa-check"></i><b>5.2</b> Homework</a></li>
<li class="chapter" data-level="5.3" data-path="map-making.html"><a href="map-making.html#recommended-listening-4"><i class="fa fa-check"></i><b>5.3</b> Recommended listening ðŸŽ§</a></li>
<li class="chapter" data-level="5.4" data-path="map-making.html"><a href="map-making.html#introduction-4"><i class="fa fa-check"></i><b>5.4</b> Introduction</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="map-making.html"><a href="map-making.html#osm-1"><i class="fa fa-check"></i><b>5.4.1</b> OSM</a></li>
<li class="chapter" data-level="5.4.2" data-path="map-making.html"><a href="map-making.html#airbnb"><i class="fa fa-check"></i><b>5.4.2</b> Airbnb</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="map-making.html"><a href="map-making.html#data-1"><i class="fa fa-check"></i><b>5.5</b> Data</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="map-making.html"><a href="map-making.html#osm-2"><i class="fa fa-check"></i><b>5.5.1</b> OSM</a></li>
<li class="chapter" data-level="5.5.2" data-path="map-making.html"><a href="map-making.html#london-boroughs"><i class="fa fa-check"></i><b>5.5.2</b> London boroughs</a></li>
<li class="chapter" data-level="5.5.3" data-path="map-making.html"><a href="map-making.html#world-cities"><i class="fa fa-check"></i><b>5.5.3</b> World cities</a></li>
<li class="chapter" data-level="5.5.4" data-path="map-making.html"><a href="map-making.html#airbnb-1"><i class="fa fa-check"></i><b>5.5.4</b> Airbnb</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="map-making.html"><a href="map-making.html#qgis-2"><i class="fa fa-check"></i><b>5.6</b> QGIS</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="map-making.html"><a href="map-making.html#load-data-2"><i class="fa fa-check"></i><b>5.6.1</b> Load data</a></li>
<li class="chapter" data-level="5.6.2" data-path="map-making.html"><a href="map-making.html#manipulate-data"><i class="fa fa-check"></i><b>5.6.2</b> Manipulate data</a></li>
<li class="chapter" data-level="5.6.3" data-path="map-making.html"><a href="map-making.html#map-data"><i class="fa fa-check"></i><b>5.6.3</b> Map data</a></li>
<li class="chapter" data-level="5.6.4" data-path="map-making.html"><a href="map-making.html#export-map"><i class="fa fa-check"></i><b>5.6.4</b> Export map</a></li>
<li class="chapter" data-level="5.6.5" data-path="map-making.html"><a href="map-making.html#graphical-modeler"><i class="fa fa-check"></i><b>5.6.5</b> Graphical modeler</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="map-making.html"><a href="map-making.html#r-2"><i class="fa fa-check"></i><b>5.7</b> R</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="map-making.html"><a href="map-making.html#static-map"><i class="fa fa-check"></i><b>5.7.1</b> Static map</a></li>
<li class="chapter" data-level="5.7.2" data-path="map-making.html"><a href="map-making.html#inset-map"><i class="fa fa-check"></i><b>5.7.2</b> Inset map</a></li>
<li class="chapter" data-level="5.7.3" data-path="map-making.html"><a href="map-making.html#basic-interactive-map"><i class="fa fa-check"></i><b>5.7.3</b> Basic interactive map</a></li>
<li class="chapter" data-level="5.7.4" data-path="map-making.html"><a href="map-making.html#advanced-interactive-map"><i class="fa fa-check"></i><b>5.7.4</b> Advanced interactive map</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="map-making.html"><a href="map-making.html#bad-maps"><i class="fa fa-check"></i><b>5.8</b> Bad maps</a></li>
<li class="chapter" data-level="5.9" data-path="map-making.html"><a href="map-making.html#feedback-4"><i class="fa fa-check"></i><b>5.9</b> Feedback</a></li>
</ul></li>
<li class="part"><span><b>II GIS analysis</b></span></li>
<li class="chapter" data-level="6" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html"><i class="fa fa-check"></i><b>6</b> Analysing spatial patterns</a>
<ul>
<li class="chapter" data-level="6.1" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#learning-outcomes-5"><i class="fa fa-check"></i><b>6.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="6.2" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#homework-5"><i class="fa fa-check"></i><b>6.2</b> Homework</a></li>
<li class="chapter" data-level="6.3" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#recommended-listening-5"><i class="fa fa-check"></i><b>6.3</b> Recommended listening ðŸŽ§</a></li>
<li class="chapter" data-level="6.4" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#introduction-5"><i class="fa fa-check"></i><b>6.4</b> Introduction</a></li>
<li class="chapter" data-level="6.5" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#setting-up-your-data"><i class="fa fa-check"></i><b>6.5</b> Setting up your data</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#data-cleaning"><i class="fa fa-check"></i><b>6.5.1</b> Data cleaning</a></li>
<li class="chapter" data-level="6.5.2" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#study-area"><i class="fa fa-check"></i><b>6.5.2</b> Study area</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#point-pattern-analysis"><i class="fa fa-check"></i><b>6.6</b> Point pattern analysis</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#kernel-density-estimation"><i class="fa fa-check"></i><b>6.6.1</b> Kernel Density Estimation</a></li>
<li class="chapter" data-level="6.6.2" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#quadrat-analysis"><i class="fa fa-check"></i><b>6.6.2</b> Quadrat Analysis</a></li>
<li class="chapter" data-level="6.6.3" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#try-experimenting"><i class="fa fa-check"></i><b>6.6.3</b> Try experimentingâ€¦</a></li>
<li class="chapter" data-level="6.6.4" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#ripleys-k"><i class="fa fa-check"></i><b>6.6.4</b> Ripleyâ€™s K</a></li>
<li class="chapter" data-level="6.6.5" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#alternatives-to-ripleys-k"><i class="fa fa-check"></i><b>6.6.5</b> Alternatives to Ripleyâ€™s K</a></li>
</ul></li>
<li class="chapter" data-level="6.7" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#density-based-spatial-clustering-of-applications-with-noise-dbscan"><i class="fa fa-check"></i><b>6.7</b> Density-based spatial clustering of applications with noise: DBSCAN</a></li>
<li class="chapter" data-level="6.8" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#point-pattern-analysis-summary"><i class="fa fa-check"></i><b>6.8</b> Point pattern analysis summary</a></li>
<li class="chapter" data-level="6.9" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#analysing-spatial-autocorrelation-with-morans-i-lisa-and-friends"><i class="fa fa-check"></i><b>6.9</b> Analysing Spatial Autocorrelation with Moranâ€™s I, LISA and friends</a>
<ul>
<li class="chapter" data-level="6.9.1" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#data-download-1"><i class="fa fa-check"></i><b>6.9.1</b> Data download</a></li>
<li class="chapter" data-level="6.9.2" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#data-cleaning-1"><i class="fa fa-check"></i><b>6.9.2</b> Data cleaning</a></li>
<li class="chapter" data-level="6.9.3" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#data-manipulation"><i class="fa fa-check"></i><b>6.9.3</b> Data manipulation</a></li>
<li class="chapter" data-level="6.9.4" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#spatial-autocorrelation"><i class="fa fa-check"></i><b>6.9.4</b> Spatial autocorrelation</a></li>
<li class="chapter" data-level="6.9.5" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#mapping-outputs"><i class="fa fa-check"></i><b>6.9.5</b> Mapping outputs</a></li>
<li class="chapter" data-level="6.9.6" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#other-variables"><i class="fa fa-check"></i><b>6.9.6</b> Other variables</a></li>
</ul></li>
<li class="chapter" data-level="6.10" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#extension"><i class="fa fa-check"></i><b>6.10</b> Extension</a></li>
<li class="chapter" data-level="6.11" data-path="analysing-spatial-patterns.html"><a href="analysing-spatial-patterns.html#feedback-5"><i class="fa fa-check"></i><b>6.11</b> Feedback</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html"><i class="fa fa-check"></i><b>7</b> Advanced raster analysis</a>
<ul>
<li class="chapter" data-level="7.1" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#learning-objectives"><i class="fa fa-check"></i><b>7.1</b> Learning objectives</a></li>
<li class="chapter" data-level="7.2" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#homework-6"><i class="fa fa-check"></i><b>7.2</b> Homework</a></li>
<li class="chapter" data-level="7.3" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#recommended-listening-6"><i class="fa fa-check"></i><b>7.3</b> Recommended listening ðŸŽ§</a></li>
<li class="chapter" data-level="7.4" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#introduction-6"><i class="fa fa-check"></i><b>7.4</b> Introduction</a></li>
<li class="chapter" data-level="7.5" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#gitignore"><i class="fa fa-check"></i><b>7.5</b> .gitignore</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#remote-sensing-background-required"><i class="fa fa-check"></i><b>7.5.1</b> Remote sensing background (required)</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#data-2"><i class="fa fa-check"></i><b>7.6</b> Data</a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#shapefile"><i class="fa fa-check"></i><b>7.6.1</b> Shapefile</a></li>
<li class="chapter" data-level="7.6.2" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#raster-data-landsat"><i class="fa fa-check"></i><b>7.6.2</b> Raster data (Landsat)</a></li>
</ul></li>
<li class="chapter" data-level="7.7" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#processing-raster-data"><i class="fa fa-check"></i><b>7.7</b> Processing raster data</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#loading"><i class="fa fa-check"></i><b>7.7.1</b> Loading</a></li>
<li class="chapter" data-level="7.7.2" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#resampling"><i class="fa fa-check"></i><b>7.7.2</b> Resampling</a></li>
<li class="chapter" data-level="7.7.3" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#clipping"><i class="fa fa-check"></i><b>7.7.3</b> Clipping</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#data-exploration"><i class="fa fa-check"></i><b>7.8</b> Data exploration</a>
<ul>
<li class="chapter" data-level="7.8.1" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#more-loading-and-manipulating"><i class="fa fa-check"></i><b>7.8.1</b> More loading and manipulating</a></li>
<li class="chapter" data-level="7.8.2" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#plotting-data"><i class="fa fa-check"></i><b>7.8.2</b> Plotting data</a></li>
<li class="chapter" data-level="7.8.3" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#data-similarity"><i class="fa fa-check"></i><b>7.8.3</b> Data similarity</a></li>
</ul></li>
<li class="chapter" data-level="7.9" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#basic-raster-calculations"><i class="fa fa-check"></i><b>7.9</b> Basic raster calculations</a>
<ul>
<li class="chapter" data-level="7.9.1" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#ndvi"><i class="fa fa-check"></i><b>7.9.1</b> NDVI</a></li>
<li class="chapter" data-level="7.9.2" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#ndvi-function"><i class="fa fa-check"></i><b>7.9.2</b> NDVI function</a></li>
</ul></li>
<li class="chapter" data-level="7.10" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#advanced-raster-calculations"><i class="fa fa-check"></i><b>7.10</b> Advanced raster calculations</a>
<ul>
<li class="chapter" data-level="7.10.1" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#calucating-tempearture-from-landsat-data"><i class="fa fa-check"></i><b>7.10.1</b> Calucating tempearture from Landsat data</a></li>
</ul></li>
<li class="chapter" data-level="7.11" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#calucating-urban-area-from-landsat-data"><i class="fa fa-check"></i><b>7.11</b> Calucating urban area from Landsat data</a></li>
<li class="chapter" data-level="7.12" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#urban-area-and-temperature-relationship"><i class="fa fa-check"></i><b>7.12</b> Urban area and temperature relationship</a></li>
<li class="chapter" data-level="7.13" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#statistical-summary"><i class="fa fa-check"></i><b>7.13</b> Statistical summary</a></li>
<li class="chapter" data-level="7.14" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#considerations"><i class="fa fa-check"></i><b>7.14</b> Considerations</a></li>
<li class="chapter" data-level="7.15" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#extension-1"><i class="fa fa-check"></i><b>7.15</b> Extension</a></li>
<li class="chapter" data-level="7.16" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#references"><i class="fa fa-check"></i><b>7.16</b> References</a></li>
<li class="chapter" data-level="7.17" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#remote-sensing-background-optional"><i class="fa fa-check"></i><b>7.17</b> Remote sensing background (optional)</a></li>
<li class="chapter" data-level="7.18" data-path="advanced-raster-analysis.html"><a href="advanced-raster-analysis.html#feedback-6"><i class="fa fa-check"></i><b>7.18</b> Feedback</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html"><i class="fa fa-check"></i><b>8</b> Online mapping / descriptive statistics</a>
<ul>
<li class="chapter" data-level="8.1" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#homework-7"><i class="fa fa-check"></i><b>8.1</b> Homework</a></li>
<li class="chapter" data-level="8.2" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#recommended-listening-7"><i class="fa fa-check"></i><b>8.2</b> Recommended listening ðŸŽ§</a></li>
<li class="chapter" data-level="8.3" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#part-a-spatial-descriptive-statistics"><i class="fa fa-check"></i><b>8.3</b> Part A spatial descriptive statistics</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#learning-objectives-1"><i class="fa fa-check"></i><b>8.3.1</b> Learning objectives</a></li>
<li class="chapter" data-level="8.3.2" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#getting-started-2"><i class="fa fa-check"></i><b>8.3.2</b> Getting Started</a></li>
<li class="chapter" data-level="8.3.3" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#main-tasks"><i class="fa fa-check"></i><b>8.3.3</b> Main Tasks</a></li>
<li class="chapter" data-level="8.3.4" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#task-1---descriptive-statistics"><i class="fa fa-check"></i><b>8.3.4</b> Task 1 - Descriptive Statistics</a></li>
<li class="chapter" data-level="8.3.5" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#extension-1-1"><i class="fa fa-check"></i><b>8.3.5</b> Extension 1</a></li>
<li class="chapter" data-level="8.3.6" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#task-2---function-to-recode-data"><i class="fa fa-check"></i><b>8.3.6</b> Task 2 - Function to recode data</a></li>
<li class="chapter" data-level="8.3.7" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#whats-going-on-in-this-function"><i class="fa fa-check"></i><b>8.3.7</b> Whatâ€™s going on in this function?</a></li>
<li class="chapter" data-level="8.3.8" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#task-3-mapping-location-quotients"><i class="fa fa-check"></i><b>8.3.8</b> Task 3 â€“ Mapping Location Quotients</a></li>
<li class="chapter" data-level="8.3.9" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#task-4-creating-a-basic-geodemographic-classification"><i class="fa fa-check"></i><b>8.3.9</b> Task 4 â€“ Creating a Basic Geodemographic Classification</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#part-b-online-mapping"><i class="fa fa-check"></i><b>8.4</b> Part B Online mapping</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#learning-objectives-2"><i class="fa fa-check"></i><b>8.4.1</b> Learning objectives</a></li>
<li class="chapter" data-level="8.4.2" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#introduction-7"><i class="fa fa-check"></i><b>8.4.2</b> Introduction</a></li>
<li class="chapter" data-level="8.4.3" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#rpubs"><i class="fa fa-check"></i><b>8.4.3</b> RPubs</a></li>
<li class="chapter" data-level="8.4.4" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#rmarkdown-site-generator"><i class="fa fa-check"></i><b>8.4.4</b> RMarkdown site generator</a></li>
<li class="chapter" data-level="8.4.5" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#warning"><i class="fa fa-check"></i><b>8.4.5</b> Warning</a></li>
<li class="chapter" data-level="8.4.6" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#advanced-online-publishing"><i class="fa fa-check"></i><b>8.4.6</b> Advanced online publishing</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="online-mapping-descriptive-statistics.html"><a href="online-mapping-descriptive-statistics.html#feedback-7"><i class="fa fa-check"></i><b>8.5</b> Feedback</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html"><i class="fa fa-check"></i><b>9</b> GWR and spatially lagged regression</a>
<ul>
<li class="chapter" data-level="9.1" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#learning-objectives-3"><i class="fa fa-check"></i><b>9.1</b> Learning objectives</a></li>
<li class="chapter" data-level="9.2" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#homework-8"><i class="fa fa-check"></i><b>9.2</b> Homework</a></li>
<li class="chapter" data-level="9.3" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#recommended-listening-8"><i class="fa fa-check"></i><b>9.3</b> Recommended listening ðŸŽ§</a></li>
<li class="chapter" data-level="9.4" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#introduction-8"><i class="fa fa-check"></i><b>9.4</b> Introduction</a>
<ul>
<li class="chapter" data-level="9.4.1" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#setting-up-your-data-1"><i class="fa fa-check"></i><b>9.4.1</b> Setting up your Data</a></li>
</ul></li>
<li class="chapter" data-level="9.5" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#analysing-gcse-exam-performance---testing-a-research-hypothesis"><i class="fa fa-check"></i><b>9.5</b> Analysing GCSE exam performance - testing a research hypothesis</a>
<ul>
<li class="chapter" data-level="9.5.1" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#research-question-and-hypothesis"><i class="fa fa-check"></i><b>9.5.1</b> Research Question and Hypothesis</a></li>
<li class="chapter" data-level="9.5.2" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#regression-basics"><i class="fa fa-check"></i><b>9.5.2</b> Regression Basics</a></li>
<li class="chapter" data-level="9.5.3" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#running-a-regression-model-in-r"><i class="fa fa-check"></i><b>9.5.3</b> Running a Regression Model in R</a></li>
<li class="chapter" data-level="9.5.4" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#bootstrap-resampling"><i class="fa fa-check"></i><b>9.5.4</b> Bootstrap resampling</a></li>
<li class="chapter" data-level="9.5.5" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#assumptions-underpinning-linear-regression"><i class="fa fa-check"></i><b>9.5.5</b> Assumptions Underpinning Linear Regression</a></li>
<li class="chapter" data-level="9.5.6" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#assumption-1---there-is-a-linear-relationship-between-the-dependent-and-independent-variables"><i class="fa fa-check"></i><b>9.5.6</b> Assumption 1 - There is a linear relationship between the dependent and independent variables</a></li>
<li class="chapter" data-level="9.5.7" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#assumption-2---the-residuals-in-your-model-should-be-normally-distributed"><i class="fa fa-check"></i><b>9.5.7</b> Assumption 2 - The residuals in your model should be normally distributed</a></li>
<li class="chapter" data-level="9.5.8" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#assumption-3---no-multicolinearity-in-the-independent-variables"><i class="fa fa-check"></i><b>9.5.8</b> Assumption 3 - No Multicolinearity in the independent variables</a></li>
<li class="chapter" data-level="9.5.9" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#assumption-4---homoscedasticity"><i class="fa fa-check"></i><b>9.5.9</b> Assumption 4 - Homoscedasticity</a></li>
<li class="chapter" data-level="9.5.10" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#assumption-5---independence-of-errors"><i class="fa fa-check"></i><b>9.5.10</b> Assumption 5 - Independence of Errors</a></li>
</ul></li>
<li class="chapter" data-level="9.6" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#spatial-regression-models"><i class="fa fa-check"></i><b>9.6</b> Spatial Regression Models</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#dealing-with-spatially-autocorrelated-residuals---spatial-lag-and-spatial-error-models"><i class="fa fa-check"></i><b>9.6.1</b> Dealing with Spatially Autocorrelated Residuals - Spatial Lag and Spatial Error models</a></li>
<li class="chapter" data-level="9.6.2" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#spatial-regression-model-in-r"><i class="fa fa-check"></i><b>9.6.2</b> Spatial regression model in R</a></li>
<li class="chapter" data-level="9.6.3" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#extending-your-regression-model---dummy-variables"><i class="fa fa-check"></i><b>9.6.3</b> Extending your regression model - Dummy Variables</a></li>
<li class="chapter" data-level="9.6.4" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#task-investigating-further---adding-more-explanatory-variables-into-a-multiple-regression-model"><i class="fa fa-check"></i><b>9.6.4</b> TASK: Investigating Further - Adding More Explanatory Variables into a multiple regression model</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#task-3---spatial-non-stationarity-and-geographically-weighted-regression-models-gwr"><i class="fa fa-check"></i><b>9.7</b> Task 3 - Spatial Non-stationarity and Geographically Weighted Regression Models (GWR)</a></li>
<li class="chapter" data-level="9.8" data-path="gwr-and-spatially-lagged-regression.html"><a href="gwr-and-spatially-lagged-regression.html#feedback-8"><i class="fa fa-check"></i><b>9.8</b> Feedback</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html"><i class="fa fa-check"></i><b>10</b> Advanced R, MAUP and more regression</a>
<ul>
<li class="chapter" data-level="10.1" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#learning-outcomes-6"><i class="fa fa-check"></i><b>10.1</b> Learning outcomes</a></li>
<li class="chapter" data-level="10.2" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#homework-9"><i class="fa fa-check"></i><b>10.2</b> Homework</a></li>
<li class="chapter" data-level="10.3" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#recommended-listening-9"><i class="fa fa-check"></i><b>10.3</b> Recommended listening ðŸŽ§</a></li>
<li class="chapter" data-level="10.4" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#introduction-9"><i class="fa fa-check"></i><b>10.4</b> Introduction</a></li>
<li class="chapter" data-level="10.5" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#maup"><i class="fa fa-check"></i><b>10.5</b> MAUP</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#get-the-data"><i class="fa fa-check"></i><b>10.5.1</b> Get the data</a></li>
<li class="chapter" data-level="10.5.2" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#project-the-data"><i class="fa fa-check"></i><b>10.5.2</b> Project the data</a></li>
<li class="chapter" data-level="10.5.3" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#functions-1"><i class="fa fa-check"></i><b>10.5.3</b> Functions</a></li>
<li class="chapter" data-level="10.5.4" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#loops"><i class="fa fa-check"></i><b>10.5.4</b> Loops</a></li>
<li class="chapter" data-level="10.5.5" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#advanced-mapping-again"><i class="fa fa-check"></i><b>10.5.5</b> Advanced mapping (again)</a></li>
</ul></li>
<li class="chapter" data-level="10.6" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#regression-relationships"><i class="fa fa-check"></i><b>10.6</b> Regression relationships</a>
<ul>
<li class="chapter" data-level="10.6.1" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#preprocessing"><i class="fa fa-check"></i><b>10.6.1</b> Preprocessing</a></li>
<li class="chapter" data-level="10.6.2" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#scatter-plot"><i class="fa fa-check"></i><b>10.6.2</b> Scatter plot</a></li>
<li class="chapter" data-level="10.6.3" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#outliers"><i class="fa fa-check"></i><b>10.6.3</b> Outliers</a></li>
<li class="chapter" data-level="10.6.4" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#correlation"><i class="fa fa-check"></i><b>10.6.4</b> Correlation</a></li>
<li class="chapter" data-level="10.6.5" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#linear-model"><i class="fa fa-check"></i><b>10.6.5</b> Linear model</a></li>
<li class="chapter" data-level="10.6.6" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#linear-model-outputs"><i class="fa fa-check"></i><b>10.6.6</b> Linear model outputs</a></li>
<li class="chapter" data-level="10.6.7" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#validation"><i class="fa fa-check"></i><b>10.6.7</b> Validation</a></li>
<li class="chapter" data-level="10.6.8" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#cross-validation"><i class="fa fa-check"></i><b>10.6.8</b> Cross validation</a></li>
</ul></li>
<li class="chapter" data-level="10.7" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#advanced-regression"><i class="fa fa-check"></i><b>10.7</b> Advanced regression</a>
<ul>
<li class="chapter" data-level="10.7.1" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#more-data"><i class="fa fa-check"></i><b>10.7.1</b> More data</a></li>
<li class="chapter" data-level="10.7.2" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#multiple-linear-regression"><i class="fa fa-check"></i><b>10.7.2</b> Multiple linear regression</a></li>
<li class="chapter" data-level="10.7.3" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#ridge-regression"><i class="fa fa-check"></i><b>10.7.3</b> Ridge regression</a></li>
<li class="chapter" data-level="10.7.4" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#lasso"><i class="fa fa-check"></i><b>10.7.4</b> LASSO</a></li>
<li class="chapter" data-level="10.7.5" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#elastic-net-regression"><i class="fa fa-check"></i><b>10.7.5</b> Elastic net regression</a></li>
<li class="chapter" data-level="10.7.6" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#whats-the-best-here"><i class="fa fa-check"></i><b>10.7.6</b> Whatâ€™s the best here</a></li>
<li class="chapter" data-level="10.7.7" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#what-should-i-use"><i class="fa fa-check"></i><b>10.7.7</b> What should i use</a></li>
<li class="chapter" data-level="10.7.8" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#so-how-do-i-predict"><i class="fa fa-check"></i><b>10.7.8</b> So how do i predict</a></li>
<li class="chapter" data-level="10.7.9" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#should-i-write-advanced-code"><i class="fa fa-check"></i><b>10.7.9</b> Should i write advanced code</a></li>
</ul></li>
<li class="chapter" data-level="10.8" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#more-resources"><i class="fa fa-check"></i><b>10.8</b> More resources</a></li>
<li class="chapter" data-level="10.9" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#extension-2"><i class="fa fa-check"></i><b>10.9</b> Extension</a></li>
<li class="chapter" data-level="10.10" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#acknowledgement-1"><i class="fa fa-check"></i><b>10.10</b> Acknowledgement</a></li>
<li class="chapter" data-level="10.11" data-path="advanced-r-maup-and-more-regression.html"><a href="advanced-r-maup-and-more-regression.html#feedback-9"><i class="fa fa-check"></i><b>10.11</b> Feedback</a></li>
</ul></li>
<li class="part"><span><b>Assignment</b></span></li>
<li class="chapter" data-level="11" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html"><i class="fa fa-check"></i><b>11</b> Assignment resources</a>
<ul>
<li class="chapter" data-level="11.1" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#timeline"><i class="fa fa-check"></i><b>11.1</b> Timeline</a></li>
<li class="chapter" data-level="11.2" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#markscheme"><i class="fa fa-check"></i><b>11.2</b> Markscheme</a></li>
<li class="chapter" data-level="11.3" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#examples-of-previous-work"><i class="fa fa-check"></i><b>11.3</b> Examples of previous work</a></li>
<li class="chapter" data-level="11.4" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#events-meet-other-spatial-data-professionals"><i class="fa fa-check"></i><b>11.4</b> Events / meet other spatial data professionals</a></li>
<li class="chapter" data-level="11.5" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#cool-stuff-to-explore"><i class="fa fa-check"></i><b>11.5</b> Cool stuff to explore</a></li>
<li class="chapter" data-level="11.6" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#assignment-ideas"><i class="fa fa-check"></i><b>11.6</b> Assignment ideas</a></li>
<li class="chapter" data-level="11.7" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#booksreading-resources"><i class="fa fa-check"></i><b>11.7</b> Books/reading resources</a></li>
<li class="chapter" data-level="11.8" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#new-developments"><i class="fa fa-check"></i><b>11.8</b> New developments</a>
<ul>
<li class="chapter" data-level="11.8.1" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#twitter"><i class="fa fa-check"></i><b>11.8.1</b> Twitter</a></li>
</ul></li>
<li class="chapter" data-level="11.9" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#data-3"><i class="fa fa-check"></i><b>11.9</b> Data</a></li>
<li class="chapter" data-level="11.10" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#data-lists-1"><i class="fa fa-check"></i><b>11.10</b> Data lists</a></li>
<li class="chapter" data-level="11.11" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#reading-and-writing-critically"><i class="fa fa-check"></i><b>11.11</b> Reading and writing critically</a></li>
<li class="chapter" data-level="11.12" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#free-flow-diagram-tools"><i class="fa fa-check"></i><b>11.12</b> Free flow diagram tools</a></li>
<li class="chapter" data-level="11.13" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#basics-1"><i class="fa fa-check"></i><b>11.13</b> Basics</a>
<ul>
<li class="chapter" data-level="11.13.1" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#introduction-10"><i class="fa fa-check"></i><b>11.13.1</b> Introduction</a></li>
<li class="chapter" data-level="11.13.2" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#literature-review"><i class="fa fa-check"></i><b>11.13.2</b> Literature review</a></li>
<li class="chapter" data-level="11.13.3" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#methodology"><i class="fa fa-check"></i><b>11.13.3</b> Methodology</a></li>
<li class="chapter" data-level="11.13.4" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#results"><i class="fa fa-check"></i><b>11.13.4</b> Results</a></li>
<li class="chapter" data-level="11.13.5" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#discussion"><i class="fa fa-check"></i><b>11.13.5</b> Discussion</a></li>
<li class="chapter" data-level="11.13.6" data-path="assignment-resources-1.html"><a href="assignment-resources-1.html#conclusion"><i class="fa fa-check"></i><b>11.13.6</b> Conclusion</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><center>
  <a rel="license" href="./external-usage.html#license">
    License: CC-BY-SA<br>
    <i class = "fab fa-creative-commons fa-2x"></i>
    <i class = "fab fa-creative-commons-by fa-2x"></i>
    <i class = "fab fa-creative-commons-sa fa-2x"></i>
  </a>
</li></center>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">CASA0005 Geographic Information Systems and Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="advanced-r-maup-and-more-regression" class="section level1 hasAnchor" number="10">
<h1><span class="header-section-number">Chapter 10</span> Advanced R, MAUP and more regression<a href="advanced-r-maup-and-more-regression.html#advanced-r-maup-and-more-regression" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="learning-outcomes-6" class="section level2 hasAnchor" number="10.1">
<h2><span class="header-section-number">10.1</span> Learning outcomes<a href="advanced-r-maup-and-more-regression.html#learning-outcomes-6" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li>Describe, explain and visualise the MAUP problem</li>
<li>Design and use loops and functions</li>
<li>Execute linear, Ridge and LASSO regression to predict values (e.g.Â future or missing)</li>
<li>Critically evaluate different regression approaches</li>
</ol>
</div>
<div id="homework-9" class="section level2 hasAnchor" number="10.2">
<h2><span class="header-section-number">10.2</span> Homework<a href="advanced-r-maup-and-more-regression.html#homework-9" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Outside of our schedulded sessions you should be doing around 12 hours of extra study per week. Feel free to follow your own GIS interests, but good places to start include the following:</p>
<div class="infobox assignment">
<p><strong>Assignment</strong></p>
<p>From weeks 10 until the assignment deadline, undertake your analysis, then write up your discussion and conclusion <strong>(that includes recommendations)</strong>.</p>
</div>
<div class="infobox tip">
<p><strong>Before submission</strong></p>
<p>Check that your assignment follows the standard model of scientific investigation. You may need to update your introduction and literature review based on the analysis you undertook to ensure a seamless narrative throughout.</p>
</div>
<div class="infobox note">
<p><strong>Reading</strong>
This week:</p>
<ul>
<li><p>For advanced R coding <a href="https://adv-r.hadley.nz/control-flow.html">Chapter 5 â€œControl flowâ€</a> from Advacned R by Hadley Wickham.</p></li>
<li><p>For more advanced R inclduing functions <a href="https://geocompr.robinlovelace.net/algorithms.html">Chapter 10 â€œScripts, algorithms and functionsâ€</a> from Geocomputation with R by Lovelace, Nowosad and Muenchow (2020).</p></li>
<li><p>For Ridge and LASSO regression <a href="https://bookdown.org/egarpor/PM-UC3M/lm-iii.html">Chapter 4 â€œLinear models III: shrinkage, multivariate response, and big dataâ€</a> from Predictive Modeling by PortuguÃ©s (2020).</p></li>
</ul>
<p>Remember this is just a starting point, explore the <a href="https://rl.talis.com/3/ucl/lists/139FBAF8-DACD-60FB-8BDC-E9C9E09BA885.html?lang=en-GB&amp;login=1">reading list</a>, practical and lecture for more ideas.</p>
</div>
</div>
<div id="recommended-listening-9" class="section level2 hasAnchor" number="10.3">
<h2><span class="header-section-number">10.3</span> Recommended listening ðŸŽ§<a href="#recommended-listening-9" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Some of these practicals are long, take regular breaks and have a listen to some of our fav tunes each week.</p>
<p><a href="https://www.youtube.com/watch?v=YNXybY2DtwM">Andy</a></p>
<p><a href="https://open.spotify.com/album/5yMqI30BaFZww5orpqemV5?si=vgEFH5p9ReqtGHSt66vCsw">Adam</a>6 letters: LSB, DRS. Oh yes!</p>
</div>
<div id="introduction-9" class="section level2 hasAnchor" number="10.4">
<h2><span class="header-section-number">10.4</span> Introduction<a href="advanced-r-maup-and-more-regression.html#introduction-9" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The Modifiable Areal Unit Problem (MAUP) represents the related effects of scale and aggregation on all geographic data and analysis. It was first deomstrated by the geographer Stan Openshaw in 1984 who showed that as you aggregated results to diffrent spatial units the reults could be manipulated to show different outcomes. Throughout this practical book weâ€™ve considered London boroughs, but would any of the results change if we considered the data at ward level? Are we hiding any trends because we have just used the borough data that summed all of the wards within the borough? Itâ€™s important to consider what is the most appropriate spatial unit for your analysis and provide appropriate reasoning. Even this is pretty straightforward (e.g.Â the data was only provided at the borough level) you must contextualise this and describe any potential limitations of it. In this practical i will firstly demonstrate the MAUP in action using some more advanced R code. Then we will have a look at some techniques to model and validate data.</p>
<p>Here we will be using London brough and ward data from practical 1. As weâ€™re getting better with R, we will try to automate almost everthing â€” meaning that if you gave this code to someone else they could just run it without any data files and generate the same result. The only thing we wonâ€™t automate later on is loading an excel fileâ€¦ i did find a function online that would let us read it from the interweb but it was more hassle than it was worth. I donâ€™t know why the data isnâ€™t just also distributed as a <code>.csv</code>.</p>
</div>
<div id="maup" class="section level2 hasAnchor" number="10.5">
<h2><span class="header-section-number">10.5</span> MAUP<a href="advanced-r-maup-and-more-regression.html#maup" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="get-the-data" class="section level3 hasAnchor" number="10.5.1">
<h3><span class="header-section-number">10.5.1</span> Get the data<a href="advanced-r-maup-and-more-regression.html#get-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li>Download and unzip the London statistical gis boundaries.</li>
</ol>
<div class="sourceCode" id="cb596"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb596-1"><a href="advanced-r-maup-and-more-regression.html#cb596-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make a temp file to store the .zip in</span></span>
<span id="cb596-2"><a href="advanced-r-maup-and-more-regression.html#cb596-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb596-3"><a href="advanced-r-maup-and-more-regression.html#cb596-3" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">&quot;https://data.london.gov.uk/download/statistical-gis-boundary-files-london/9ba8c833-6370-4b11-abdc-314aa020d5e0/statistical-gis-boundaries-london.zip&quot;</span>, </span>
<span id="cb596-4"><a href="advanced-r-maup-and-more-regression.html#cb596-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">destfile=</span><span class="st">&quot;prac10_data/statistical-gis-boundaries-london.zip&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb597"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb597-1"><a href="advanced-r-maup-and-more-regression.html#cb597-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb597-2"><a href="advanced-r-maup-and-more-regression.html#cb597-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fs)</span>
<span id="cb597-3"><a href="advanced-r-maup-and-more-regression.html#cb597-3" aria-hidden="true" tabindex="-1"></a>listfiles<span class="ot">&lt;-</span><span class="fu">dir_info</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;prac10_data&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb597-4"><a href="advanced-r-maup-and-more-regression.html#cb597-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(path, <span class="st">&quot;statistical-gis-boundaries-london.zip&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb597-5"><a href="advanced-r-maup-and-more-regression.html#cb597-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(path)<span class="sc">%&gt;%</span></span>
<span id="cb597-6"><a href="advanced-r-maup-and-more-regression.html#cb597-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()<span class="sc">%&gt;%</span></span>
<span id="cb597-7"><a href="advanced-r-maup-and-more-regression.html#cb597-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#print out the .gz file</span></span>
<span id="cb597-8"><a href="advanced-r-maup-and-more-regression.html#cb597-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()<span class="sc">%&gt;%</span></span>
<span id="cb597-9"><a href="advanced-r-maup-and-more-regression.html#cb597-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.character</span>()<span class="sc">%&gt;%</span></span>
<span id="cb597-10"><a href="advanced-r-maup-and-more-regression.html#cb597-10" aria-hidden="true" tabindex="-1"></a>  utils<span class="sc">::</span><span class="fu">unzip</span>(<span class="at">exdir=</span>here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;prac10_data&quot;</span>))</span></code></pre></div>
<pre><code>## C:/Users/Andy/OneDrive - University College London/Teaching/CASA0005/2020_2021/CASA0005repo/prac10_data/statistical-gis-boundaries-london.zip</code></pre>
<p>Using a recent update we could also change this a bit with the <code>pins()</code> package that downloads and caches the url and automatically checks for file changes, only re-downloading if needed!</p>
<div class="sourceCode" id="cb599"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb599-1"><a href="advanced-r-maup-and-more-regression.html#cb599-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pins)</span>
<span id="cb599-2"><a href="advanced-r-maup-and-more-regression.html#cb599-2" aria-hidden="true" tabindex="-1"></a>pinexample<span class="ot">&lt;-</span>pins<span class="sc">::</span><span class="fu">pin</span>(<span class="st">&quot;https://data.london.gov.uk/download/statistical-gis-boundary-files-london/9ba8c833-6370-4b11-abdc-314aa020d5e0/statistical-gis-boundaries-london.zip&quot;</span>)</span></code></pre></div>
<p><code>pins()</code> also lets you share data easily, <a href="https://blog.rstudio.com/2019/09/09/pin-discover-and-share-resources/">have a look the RStudio pins blog post</a> for more information.</p>
<ol style="list-style-type: decimal">
<li>Take the downloaded data and filter it based on the filename that contains: Borough OR Ward_ AND <code>.shp</code> using <code>grepl()</code></li>
</ol>
<div class="sourceCode" id="cb600"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb600-1"><a href="advanced-r-maup-and-more-regression.html#cb600-1" aria-hidden="true" tabindex="-1"></a>boroughsandwards<span class="ot">&lt;-</span><span class="fu">dir_info</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;prac9_data&quot;</span>, </span>
<span id="cb600-2"><a href="advanced-r-maup-and-more-regression.html#cb600-2" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;statistical-gis-boundaries-london&quot;</span>, </span>
<span id="cb600-3"><a href="advanced-r-maup-and-more-regression.html#cb600-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;ESRI&quot;</span>))<span class="sc">%&gt;%</span></span>
<span id="cb600-4"><a href="advanced-r-maup-and-more-regression.html#cb600-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#$ means exact match</span></span>
<span id="cb600-5"><a href="advanced-r-maup-and-more-regression.html#cb600-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(path, </span>
<span id="cb600-6"><a href="advanced-r-maup-and-more-regression.html#cb600-6" aria-hidden="true" tabindex="-1"></a>                        <span class="st">&quot;London_Ward_CityMerged.shp$|London_Borough_Excluding_MHW.shp$&quot;</span>))<span class="sc">%&gt;%</span></span>
<span id="cb600-7"><a href="advanced-r-maup-and-more-regression.html#cb600-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(path)<span class="sc">%&gt;%</span></span>
<span id="cb600-8"><a href="advanced-r-maup-and-more-regression.html#cb600-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Now read in both of the files using <code>map()</code> that applies a function (here <code>st_read()</code> from the <code>sf</code> package) to a list. <code>map()</code> comes from the <code>purrr</code> package which extends Râ€™s functional programming ability.</li>
</ol>
<div class="sourceCode" id="cb601"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb601-1"><a href="advanced-r-maup-and-more-regression.html#cb601-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb601-2"><a href="advanced-r-maup-and-more-regression.html#cb601-2" aria-hidden="true" tabindex="-1"></a>boroughsandwardssf<span class="ot">&lt;-</span><span class="fu">map</span>(boroughsandwards, st_read)</span></code></pre></div>
<pre><code>## Reading layer `London_Borough_Excluding_MHW&#39; from data source 
##   `C:\Users\Andy\OneDrive - University College London\Teaching\CASA0005\2020_2021\CASA0005repo\prac9_data\statistical-gis-boundaries-london\ESRI\London_Borough_Excluding_MHW.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 33 features and 7 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 503568.2 ymin: 155850.8 xmax: 561957.5 ymax: 200933.9
## Projected CRS: OSGB 1936 / British National Grid
## Reading layer `London_Ward_CityMerged&#39; from data source 
##   `C:\Users\Andy\OneDrive - University College London\Teaching\CASA0005\2020_2021\CASA0005repo\prac9_data\statistical-gis-boundaries-london\ESRI\London_Ward_CityMerged.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 625 features and 7 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: 503568.2 ymin: 155850.8 xmax: 561957.5 ymax: 200933.9
## Projected CRS: OSGB 1936 / British National Grid</code></pre>
<p>To map or access each individual shapefile itâ€™s justâ€¦</p>
<div class="sourceCode" id="cb603"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb603-1"><a href="advanced-r-maup-and-more-regression.html#cb603-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb603-2"><a href="advanced-r-maup-and-more-regression.html#cb603-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">&quot;plot&quot;</span>)</span>
<span id="cb603-3"><a href="advanced-r-maup-and-more-regression.html#cb603-3" aria-hidden="true" tabindex="-1"></a><span class="fu">qtm</span>(boroughsandwardssf[[<span class="dv">2</span>]]) </span></code></pre></div>
<p><img src="CASA0005_files/figure-html/unnamed-chunk-483-1.png" width="672" /></p>
<div class="sourceCode" id="cb604"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb604-1"><a href="advanced-r-maup-and-more-regression.html#cb604-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or change to 1 </span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Get the data for Airbnb</li>
</ol>
<div class="sourceCode" id="cb605"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb605-1"><a href="advanced-r-maup-and-more-regression.html#cb605-1" aria-hidden="true" tabindex="-1"></a>Airbnb <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;http://data.insideairbnb.com/united-kingdom/england/london/2022-03-09/data/listings.csv.gz&quot;</span>)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>And for OSM weâ€™ll download it from geofabrik, you can also use the OSM Application Programming Interface (API) but there is a limit on the number of points downloadable per call so youâ€™d have to do something a bit more complicated to get the whole of Londonâ€¦however, I have provided an example of the api call.</li>
</ol>
<div class="sourceCode" id="cb606"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb606-1"><a href="advanced-r-maup-and-more-regression.html#cb606-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(memisc)</span>
<span id="cb606-2"><a href="advanced-r-maup-and-more-regression.html#cb606-2" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="st">&quot;http://download.geofabrik.de/europe/great-britain/england/greater-london-latest-free.shp.zip&quot;</span>,</span>
<span id="cb606-3"><a href="advanced-r-maup-and-more-regression.html#cb606-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">mode=</span><span class="st">&#39;wb&#39;</span>, </span>
<span id="cb606-4"><a href="advanced-r-maup-and-more-regression.html#cb606-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">destfile=</span><span class="st">&quot;prac10_data/geofabrik.zip&quot;</span>)</span>
<span id="cb606-5"><a href="advanced-r-maup-and-more-regression.html#cb606-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb606-6"><a href="advanced-r-maup-and-more-regression.html#cb606-6" aria-hidden="true" tabindex="-1"></a>listfiles<span class="ot">&lt;-</span><span class="fu">dir_info</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;prac10_data&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb606-7"><a href="advanced-r-maup-and-more-regression.html#cb606-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(path, <span class="st">&quot;geofabrik.zip&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb606-8"><a href="advanced-r-maup-and-more-regression.html#cb606-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(path)<span class="sc">%&gt;%</span></span>
<span id="cb606-9"><a href="advanced-r-maup-and-more-regression.html#cb606-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>()<span class="sc">%&gt;%</span></span>
<span id="cb606-10"><a href="advanced-r-maup-and-more-regression.html#cb606-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#print out the .gz file</span></span>
<span id="cb606-11"><a href="advanced-r-maup-and-more-regression.html#cb606-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()<span class="sc">%&gt;%</span></span>
<span id="cb606-12"><a href="advanced-r-maup-and-more-regression.html#cb606-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.character</span>()<span class="sc">%&gt;%</span></span>
<span id="cb606-13"><a href="advanced-r-maup-and-more-regression.html#cb606-13" aria-hidden="true" tabindex="-1"></a>  utils<span class="sc">::</span><span class="fu">unzip</span>(<span class="at">exdir=</span>here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;prac10_data&quot;</span>, <span class="st">&quot;geofabrik&quot;</span>))</span></code></pre></div>
<p>Example of using the APIâ€¦.</p>
<div class="sourceCode" id="cb607"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb607-1"><a href="advanced-r-maup-and-more-regression.html#cb607-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(osmar)</span>
<span id="cb607-2"><a href="advanced-r-maup-and-more-regression.html#cb607-2" aria-hidden="true" tabindex="-1"></a>src <span class="ot">&lt;-</span> <span class="fu">osmsource_api</span>(<span class="at">url =</span> <span class="st">&quot;https://api.openstreetmap.org/api/0.6/&quot;</span>)</span>
<span id="cb607-3"><a href="advanced-r-maup-and-more-regression.html#cb607-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1000 refers to distance from centre point</span></span>
<span id="cb607-4"><a href="advanced-r-maup-and-more-regression.html#cb607-4" aria-hidden="true" tabindex="-1"></a>bb <span class="ot">&lt;-</span> <span class="fu">center_bbox</span>(<span class="sc">-</span><span class="fl">0.112510</span>,<span class="fl">51.507627</span>, <span class="dv">1000</span>, <span class="dv">1000</span>)</span>
<span id="cb607-5"><a href="advanced-r-maup-and-more-regression.html#cb607-5" aria-hidden="true" tabindex="-1"></a>LDN <span class="ot">&lt;-</span> <span class="fu">get_osm</span>(bb, <span class="at">source =</span> src)</span>
<span id="cb607-6"><a href="advanced-r-maup-and-more-regression.html#cb607-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(LDN)</span>
<span id="cb607-7"><a href="advanced-r-maup-and-more-regression.html#cb607-7" aria-hidden="true" tabindex="-1"></a><span class="co"># extract just highwways</span></span>
<span id="cb607-8"><a href="advanced-r-maup-and-more-regression.html#cb607-8" aria-hidden="true" tabindex="-1"></a>ways <span class="ot">&lt;-</span> <span class="fu">find</span>(LDN, <span class="fu">way</span>(<span class="fu">tags</span>(k <span class="sc">==</span> <span class="st">&quot;highway&quot;</span>)))</span>
<span id="cb607-9"><a href="advanced-r-maup-and-more-regression.html#cb607-9" aria-hidden="true" tabindex="-1"></a>hway <span class="ot">&lt;-</span> <span class="fu">find_down</span>(LDN, <span class="fu">way</span>(ways))</span>
<span id="cb607-10"><a href="advanced-r-maup-and-more-regression.html#cb607-10" aria-hidden="true" tabindex="-1"></a>hway <span class="ot">&lt;-</span> <span class="fu">subset</span>(LDN, <span class="at">ids =</span> hway)</span></code></pre></div>
</div>
<div id="project-the-data" class="section level3 hasAnchor" number="10.5.2">
<h3><span class="header-section-number">10.5.2</span> Project the data<a href="advanced-r-maup-and-more-regression.html#project-the-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li>Next up we need to project our <code>.shp</code> data â€¦we could project our data individually using:</li>
</ol>
<div class="sourceCode" id="cb608"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb608-1"><a href="advanced-r-maup-and-more-regression.html#cb608-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_transform</span>(boroughsandwardssf[[<span class="dv">1</span>]], <span class="dv">27700</span>)</span>
<span id="cb608-2"><a href="advanced-r-maup-and-more-regression.html#cb608-2" aria-hidden="true" tabindex="-1"></a><span class="fu">st_transform</span>(boroughsandwardssf[[<span class="dv">2</span>]], <span class="dv">27700</span>)</span></code></pre></div>
<p>or use <code>map()</code> againâ€¦</p>
<div class="sourceCode" id="cb609"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb609-1"><a href="advanced-r-maup-and-more-regression.html#cb609-1" aria-hidden="true" tabindex="-1"></a>boroughsandwardssf<span class="ot">&lt;-</span> <span class="fu">map</span>(boroughsandwardssf, <span class="at">crs=</span><span class="dv">27700</span>, st_transform)</span>
<span id="cb609-2"><a href="advanced-r-maup-and-more-regression.html#cb609-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb609-3"><a href="advanced-r-maup-and-more-regression.html#cb609-3" aria-hidden="true" tabindex="-1"></a><span class="co"># change the airbnb data to spatial </span></span>
<span id="cb609-4"><a href="advanced-r-maup-and-more-regression.html#cb609-4" aria-hidden="true" tabindex="-1"></a>Airbnb <span class="ot">&lt;-</span> Airbnb <span class="sc">%&gt;%</span></span>
<span id="cb609-5"><a href="advanced-r-maup-and-more-regression.html#cb609-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(., <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;longitude&quot;</span>, <span class="st">&quot;latitude&quot;</span>), </span>
<span id="cb609-6"><a href="advanced-r-maup-and-more-regression.html#cb609-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">crs =</span> <span class="dv">4326</span>)<span class="sc">%&gt;%</span></span>
<span id="cb609-7"><a href="advanced-r-maup-and-more-regression.html#cb609-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># project it too - remember that 27700 is</span></span>
<span id="cb609-8"><a href="advanced-r-maup-and-more-regression.html#cb609-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># British National Grid</span></span>
<span id="cb609-9"><a href="advanced-r-maup-and-more-regression.html#cb609-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(., <span class="dv">27700</span>)</span></code></pre></div>
</div>
<div id="functions-1" class="section level3 hasAnchor" number="10.5.3">
<h3><span class="header-section-number">10.5.3</span> Functions<a href="advanced-r-maup-and-more-regression.html#functions-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li>Now remember our function we made for joining our Airbnb data (or Hotels) to the London boroughs layerâ€¦ letâ€™s make the function againâ€¦</li>
</ol>
<div class="sourceCode" id="cb610"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb610-1"><a href="advanced-r-maup-and-more-regression.html#cb610-1" aria-hidden="true" tabindex="-1"></a>Joinfun <span class="ot">&lt;-</span> <span class="cf">function</span>(data1, data2){</span>
<span id="cb610-2"><a href="advanced-r-maup-and-more-regression.html#cb610-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb610-3"><a href="advanced-r-maup-and-more-regression.html#cb610-3" aria-hidden="true" tabindex="-1"></a>output<span class="ot">&lt;-</span> data1<span class="sc">%&gt;%</span></span>
<span id="cb610-4"><a href="advanced-r-maup-and-more-regression.html#cb610-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_join</span>(data2,.)<span class="sc">%&gt;%</span></span>
<span id="cb610-5"><a href="advanced-r-maup-and-more-regression.html#cb610-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_count</span>(GSS_CODE, <span class="at">name=</span><span class="st">&quot;airbnbs&quot;</span>) </span>
<span id="cb610-6"><a href="advanced-r-maup-and-more-regression.html#cb610-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(output)</span>
<span id="cb610-7"><a href="advanced-r-maup-and-more-regression.html#cb610-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="loops" class="section level3 hasAnchor" number="10.5.4">
<h3><span class="header-section-number">10.5.4</span> Loops<a href="advanced-r-maup-and-more-regression.html#loops" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li>Ok, but we want to get a count of Airbnb points per London ward and Boroughâ€¦how can we do that?â€¦well manually of courseâ€¦like thisâ€¦</li>
</ol>
<div class="sourceCode" id="cb611"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb611-1"><a href="advanced-r-maup-and-more-regression.html#cb611-1" aria-hidden="true" tabindex="-1"></a>Airbnbborough <span class="ot">&lt;-</span> <span class="fu">Joinfun</span>(Airbnb, boroughsandwardssf[[<span class="dv">1</span>]])</span>
<span id="cb611-2"><a href="advanced-r-maup-and-more-regression.html#cb611-2" aria-hidden="true" tabindex="-1"></a>Airbnbward <span class="ot">&lt;-</span> <span class="fu">Joinfun</span>(Airbnb, boroughsandwardssf[[<span class="dv">2</span>]])</span></code></pre></div>
<p>But we can also automate this using a loop (either a while or for loop). Iâ€™ve used a while loop here as when i did my MSc you werenâ€™t able to put a for loop inside a for loop. I beleive that has now changed but because of that one day i had to spend changing everything i always default to using a while loop.</p>
<p>Tell us what a loop is already?</p>
<p>A loop letâ€™s you go over something adding 1 (or any value) each timeâ€¦for example letâ€™s look a basic loop. You need to run everything in the loop at once from the while to the }. If you make just a normal Rscript you can set breakpoints â€” the code will the stop each time it hits the breakpoint within the loop. You canâ€™t do this at the moment with RMarkdown code chunks, i normally develop the loop outside of it looping then put it all together.</p>
<div class="sourceCode" id="cb612"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb612-1"><a href="advanced-r-maup-and-more-regression.html#cb612-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up a variable  </span></span>
<span id="cb612-2"><a href="advanced-r-maup-and-more-regression.html#cb612-2" aria-hidden="true" tabindex="-1"></a>basicloop <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb612-3"><a href="advanced-r-maup-and-more-regression.html#cb612-3" aria-hidden="true" tabindex="-1"></a><span class="co"># so while our variable is less than </span></span>
<span id="cb612-4"><a href="advanced-r-maup-and-more-regression.html#cb612-4" aria-hidden="true" tabindex="-1"></a><span class="co">#6 run the following code within the {}</span></span>
<span id="cb612-5"><a href="advanced-r-maup-and-more-regression.html#cb612-5" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (basicloop <span class="sc">&lt;</span> <span class="dv">6</span>) {</span>
<span id="cb612-6"><a href="advanced-r-maup-and-more-regression.html#cb612-6" aria-hidden="true" tabindex="-1"></a>  <span class="co">#print the varaible (starts at 1)</span></span>
<span id="cb612-7"><a href="advanced-r-maup-and-more-regression.html#cb612-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(basicloop)</span>
<span id="cb612-8"><a href="advanced-r-maup-and-more-regression.html#cb612-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># then add 1 to the variable</span></span>
<span id="cb612-9"><a href="advanced-r-maup-and-more-regression.html#cb612-9" aria-hidden="true" tabindex="-1"></a>  basicloop <span class="ot">=</span> basicloop<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb612-10"><a href="advanced-r-maup-and-more-regression.html#cb612-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># go back to the start of the loop</span></span>
<span id="cb612-11"><a href="advanced-r-maup-and-more-regression.html#cb612-11" aria-hidden="true" tabindex="-1"></a>  <span class="co">#and if it is still &lt;6 run again</span></span>
<span id="cb612-12"><a href="advanced-r-maup-and-more-regression.html#cb612-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5</code></pre>
<p>That loop outputs the values of 1-5, as we started with a value of 1, then added 1 to make 2. It remained below 6 so the code ran again printing the 2 then added 1 again to make 3 and so on. As we specified less than 6 it stopped there..</p>
<p>We can also save these results to diffrent variables but we need to make a list (or dataframe/ whatever you need) to start with to save them in</p>
<div class="sourceCode" id="cb614"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb614-1"><a href="advanced-r-maup-and-more-regression.html#cb614-1" aria-hidden="true" tabindex="-1"></a><span class="co"># here is my empty list</span></span>
<span id="cb614-2"><a href="advanced-r-maup-and-more-regression.html#cb614-2" aria-hidden="true" tabindex="-1"></a>emptylist <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb614-3"><a href="advanced-r-maup-and-more-regression.html#cb614-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb614-4"><a href="advanced-r-maup-and-more-regression.html#cb614-4" aria-hidden="true" tabindex="-1"></a>basicloop <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb614-5"><a href="advanced-r-maup-and-more-regression.html#cb614-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb614-6"><a href="advanced-r-maup-and-more-regression.html#cb614-6" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (basicloop <span class="sc">&lt;</span> <span class="dv">6</span>) {</span>
<span id="cb614-7"><a href="advanced-r-maup-and-more-regression.html#cb614-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(basicloop)</span>
<span id="cb614-8"><a href="advanced-r-maup-and-more-regression.html#cb614-8" aria-hidden="true" tabindex="-1"></a>  emptylist[[basicloop]] <span class="ot">&lt;-</span> basicloop</span>
<span id="cb614-9"><a href="advanced-r-maup-and-more-regression.html#cb614-9" aria-hidden="true" tabindex="-1"></a>  basicloop <span class="ot">&lt;-</span> basicloop<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb614-10"><a href="advanced-r-maup-and-more-regression.html#cb614-10" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] 1
## [1] 2
## [1] 3
## [1] 4
## [1] 5</code></pre>
<p>Here we are using the variable <code>basicloop</code> to index our emptylist.. so everytime we add 1 it changes the index valueâ€¦.have a look what i meanâ€¦</p>
<div class="sourceCode" id="cb616"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb616-1"><a href="advanced-r-maup-and-more-regression.html#cb616-1" aria-hidden="true" tabindex="-1"></a>emptylist</span></code></pre></div>
<pre><code>## [[1]]
## [1] 1
## 
## [[2]]
## [1] 2
## 
## [[3]]
## [1] 3
## 
## [[4]]
## [1] 4
## 
## [[5]]
## [1] 5</code></pre>
<div class="sourceCode" id="cb618"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb618-1"><a href="advanced-r-maup-and-more-regression.html#cb618-1" aria-hidden="true" tabindex="-1"></a>emptylist[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb620"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb620-1"><a href="advanced-r-maup-and-more-regression.html#cb620-1" aria-hidden="true" tabindex="-1"></a>emptylist[[<span class="dv">2</span>]]</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<p>Right, so how are we going to apply this to our data. We have two <code>.shp</code> files (boroughs and wards) in a list that we want to apply our function to..</p>
<p>Firstly letâ€™s set up the length to stop at, make an empty list and a starting point. As our data is in a list we just want the length of that (as a number)..</p>
<div class="sourceCode" id="cb622"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb622-1"><a href="advanced-r-maup-and-more-regression.html#cb622-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the length - add 1 as we are using less than</span></span>
<span id="cb622-2"><a href="advanced-r-maup-and-more-regression.html#cb622-2" aria-hidden="true" tabindex="-1"></a>boroughlen<span class="ot">&lt;-</span><span class="fu">length</span>(boroughsandwardssf)<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb622-3"><a href="advanced-r-maup-and-more-regression.html#cb622-3" aria-hidden="true" tabindex="-1"></a><span class="co"># empty list</span></span>
<span id="cb622-4"><a href="advanced-r-maup-and-more-regression.html#cb622-4" aria-hidden="true" tabindex="-1"></a>hold<span class="ot">&lt;-</span><span class="fu">list</span>()</span>
<span id="cb622-5"><a href="advanced-r-maup-and-more-regression.html#cb622-5" aria-hidden="true" tabindex="-1"></a><span class="co"># here is our starting point variable</span></span>
<span id="cb622-6"><a href="advanced-r-maup-and-more-regression.html#cb622-6" aria-hidden="true" tabindex="-1"></a>i<span class="ot">&lt;-</span><span class="dv">1</span></span></code></pre></div>
<p>Now here is the loop..</p>
<div class="sourceCode" id="cb623"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb623-1"><a href="advanced-r-maup-and-more-regression.html#cb623-1" aria-hidden="true" tabindex="-1"></a><span class="co"># while i is less than boroughlength </span></span>
<span id="cb623-2"><a href="advanced-r-maup-and-more-regression.html#cb623-2" aria-hidden="true" tabindex="-1"></a><span class="co"># max of boroughlength is 3</span></span>
<span id="cb623-3"><a href="advanced-r-maup-and-more-regression.html#cb623-3" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> (i <span class="sc">&lt;</span> boroughlen){</span>
<span id="cb623-4"><a href="advanced-r-maup-and-more-regression.html#cb623-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># put the output in our varible</span></span>
<span id="cb623-5"><a href="advanced-r-maup-and-more-regression.html#cb623-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># use the function for boroughs and then wards</span></span>
<span id="cb623-6"><a href="advanced-r-maup-and-more-regression.html#cb623-6" aria-hidden="true" tabindex="-1"></a>  hold[[i]] <span class="ot">&lt;-</span> <span class="fu">Joinfun</span>(Airbnb, boroughsandwardssf[[i]])</span>
<span id="cb623-7"><a href="advanced-r-maup-and-more-regression.html#cb623-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add one to the index</span></span>
<span id="cb623-8"><a href="advanced-r-maup-and-more-regression.html#cb623-8" aria-hidden="true" tabindex="-1"></a>  i<span class="ot">&lt;-</span>i<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb623-9"><a href="advanced-r-maup-and-more-regression.html#cb623-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb623-10"><a href="advanced-r-maup-and-more-regression.html#cb623-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb623-11"><a href="advanced-r-maup-and-more-regression.html#cb623-11" aria-hidden="true" tabindex="-1"></a><span class="co"># make a quick thematic map to have a look</span></span>
<span id="cb623-12"><a href="advanced-r-maup-and-more-regression.html#cb623-12" aria-hidden="true" tabindex="-1"></a>justairbnbborough<span class="ot">&lt;-</span>hold[[<span class="dv">1</span>]]<span class="sc">%&gt;%</span></span>
<span id="cb623-13"><a href="advanced-r-maup-and-more-regression.html#cb623-13" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(GSS_CODE, airbnbs)<span class="sc">%&gt;%</span></span>
<span id="cb623-14"><a href="advanced-r-maup-and-more-regression.html#cb623-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()<span class="sc">%&gt;%</span></span>
<span id="cb623-15"><a href="advanced-r-maup-and-more-regression.html#cb623-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(GSS_CODE, airbnbs)<span class="sc">%&gt;%</span></span>
<span id="cb623-16"><a href="advanced-r-maup-and-more-regression.html#cb623-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(boroughsandwardssf[[<span class="dv">1</span>]], .,</span>
<span id="cb623-17"><a href="advanced-r-maup-and-more-regression.html#cb623-17" aria-hidden="true" tabindex="-1"></a>                        <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;GSS_CODE&quot;</span> <span class="ot">=</span> <span class="st">&quot;GSS_CODE&quot;</span>))</span>
<span id="cb623-18"><a href="advanced-r-maup-and-more-regression.html#cb623-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb623-19"><a href="advanced-r-maup-and-more-regression.html#cb623-19" aria-hidden="true" tabindex="-1"></a>justairbnward<span class="ot">&lt;-</span>hold[[<span class="dv">2</span>]]<span class="sc">%&gt;%</span></span>
<span id="cb623-20"><a href="advanced-r-maup-and-more-regression.html#cb623-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(GSS_CODE, airbnbs)<span class="sc">%&gt;%</span></span>
<span id="cb623-21"><a href="advanced-r-maup-and-more-regression.html#cb623-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()<span class="sc">%&gt;%</span></span>
<span id="cb623-22"><a href="advanced-r-maup-and-more-regression.html#cb623-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(GSS_CODE, airbnbs)<span class="sc">%&gt;%</span></span>
<span id="cb623-23"><a href="advanced-r-maup-and-more-regression.html#cb623-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(boroughsandwardssf[[<span class="dv">2</span>]], .,</span>
<span id="cb623-24"><a href="advanced-r-maup-and-more-regression.html#cb623-24" aria-hidden="true" tabindex="-1"></a>                        <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;GSS_CODE&quot;</span> <span class="ot">=</span> <span class="st">&quot;GSS_CODE&quot;</span>))</span>
<span id="cb623-25"><a href="advanced-r-maup-and-more-regression.html#cb623-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb623-26"><a href="advanced-r-maup-and-more-regression.html#cb623-26" aria-hidden="true" tabindex="-1"></a><span class="fu">qtm</span>(justairbnbborough, <span class="at">fill =</span> <span class="st">&quot;airbnbs&quot;</span>)</span></code></pre></div>
<p><img src="CASA0005_files/figure-html/unnamed-chunk-495-1.png" width="672" /></p>
<div class="sourceCode" id="cb624"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb624-1"><a href="advanced-r-maup-and-more-regression.html#cb624-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qtm</span>(justairbnward, <span class="at">fill =</span> <span class="st">&quot;airbnbs&quot;</span>)</span></code></pre></div>
<p><img src="CASA0005_files/figure-html/unnamed-chunk-495-2.png" width="672" /></p>
<p>When should i use a loop?</p>
<p>Well thatâ€™s a hard questionâ€¦generally loops used to be considered inefficient in R, but iâ€™m yet to come across a method that will let you increment one varibale whilst keeping another consistent â€¦by this i mean like what we did in our loop. We changed what spatial data was joined with the Airbnb data â€” the Airbnb data remained the same. There are a few other functions like <code>mapply()</code>, <code>sapply()</code> and <code>tapply()</code> that work in the same format as <code>lapply()</code> but to my knowledge they still will increment all of the variables at the same time.</p>
<p>In terms of code clarity iâ€™m going to refer to <a href="https://r4ds.had.co.nz/iteration.html">section 21.5 on iteration</a> in Wickham $ Grolemund (2017)â€¦</p>
<blockquote>
<p>â€œSome people will tell you to avoid for loops because they are slow. Theyâ€™re wrong! (Well at least theyâ€™re rather out of date, as for loops havenâ€™t been slow for many years). The chief benefits of using â€˜other functionsâ€™ is not speed, but clarity: they make your code easier to write and to readâ€.</p>
</blockquote>
<p>That said, within this course you are not marked on how â€˜goodâ€™ or â€˜efficientâ€™ your code is. Sure, i want you to write great code, but if you are writing code for your assigment or any future project really, my advice is the same. Get something that works and addresses the mark scheme (read the mark scheme!) and then if you have time, improve it later on. There is also a section later on about writing advanced code in the assignment.</p>
</div>
<div id="advanced-mapping-again" class="section level3 hasAnchor" number="10.5.5">
<h3><span class="header-section-number">10.5.5</span> Advanced mapping (again)<a href="advanced-r-maup-and-more-regression.html#advanced-mapping-again" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li>Right, so we can sort of see the difference between the spatial levels (boroughs and wards) but letâ€™s take a closer look within Westminsterâ€¦ here is the â€˜preambleâ€™ for the <code>leaflet</code> map â€¦basically all the stuff we need to set it upâ€¦</li>
</ol>
<div class="sourceCode" id="cb625"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb625-1"><a href="advanced-r-maup-and-more-regression.html#cb625-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(classInt)</span>
<span id="cb625-2"><a href="advanced-r-maup-and-more-regression.html#cb625-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leaflet)</span>
<span id="cb625-3"><a href="advanced-r-maup-and-more-regression.html#cb625-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(leafpop)</span>
<span id="cb625-4"><a href="advanced-r-maup-and-more-regression.html#cb625-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb625-5"><a href="advanced-r-maup-and-more-regression.html#cb625-5" aria-hidden="true" tabindex="-1"></a><span class="co"># extract only westminster from boroughs</span></span>
<span id="cb625-6"><a href="advanced-r-maup-and-more-regression.html#cb625-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb625-7"><a href="advanced-r-maup-and-more-regression.html#cb625-7" aria-hidden="true" tabindex="-1"></a>Borough <span class="ot">&lt;-</span> hold[[<span class="dv">1</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb625-8"><a href="advanced-r-maup-and-more-regression.html#cb625-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NAME<span class="sc">==</span><span class="st">&quot;Westminster&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb625-9"><a href="advanced-r-maup-and-more-regression.html#cb625-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># we need to set the projection to WGS84</span></span>
<span id="cb625-10"><a href="advanced-r-maup-and-more-regression.html#cb625-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># to use with leaflet</span></span>
<span id="cb625-11"><a href="advanced-r-maup-and-more-regression.html#cb625-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(., <span class="at">crs=</span><span class="dv">4326</span>)<span class="sc">%&gt;%</span></span>
<span id="cb625-12"><a href="advanced-r-maup-and-more-regression.html#cb625-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#at the moment each airbnb is a row for the borough</span></span>
<span id="cb625-13"><a href="advanced-r-maup-and-more-regression.html#cb625-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#we just one one row that has number of airbnbs</span></span>
<span id="cb625-14"><a href="advanced-r-maup-and-more-regression.html#cb625-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(., GSS_CODE, NAME)<span class="sc">%&gt;%</span></span>
<span id="cb625-15"><a href="advanced-r-maup-and-more-regression.html#cb625-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">airbnbs =</span> <span class="fu">unique</span>(airbnbs))</span>
<span id="cb625-16"><a href="advanced-r-maup-and-more-regression.html#cb625-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb625-17"><a href="advanced-r-maup-and-more-regression.html#cb625-17" aria-hidden="true" tabindex="-1"></a>wardsatborough <span class="ot">&lt;-</span> hold[[<span class="dv">2</span>]] <span class="sc">%&gt;%</span></span>
<span id="cb625-18"><a href="advanced-r-maup-and-more-regression.html#cb625-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(BOROUGH<span class="sc">==</span><span class="st">&quot;Westminster&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb625-19"><a href="advanced-r-maup-and-more-regression.html#cb625-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># we need to set the projection to WGS84</span></span>
<span id="cb625-20"><a href="advanced-r-maup-and-more-regression.html#cb625-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># to use with leaflet</span></span>
<span id="cb625-21"><a href="advanced-r-maup-and-more-regression.html#cb625-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(., <span class="at">crs=</span><span class="dv">4326</span>)<span class="sc">%&gt;%</span></span>
<span id="cb625-22"><a href="advanced-r-maup-and-more-regression.html#cb625-22" aria-hidden="true" tabindex="-1"></a>  <span class="co">#at the moment each airbnb is a row for the wards</span></span>
<span id="cb625-23"><a href="advanced-r-maup-and-more-regression.html#cb625-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">#we just one one row that has number of airbnbs</span></span>
<span id="cb625-24"><a href="advanced-r-maup-and-more-regression.html#cb625-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(., GSS_CODE, NAME)<span class="sc">%&gt;%</span></span>
<span id="cb625-25"><a href="advanced-r-maup-and-more-regression.html#cb625-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">airbnbs =</span> <span class="fu">unique</span>(airbnbs))</span>
<span id="cb625-26"><a href="advanced-r-maup-and-more-regression.html#cb625-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb625-27"><a href="advanced-r-maup-and-more-regression.html#cb625-27" aria-hidden="true" tabindex="-1"></a><span class="co"># set our breaks for the map</span></span>
<span id="cb625-28"><a href="advanced-r-maup-and-more-regression.html#cb625-28" aria-hidden="true" tabindex="-1"></a>breaks1<span class="ot">&lt;-</span><span class="fu">classIntervals</span>(hold[[<span class="dv">1</span>]]<span class="sc">$</span>airbnbs, </span>
<span id="cb625-29"><a href="advanced-r-maup-and-more-regression.html#cb625-29" aria-hidden="true" tabindex="-1"></a>                        <span class="at">n=</span><span class="dv">5</span>, </span>
<span id="cb625-30"><a href="advanced-r-maup-and-more-regression.html#cb625-30" aria-hidden="true" tabindex="-1"></a>                        <span class="at">style =</span> <span class="st">&quot;quantile&quot;</span>)</span>
<span id="cb625-31"><a href="advanced-r-maup-and-more-regression.html#cb625-31" aria-hidden="true" tabindex="-1"></a>breaks2<span class="ot">&lt;-</span><span class="fu">classIntervals</span>(wardsatborough<span class="sc">$</span>airbnbs, </span>
<span id="cb625-32"><a href="advanced-r-maup-and-more-regression.html#cb625-32" aria-hidden="true" tabindex="-1"></a>                        <span class="at">n=</span><span class="dv">5</span>, </span>
<span id="cb625-33"><a href="advanced-r-maup-and-more-regression.html#cb625-33" aria-hidden="true" tabindex="-1"></a>                        <span class="at">style =</span> <span class="st">&quot;quantile&quot;</span>)</span>
<span id="cb625-34"><a href="advanced-r-maup-and-more-regression.html#cb625-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb625-35"><a href="advanced-r-maup-and-more-regression.html#cb625-35" aria-hidden="true" tabindex="-1"></a><span class="co"># use the breaks to set our colour palettes</span></span>
<span id="cb625-36"><a href="advanced-r-maup-and-more-regression.html#cb625-36" aria-hidden="true" tabindex="-1"></a>pal <span class="ot">&lt;-</span> <span class="fu">colorBin</span>(<span class="at">palette =</span> <span class="st">&quot;YlOrRd&quot;</span>, </span>
<span id="cb625-37"><a href="advanced-r-maup-and-more-regression.html#cb625-37" aria-hidden="true" tabindex="-1"></a>                <span class="at">domain=</span>hold[[<span class="dv">1</span>]]<span class="sc">$</span>airbnbs, </span>
<span id="cb625-38"><a href="advanced-r-maup-and-more-regression.html#cb625-38" aria-hidden="true" tabindex="-1"></a>                <span class="at">bins=</span>breaks1<span class="sc">$</span>brks)</span>
<span id="cb625-39"><a href="advanced-r-maup-and-more-regression.html#cb625-39" aria-hidden="true" tabindex="-1"></a>pal2 <span class="ot">&lt;-</span> <span class="fu">colorBin</span>(<span class="at">palette =</span> <span class="st">&quot;YlOrRd&quot;</span>, </span>
<span id="cb625-40"><a href="advanced-r-maup-and-more-regression.html#cb625-40" aria-hidden="true" tabindex="-1"></a>                 <span class="at">domain=</span>wardsatborough<span class="sc">$</span>airbnbs, </span>
<span id="cb625-41"><a href="advanced-r-maup-and-more-regression.html#cb625-41" aria-hidden="true" tabindex="-1"></a>                 <span class="at">bins=</span>breaks2<span class="sc">$</span>brks)</span>
<span id="cb625-42"><a href="advanced-r-maup-and-more-regression.html#cb625-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb625-43"><a href="advanced-r-maup-and-more-regression.html#cb625-43" aria-hidden="true" tabindex="-1"></a><span class="co"># we want a popup of information too</span></span>
<span id="cb625-44"><a href="advanced-r-maup-and-more-regression.html#cb625-44" aria-hidden="true" tabindex="-1"></a><span class="co"># here we make a new varaible with no </span></span>
<span id="cb625-45"><a href="advanced-r-maup-and-more-regression.html#cb625-45" aria-hidden="true" tabindex="-1"></a><span class="co">#spatial info (remove geometry)</span></span>
<span id="cb625-46"><a href="advanced-r-maup-and-more-regression.html#cb625-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb625-47"><a href="advanced-r-maup-and-more-regression.html#cb625-47" aria-hidden="true" tabindex="-1"></a>wardinfo <span class="ot">&lt;-</span>wardsatborough <span class="sc">%&gt;%</span></span>
<span id="cb625-48"><a href="advanced-r-maup-and-more-regression.html#cb625-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()<span class="sc">%&gt;%</span></span>
<span id="cb625-49"><a href="advanced-r-maup-and-more-regression.html#cb625-49" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Ward =</span> NAME,</span>
<span id="cb625-50"><a href="advanced-r-maup-and-more-regression.html#cb625-50" aria-hidden="true" tabindex="-1"></a>         <span class="at">Airbnbs =</span> airbnbs)<span class="sc">%&gt;%</span></span>
<span id="cb625-51"><a href="advanced-r-maup-and-more-regression.html#cb625-51" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Ward, Airbnbs)<span class="sc">%&gt;%</span></span>
<span id="cb625-52"><a href="advanced-r-maup-and-more-regression.html#cb625-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">popupTable</span>()</span>
<span id="cb625-53"><a href="advanced-r-maup-and-more-regression.html#cb625-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb625-54"><a href="advanced-r-maup-and-more-regression.html#cb625-54" aria-hidden="true" tabindex="-1"></a>boroughinfo <span class="ot">&lt;-</span>wardsatborough <span class="sc">%&gt;%</span></span>
<span id="cb625-55"><a href="advanced-r-maup-and-more-regression.html#cb625-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()<span class="sc">%&gt;%</span></span>
<span id="cb625-56"><a href="advanced-r-maup-and-more-regression.html#cb625-56" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Borough =</span> NAME,</span>
<span id="cb625-57"><a href="advanced-r-maup-and-more-regression.html#cb625-57" aria-hidden="true" tabindex="-1"></a>         <span class="at">Airbnbs =</span> airbnbs)<span class="sc">%&gt;%</span></span>
<span id="cb625-58"><a href="advanced-r-maup-and-more-regression.html#cb625-58" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Borough, Airbnbs)<span class="sc">%&gt;%</span></span>
<span id="cb625-59"><a href="advanced-r-maup-and-more-regression.html#cb625-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">popupTable</span>()</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Now letâ€™s map it using what we just specifiedâ€¦ iâ€™ve added a few more features than were in the <a href="map-making.html#map-making">Map making</a> practical</li>
</ol>
<div class="sourceCode" id="cb626"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb626-1"><a href="advanced-r-maup-and-more-regression.html#cb626-1" aria-hidden="true" tabindex="-1"></a>  wardandboroughs<span class="ot">&lt;-</span> <span class="fu">leaflet</span>() <span class="sc">%&gt;%</span></span>
<span id="cb626-2"><a href="advanced-r-maup-and-more-regression.html#cb626-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add basemap options</span></span>
<span id="cb626-3"><a href="advanced-r-maup-and-more-regression.html#cb626-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addProviderTiles</span>(providers<span class="sc">$</span>Stamen.TonerLite, <span class="at">group =</span> <span class="st">&quot;Toner Lite&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb626-4"><a href="advanced-r-maup-and-more-regression.html#cb626-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addTiles</span>(<span class="at">group =</span> <span class="st">&quot;OSM&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb626-5"><a href="advanced-r-maup-and-more-regression.html#cb626-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb626-6"><a href="advanced-r-maup-and-more-regression.html#cb626-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">#add our Borough polygons, linking to the tables we just made</span></span>
<span id="cb626-7"><a href="advanced-r-maup-and-more-regression.html#cb626-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addPolygons</span>(<span class="at">data=</span>Borough,</span>
<span id="cb626-8"><a href="advanced-r-maup-and-more-regression.html#cb626-8" aria-hidden="true" tabindex="-1"></a>                <span class="at">color=</span><span class="st">&quot;white&quot;</span>, </span>
<span id="cb626-9"><a href="advanced-r-maup-and-more-regression.html#cb626-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">weight =</span> <span class="dv">2</span>,</span>
<span id="cb626-10"><a href="advanced-r-maup-and-more-regression.html#cb626-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">opacity =</span> <span class="dv">1</span>,</span>
<span id="cb626-11"><a href="advanced-r-maup-and-more-regression.html#cb626-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">dashArray =</span> <span class="st">&quot;3&quot;</span>,</span>
<span id="cb626-12"><a href="advanced-r-maup-and-more-regression.html#cb626-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">fillOpacity =</span> <span class="fl">0.7</span>,</span>
<span id="cb626-13"><a href="advanced-r-maup-and-more-regression.html#cb626-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">popup =</span> boroughinfo,</span>
<span id="cb626-14"><a href="advanced-r-maup-and-more-regression.html#cb626-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">fillColor =</span> <span class="sc">~</span><span class="fu">pal</span>(Borough<span class="sc">$</span>airbnbs),</span>
<span id="cb626-15"><a href="advanced-r-maup-and-more-regression.html#cb626-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> <span class="st">&quot;Borough&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb626-16"><a href="advanced-r-maup-and-more-regression.html#cb626-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb626-17"><a href="advanced-r-maup-and-more-regression.html#cb626-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">#add our ward polygons, linking to the tables we just made</span></span>
<span id="cb626-18"><a href="advanced-r-maup-and-more-regression.html#cb626-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addPolygons</span>(<span class="at">data=</span>wardsatborough,</span>
<span id="cb626-19"><a href="advanced-r-maup-and-more-regression.html#cb626-19" aria-hidden="true" tabindex="-1"></a>                <span class="at">color=</span><span class="st">&quot;white&quot;</span>, </span>
<span id="cb626-20"><a href="advanced-r-maup-and-more-regression.html#cb626-20" aria-hidden="true" tabindex="-1"></a>                <span class="at">weight =</span> <span class="dv">2</span>,</span>
<span id="cb626-21"><a href="advanced-r-maup-and-more-regression.html#cb626-21" aria-hidden="true" tabindex="-1"></a>                <span class="at">opacity =</span> <span class="dv">1</span>,</span>
<span id="cb626-22"><a href="advanced-r-maup-and-more-regression.html#cb626-22" aria-hidden="true" tabindex="-1"></a>                <span class="at">dashArray =</span> <span class="st">&quot;3&quot;</span>,</span>
<span id="cb626-23"><a href="advanced-r-maup-and-more-regression.html#cb626-23" aria-hidden="true" tabindex="-1"></a>                <span class="at">fillOpacity =</span> <span class="fl">0.7</span>,</span>
<span id="cb626-24"><a href="advanced-r-maup-and-more-regression.html#cb626-24" aria-hidden="true" tabindex="-1"></a>                <span class="at">popup =</span> wardinfo,</span>
<span id="cb626-25"><a href="advanced-r-maup-and-more-regression.html#cb626-25" aria-hidden="true" tabindex="-1"></a>                <span class="at">fillColor =</span> <span class="sc">~</span><span class="fu">pal2</span>(wardsatborough<span class="sc">$</span>airbnbs),</span>
<span id="cb626-26"><a href="advanced-r-maup-and-more-regression.html#cb626-26" aria-hidden="true" tabindex="-1"></a>                <span class="at">group =</span> <span class="st">&quot;Wards&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb626-27"><a href="advanced-r-maup-and-more-regression.html#cb626-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb626-28"><a href="advanced-r-maup-and-more-regression.html#cb626-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add a legend for wards</span></span>
<span id="cb626-29"><a href="advanced-r-maup-and-more-regression.html#cb626-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addLegend</span>(<span class="at">pal =</span> pal2, </span>
<span id="cb626-30"><a href="advanced-r-maup-and-more-regression.html#cb626-30" aria-hidden="true" tabindex="-1"></a>              <span class="at">values =</span> wardsatborough<span class="sc">$</span>airbnbs,</span>
<span id="cb626-31"><a href="advanced-r-maup-and-more-regression.html#cb626-31" aria-hidden="true" tabindex="-1"></a>              <span class="at">group=</span><span class="fu">c</span>(<span class="st">&quot;Wards&quot;</span>), </span>
<span id="cb626-32"><a href="advanced-r-maup-and-more-regression.html#cb626-32" aria-hidden="true" tabindex="-1"></a>              <span class="at">position =</span><span class="st">&quot;bottomleft&quot;</span>,</span>
<span id="cb626-33"><a href="advanced-r-maup-and-more-regression.html#cb626-33" aria-hidden="true" tabindex="-1"></a>              <span class="at">title =</span><span class="st">&quot;Accom count&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb626-34"><a href="advanced-r-maup-and-more-regression.html#cb626-34" aria-hidden="true" tabindex="-1"></a>     </span>
<span id="cb626-35"><a href="advanced-r-maup-and-more-regression.html#cb626-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># add a legend for boroughs</span></span>
<span id="cb626-36"><a href="advanced-r-maup-and-more-regression.html#cb626-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">addLegend</span>(<span class="at">pal =</span> pal, </span>
<span id="cb626-37"><a href="advanced-r-maup-and-more-regression.html#cb626-37" aria-hidden="true" tabindex="-1"></a>              <span class="at">values =</span> Borough,</span>
<span id="cb626-38"><a href="advanced-r-maup-and-more-regression.html#cb626-38" aria-hidden="true" tabindex="-1"></a>              <span class="at">group=</span><span class="fu">c</span>(<span class="st">&quot;Borough&quot;</span>), </span>
<span id="cb626-39"><a href="advanced-r-maup-and-more-regression.html#cb626-39" aria-hidden="true" tabindex="-1"></a>              <span class="at">title =</span><span class="st">&quot;Accom count&quot;</span>,</span>
<span id="cb626-40"><a href="advanced-r-maup-and-more-regression.html#cb626-40" aria-hidden="true" tabindex="-1"></a>              <span class="at">position =</span><span class="st">&quot;bottomleft&quot;</span>)<span class="sc">%&gt;%</span></span>
<span id="cb626-41"><a href="advanced-r-maup-and-more-regression.html#cb626-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb626-42"><a href="advanced-r-maup-and-more-regression.html#cb626-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># specify layers control</span></span>
<span id="cb626-43"><a href="advanced-r-maup-and-more-regression.html#cb626-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">addLayersControl</span>(</span>
<span id="cb626-44"><a href="advanced-r-maup-and-more-regression.html#cb626-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">baseGroups =</span> <span class="fu">c</span>(<span class="st">&quot;Toner Lite&quot;</span>, <span class="st">&quot;OSM&quot;</span>),</span>
<span id="cb626-45"><a href="advanced-r-maup-and-more-regression.html#cb626-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">overlayGroups =</span> <span class="fu">c</span>(<span class="st">&quot;Borough&quot;</span>, <span class="st">&quot;Wards&quot;</span>),</span>
<span id="cb626-46"><a href="advanced-r-maup-and-more-regression.html#cb626-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">options =</span> <span class="fu">layersControlOptions</span>(<span class="at">collapsed =</span> <span class="cn">FALSE</span>))<span class="sc">%&gt;%</span></span>
<span id="cb626-47"><a href="advanced-r-maup-and-more-regression.html#cb626-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hideGroup</span>(<span class="fu">c</span>(<span class="st">&quot;Borough&quot;</span>))</span>
<span id="cb626-48"><a href="advanced-r-maup-and-more-regression.html#cb626-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb626-49"><a href="advanced-r-maup-and-more-regression.html#cb626-49" aria-hidden="true" tabindex="-1"></a><span class="co"># show us the map</span></span>
<span id="cb626-50"><a href="advanced-r-maup-and-more-regression.html#cb626-50" aria-hidden="true" tabindex="-1"></a>wardandboroughs</span></code></pre></div>
<p>Have a look around the mapâ€¦Westminster borough uses a scale considering all other London borough values, whilst the ward scale is specific to Westminster. Use the following code to explore the valuesâ€¦</p>
<div class="sourceCode" id="cb627"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb627-1"><a href="advanced-r-maup-and-more-regression.html#cb627-1" aria-hidden="true" tabindex="-1"></a><span class="co"># range of Airbnbs per ward in Westminster</span></span>
<span id="cb627-2"><a href="advanced-r-maup-and-more-regression.html#cb627-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb627-3"><a href="advanced-r-maup-and-more-regression.html#cb627-3" aria-hidden="true" tabindex="-1"></a>Range<span class="ot">&lt;-</span>wardsatborough <span class="sc">%&gt;%</span></span>
<span id="cb627-4"><a href="advanced-r-maup-and-more-regression.html#cb627-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Max =</span> <span class="fu">max</span>(airbnbs),</span>
<span id="cb627-5"><a href="advanced-r-maup-and-more-regression.html#cb627-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">Min =</span> <span class="fu">min</span> (airbnbs))</span></code></pre></div>
</div>
</div>
<div id="regression-relationships" class="section level2 hasAnchor" number="10.6">
<h2><span class="header-section-number">10.6</span> Regression relationships<a href="advanced-r-maup-and-more-regression.html#regression-relationships" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<blockquote>
<p><strong>Warning</strong> The data used within this practical is purely for demonstration purposes!</p>
</blockquote>
<div id="preprocessing" class="section level3 hasAnchor" number="10.6.1">
<h3><span class="header-section-number">10.6.1</span> Preprocessing<a href="advanced-r-maup-and-more-regression.html#preprocessing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this part of the practical weâ€™re going to try and model the relationship between the Airbnb counts at ward level and other variables. Our mini investagion here would be to see if itâ€™s possible to produce a statisitcally valid and rigorous model for predicting Airbnb values at the ward level. This type of analysis might be useful if you had missing or limited data at one spatial level (e.g.Â wards) but had a more complete dataset at a larger spatial scale (e.g.Â boroughs). Essentially, weâ€™re trying to use the data at the borough level to give us an estiamte of the data at the ward level. Obviously this isnâ€™t an issue for us here but if you ever use survey data or any kind of count data (e.g.Â health) if may well be limited to specific areasâ€¦</p>
<p>This section will also show you how to make/ use different regression models in R. Regression aims to find a mathematical equation to predict a value (in this case Airbnb at ward level) from one (or more) predictor variables (e.g.Â borough data). So weâ€™ll use values of X (borough data) to predict values of Y (ward data)â€¦</p>
<p><img src="prac10_images/linear_regression.png" width="400" style="display: block; margin: auto;" /></p>
<p>This can be represented with the equation:</p>
<p><span class="math display">\[Y = \beta_{1} + \beta_{2} X + \epsilon\]</span>
Where <span class="math inline">\(\beta_{1}\)</span> is the intercept (expected value of Y when X=0, also called bias in machine learning), <span class="math inline">\(\beta_{2}\)</span> is the slope of the line and <span class="math inline">\(\epsilon\)</span> is the error term, the part that the model is unable to explain (and variables are not included)â€¦Here we would call the intercept and slop coefficients.</p>
<ol style="list-style-type: decimal">
<li>To start with weâ€™re going to crop our wards data to our boroughs data. In the borough data you can see the river Thames which isnâ€™t in the wards data. I donâ€™t think this is technically required, but itâ€™s good practice to make sure you datasets align and if they donâ€™t to do something about itâ€¦</li>
</ol>
<div class="sourceCode" id="cb628"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb628-1"><a href="advanced-r-maup-and-more-regression.html#cb628-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmaptools)</span>
<span id="cb628-2"><a href="advanced-r-maup-and-more-regression.html#cb628-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb628-3"><a href="advanced-r-maup-and-more-regression.html#cb628-3" aria-hidden="true" tabindex="-1"></a>cropped <span class="ot">&lt;-</span> justairbnbborough <span class="sc">%&gt;%</span></span>
<span id="cb628-4"><a href="advanced-r-maup-and-more-regression.html#cb628-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">crop_shape</span>(justairbnward,., <span class="at">polygon =</span> <span class="cn">TRUE</span>)</span>
<span id="cb628-5"><a href="advanced-r-maup-and-more-regression.html#cb628-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb628-6"><a href="advanced-r-maup-and-more-regression.html#cb628-6" aria-hidden="true" tabindex="-1"></a><span class="co"># something like this would just extract the </span></span>
<span id="cb628-7"><a href="advanced-r-maup-and-more-regression.html#cb628-7" aria-hidden="true" tabindex="-1"></a><span class="co"># values within the shape, but not clip like a cookie cutter</span></span>
<span id="cb628-8"><a href="advanced-r-maup-and-more-regression.html#cb628-8" aria-hidden="true" tabindex="-1"></a><span class="co"># we want to use the borough layer to cut out the river from </span></span>
<span id="cb628-9"><a href="advanced-r-maup-and-more-regression.html#cb628-9" aria-hidden="true" tabindex="-1"></a><span class="co"># the wards layer</span></span>
<span id="cb628-10"><a href="advanced-r-maup-and-more-regression.html#cb628-10" aria-hidden="true" tabindex="-1"></a><span class="do">###test &lt;- hold[[2]][hold[[1]],]</span></span>
<span id="cb628-11"><a href="advanced-r-maup-and-more-regression.html#cb628-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb628-12"><a href="advanced-r-maup-and-more-regression.html#cb628-12" aria-hidden="true" tabindex="-1"></a><span class="co"># check it worked, you should be </span></span>
<span id="cb628-13"><a href="advanced-r-maup-and-more-regression.html#cb628-13" aria-hidden="true" tabindex="-1"></a><span class="co">#able to see the river</span></span>
<span id="cb628-14"><a href="advanced-r-maup-and-more-regression.html#cb628-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb628-15"><a href="advanced-r-maup-and-more-regression.html#cb628-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">st_geometry</span>(cropped))</span></code></pre></div>
<p><img src="CASA0005_files/figure-html/unnamed-chunk-500-1.png" width="672" /></p>
<ol style="list-style-type: decimal">
<li>Now we need to join our wards data and borough data togther to give us a borough value for each ward withinâ€¦</li>
</ol>
<div class="sourceCode" id="cb629"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb629-1"><a href="advanced-r-maup-and-more-regression.html#cb629-1" aria-hidden="true" tabindex="-1"></a><span class="co"># join wards and boroughs</span></span>
<span id="cb629-2"><a href="advanced-r-maup-and-more-regression.html#cb629-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb629-3"><a href="advanced-r-maup-and-more-regression.html#cb629-3" aria-hidden="true" tabindex="-1"></a>joined <span class="ot">&lt;-</span> justairbnbborough <span class="sc">%&gt;%</span></span>
<span id="cb629-4"><a href="advanced-r-maup-and-more-regression.html#cb629-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_join</span>(., justairbnward, <span class="at">join=</span>st_contains)<span class="sc">%&gt;%</span></span>
<span id="cb629-5"><a href="advanced-r-maup-and-more-regression.html#cb629-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(., <span class="at">Boroughcount =</span> airbnbs.x, </span>
<span id="cb629-6"><a href="advanced-r-maup-and-more-regression.html#cb629-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">Wardcount =</span> airbnbs.y)</span></code></pre></div>
</div>
<div id="scatter-plot" class="section level3 hasAnchor" number="10.6.2">
<h3><span class="header-section-number">10.6.2</span> Scatter plot<a href="advanced-r-maup-and-more-regression.html#scatter-plot" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li>To start with letâ€™s just visualise the relationship between the borough an ward count using a scatter plot. If you have multiple predictor variables (explied later on) a plot will be drawn for each of themâ€¦</li>
</ol>
<div class="sourceCode" id="cb630"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb630-1"><a href="advanced-r-maup-and-more-regression.html#cb630-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(joined, <span class="fu">aes</span>(Boroughcount, Wardcount))<span class="sc">+</span></span>
<span id="cb630-2"><a href="advanced-r-maup-and-more-regression.html#cb630-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb630-3"><a href="advanced-r-maup-and-more-regression.html#cb630-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Borough count&quot;</span>)<span class="sc">+</span></span>
<span id="cb630-4"><a href="advanced-r-maup-and-more-regression.html#cb630-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Ward count&quot;</span>)</span></code></pre></div>
<p>The scatter plot shows some kind of linear relationship. The point variation around borough count is beacuse for each borough the wards will have a range of valuesâ€¦like we saw in the interactive mapâ€¦Westminster borough had a value of 9410 and the wards ranged from 159 to 1215</p>
</div>
<div id="outliers" class="section level3 hasAnchor" number="10.6.3">
<h3><span class="header-section-number">10.6.3</span> Outliers<a href="advanced-r-maup-and-more-regression.html#outliers" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li>Generally any point that is outside 1.5* the interquartile-range (or IQR) is considered an outlier (a data point that differs significantly from all others) and you could use something like the methods here to remove and replace themâ€¦the IQR is the distance between the 25th and 75th percentile..</li>
</ol>
<div class="sourceCode" id="cb631"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb631-1"><a href="advanced-r-maup-and-more-regression.html#cb631-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>))  <span class="co"># divide graph area in 2 columns</span></span>
<span id="cb631-2"><a href="advanced-r-maup-and-more-regression.html#cb631-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb631-3"><a href="advanced-r-maup-and-more-regression.html#cb631-3" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(joined<span class="sc">$</span>Boroughcount, <span class="at">main=</span><span class="st">&quot;Boroughs&quot;</span>)</span>
<span id="cb631-4"><a href="advanced-r-maup-and-more-regression.html#cb631-4" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(joined<span class="sc">$</span>Wardcount, <span class="at">main=</span><span class="st">&quot;Wards&quot;</span>)</span></code></pre></div>
<p><img src="CASA0005_files/figure-html/unnamed-chunk-503-1.png" width="672" /></p>
<blockquote>
<p><strong>Warning</strong> The data used within this practical is purely for demonstration purposes! These box plots indicate that our data is not normally distributed so you might want to refer to the assumptions in last weekâ€™s practical if you were to do this propperly.</p>
</blockquote>
</div>
<div id="correlation" class="section level3 hasAnchor" number="10.6.4">
<h3><span class="header-section-number">10.6.4</span> Correlation<a href="advanced-r-maup-and-more-regression.html#correlation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li>Correlation letâ€™s use see the level of linear dependence between two varaibles between -1 and 1. High values (towards 1) mean that for every x instance there is an increase in y. Low values (towards -1) mean the opposite.</li>
</ol>
<div class="sourceCode" id="cb632"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb632-1"><a href="advanced-r-maup-and-more-regression.html#cb632-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrr)</span>
<span id="cb632-2"><a href="advanced-r-maup-and-more-regression.html#cb632-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb632-3"><a href="advanced-r-maup-and-more-regression.html#cb632-3" aria-hidden="true" tabindex="-1"></a>Correlation <span class="ot">&lt;-</span> joined <span class="sc">%&gt;%</span></span>
<span id="cb632-4"><a href="advanced-r-maup-and-more-regression.html#cb632-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()<span class="sc">%&gt;%</span></span>
<span id="cb632-5"><a href="advanced-r-maup-and-more-regression.html#cb632-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Boroughcount,</span>
<span id="cb632-6"><a href="advanced-r-maup-and-more-regression.html#cb632-6" aria-hidden="true" tabindex="-1"></a>                Wardcount)<span class="sc">%&gt;%</span></span>
<span id="cb632-7"><a href="advanced-r-maup-and-more-regression.html#cb632-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">correlate</span>() <span class="sc">%&gt;%</span></span>
<span id="cb632-8"><a href="advanced-r-maup-and-more-regression.html#cb632-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code></pre></div>
<pre><code>## # A tibble: 2 Ã— 3
##   term         Boroughcount Wardcount
##   &lt;chr&gt;               &lt;dbl&gt;     &lt;dbl&gt;
## 1 Boroughcount       NA         0.780
## 2 Wardcount           0.780    NA</code></pre>
<ol style="list-style-type: decimal">
<li>Looks, like weâ€™ve got a strong relationship.</li>
</ol>
</div>
<div id="linear-model" class="section level3 hasAnchor" number="10.6.5">
<h3><span class="header-section-number">10.6.5</span> Linear model<a href="advanced-r-maup-and-more-regression.html#linear-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li>Now letâ€™s use a linear model to establish a relationship between predictor and response with the function <code>lm()</code>. Here we are calling the <code>lm()(then stating the Formula, then the data)</code></li>
</ol>
<div class="sourceCode" id="cb634"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb634-1"><a href="advanced-r-maup-and-more-regression.html#cb634-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb634-2"><a href="advanced-r-maup-and-more-regression.html#cb634-2" aria-hidden="true" tabindex="-1"></a>linearMod <span class="ot">&lt;-</span> <span class="fu">lm</span>(Wardcount <span class="sc">~</span> </span>
<span id="cb634-3"><a href="advanced-r-maup-and-more-regression.html#cb634-3" aria-hidden="true" tabindex="-1"></a>                  Boroughcount, </span>
<span id="cb634-4"><a href="advanced-r-maup-and-more-regression.html#cb634-4" aria-hidden="true" tabindex="-1"></a>                <span class="at">data=</span>joined)</span>
<span id="cb634-5"><a href="advanced-r-maup-and-more-regression.html#cb634-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-6"><a href="advanced-r-maup-and-more-regression.html#cb634-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tidy</span>(linearMod)</span></code></pre></div>
<pre><code>## # A tibble: 2 Ã— 5
##   term         estimate std.error statistic   p.value
##   &lt;chr&gt;           &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
## 1 (Intercept)   -7.86     4.86        -1.62 1.07e-  1
## 2 Boroughcount   0.0543   0.00185     29.3  1.40e-114</code></pre>
<p>So from this output we have the coefficients of intercept and Boroughcount, going back to our formula from earlier this would meanâ€¦</p>
<p><span class="math display">\[Wardcount = -3.8188 + 0.0541*Boroughcount\]</span></p>
</div>
<div id="linear-model-outputs" class="section level3 hasAnchor" number="10.6.6">
<h3><span class="header-section-number">10.6.6</span> Linear model outputs<a href="advanced-r-maup-and-more-regression.html#linear-model-outputs" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Coefficient Estimates</strong></p>
<p>Our intercept, the expected value of Y when X=0 is -3.8 and slope is 0.054.</p>
<p><strong>Standard error</strong></p>
<p>The coefficient standard error represents the average amount that coeffieint estimates vary from the average of our response. It basically shows the expected range if we were to model again and again. So here, for a 1% increase in the number of Airbnbs per ward by 0.05, but this might vary by 0.001. Ideally the standard error is lower than the size of the coeffeicient (0.001 is lower the 0.05)</p>
<p><strong>p-value</strong></p>
<p>A linear model is only statistically significant when both p-values are &lt;0.05 within the summary call. There are two values as one if for the coefficient (is the specific coefficient significant) and the other is for the model (is the model significant). Here as they both are, this would allow us to accept the alternative hypothesis that the coefficients are not equal to 0 (and therefore there is a relationship between the independent and dependent variabile).</p>
<p><strong>R-squared</strong></p>
<p>R squared represents the proportion of variance of the dependent variable that is explained by the independent. It is different from correlation as that is the strength of the relationship!!! R squared is often referred to as â€˜goodness-of-fitâ€™. Here 61% of the variance in Airbnb ward count can be explained by the varaition in Airbnb borough count.</p>
<p>But there are a few issues with R squared â€” every time you add a predictor to the model R squared will increase and if there are too many predictors it will model random noise</p>
<p><strong>Adjusted R squared</strong></p>
<p>Adjusted R squared consideres the number of variables within the model, increasing only if the new term assits by more than just chance.</p>
<p><strong>t</strong></p>
<p>Coefficient t shows how many standard deviations the coefficient estaimte is away from 0 â€” the further away means the more likely we can reject the null hypothesis. It is calcaulted by dividing the value of the coeffeicient by the standard error</p>
<p><strong>Residual error</strong></p>
<p>Residual standard error is a measure of the quality of fit of the linear regression line. It is an average of the error that the points differ out from the line.</p>
<p><strong>F</strong></p>
<p>F-statistcs, basically, the futher from 1 the better it is.</p>
<p>See <a href="https://feliperego.github.io/blog/2015/10/23/Interpreting-Model-Output-In-R">this guide</a> for more information on the outputs</p>
<p>Remember the formula produced from the regression equation, well we can also extract this automatically â€¦to make that original formula in RMarkdown I used this (not within a code chunk)â€¦.</p>
<div class="sourceCode" id="cb636"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb636-1"><a href="advanced-r-maup-and-more-regression.html#cb636-1" aria-hidden="true" tabindex="-1"></a><span class="sc">$</span><span class="er">$</span>Wardcount <span class="ot">=</span> <span class="sc">-</span><span class="fl">3.8188</span> <span class="sc">+</span> <span class="fl">0.0541</span><span class="sc">*</span>Boroughcount<span class="sc">$</span><span class="er">$</span></span></code></pre></div>
<p>But we can also extract it directly using a new package from GitHubâ€¦</p>
<div class="sourceCode" id="cb637"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb637-1"><a href="advanced-r-maup-and-more-regression.html#cb637-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load remotes so we can get the new package</span></span>
<span id="cb637-2"><a href="advanced-r-maup-and-more-regression.html#cb637-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(remotes)</span></code></pre></div>
<div class="sourceCode" id="cb638"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb638-1"><a href="advanced-r-maup-and-more-regression.html#cb638-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the new package equatiomatic()</span></span>
<span id="cb638-2"><a href="advanced-r-maup-and-more-regression.html#cb638-2" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;datalorax/equatiomatic&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb639"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb639-1"><a href="advanced-r-maup-and-more-regression.html#cb639-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load it</span></span>
<span id="cb639-2"><a href="advanced-r-maup-and-more-regression.html#cb639-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(equatiomatic)</span>
<span id="cb639-3"><a href="advanced-r-maup-and-more-regression.html#cb639-3" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the info to make the equation</span></span>
<span id="cb639-4"><a href="advanced-r-maup-and-more-regression.html#cb639-4" aria-hidden="true" tabindex="-1"></a><span class="fu">extract_eq</span>(linearMod)</span></code></pre></div>
<p><span class="math display">\[
\operatorname{Wardcount} = \alpha + \beta_{1}(\operatorname{Boroughcount}) + \epsilon
\]</span></p>
<p>Play around with line length and use the actual coefficient names</p>
<div class="sourceCode" id="cb640"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb640-1"><a href="advanced-r-maup-and-more-regression.html#cb640-1" aria-hidden="true" tabindex="-1"></a><span class="fu">extract_eq</span>(linearMod, <span class="at">use_coefs =</span> <span class="cn">TRUE</span>, <span class="at">wrap=</span><span class="cn">TRUE</span>, <span class="at">terms_per_line =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><span class="math display">\[
\begin{aligned}
\operatorname{\widehat{Wardcount}} &amp;= -7.86 + 0.05(\operatorname{Boroughcount})
\end{aligned}
\]</span></p>
<p>This would produce the following in RMarkdownâ€¦.</p>
<p><span class="math display">\[
\begin{aligned}
\text{Wardcount} &amp;= -3.82 + 0.05(\text{Boroughcount})\ + \\
&amp;\quad \epsilon
\end{aligned}
\]</span></p>
<p>Have a <a href="https://github.com/datalorax/equatiomatic">look here</a> for more information on using <code>equatiomatic()</code>.</p>
</div>
<div id="validation" class="section level3 hasAnchor" number="10.6.7">
<h3><span class="header-section-number">10.6.7</span> Validation<a href="advanced-r-maup-and-more-regression.html#validation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li>Weâ€™ve made a regression model using all of our data but there is now no way to test its validityâ€¦what if we take 20% as a test sample and use the remaining 80% to train itâ€¦</li>
</ol>
<div class="sourceCode" id="cb641"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb641-1"><a href="advanced-r-maup-and-more-regression.html#cb641-1" aria-hidden="true" tabindex="-1"></a>joinedID <span class="ot">&lt;-</span> joined <span class="sc">%&gt;%</span> </span>
<span id="cb641-2"><a href="advanced-r-maup-and-more-regression.html#cb641-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()<span class="sc">%&gt;%</span></span>
<span id="cb641-3"><a href="advanced-r-maup-and-more-regression.html#cb641-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Wardcount =</span> <span class="fu">replace_na</span>(Wardcount, <span class="dv">0</span>))<span class="sc">%&gt;%</span></span>
<span id="cb641-4"><a href="advanced-r-maup-and-more-regression.html#cb641-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">row_number</span>())</span>
<span id="cb641-5"><a href="advanced-r-maup-and-more-regression.html#cb641-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create training 80% index</span></span>
<span id="cb641-6"><a href="advanced-r-maup-and-more-regression.html#cb641-6" aria-hidden="true" tabindex="-1"></a>train <span class="ot">&lt;-</span> joinedID <span class="sc">%&gt;%</span> </span>
<span id="cb641-7"><a href="advanced-r-maup-and-more-regression.html#cb641-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sample_frac</span>(.<span class="dv">70</span>)</span>
<span id="cb641-8"><a href="advanced-r-maup-and-more-regression.html#cb641-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create test set</span></span>
<span id="cb641-9"><a href="advanced-r-maup-and-more-regression.html#cb641-9" aria-hidden="true" tabindex="-1"></a>test  <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(joinedID, </span>
<span id="cb641-10"><a href="advanced-r-maup-and-more-regression.html#cb641-10" aria-hidden="true" tabindex="-1"></a>                   train, </span>
<span id="cb641-11"><a href="advanced-r-maup-and-more-regression.html#cb641-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">by =</span> <span class="st">&#39;id&#39;</span>)</span></code></pre></div>
<p>Now letâ€™s build the modelâ€¦</p>
<div class="sourceCode" id="cb642"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb642-1"><a href="advanced-r-maup-and-more-regression.html#cb642-1" aria-hidden="true" tabindex="-1"></a><span class="co"># build the model</span></span>
<span id="cb642-2"><a href="advanced-r-maup-and-more-regression.html#cb642-2" aria-hidden="true" tabindex="-1"></a>lmMod <span class="ot">&lt;-</span> <span class="fu">lm</span>(Wardcount <span class="sc">~</span> Boroughcount, </span>
<span id="cb642-3"><a href="advanced-r-maup-and-more-regression.html#cb642-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">data=</span>train)  </span>
<span id="cb642-4"><a href="advanced-r-maup-and-more-regression.html#cb642-4" aria-hidden="true" tabindex="-1"></a><span class="co"># use the model to make some predicitons with our test data</span></span>
<span id="cb642-5"><a href="advanced-r-maup-and-more-regression.html#cb642-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb642-6"><a href="advanced-r-maup-and-more-regression.html#cb642-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb642-7"><a href="advanced-r-maup-and-more-regression.html#cb642-7" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> lmMod <span class="sc">%&gt;%</span> </span>
<span id="cb642-8"><a href="advanced-r-maup-and-more-regression.html#cb642-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(test)</span>
<span id="cb642-9"><a href="advanced-r-maup-and-more-regression.html#cb642-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb642-10"><a href="advanced-r-maup-and-more-regression.html#cb642-10" aria-hidden="true" tabindex="-1"></a><span class="co"># get R2, RMSE and MAE</span></span>
<span id="cb642-11"><a href="advanced-r-maup-and-more-regression.html#cb642-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb642-12"><a href="advanced-r-maup-and-more-regression.html#cb642-12" aria-hidden="true" tabindex="-1"></a>stats<span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">R2 =</span> <span class="fu">R2</span>(predictions, test<span class="sc">$</span>Wardcount),</span>
<span id="cb642-13"><a href="advanced-r-maup-and-more-regression.html#cb642-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">RMSE =</span> <span class="fu">RMSE</span>(predictions, test<span class="sc">$</span>Wardcount),</span>
<span id="cb642-14"><a href="advanced-r-maup-and-more-regression.html#cb642-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">MAE =</span> <span class="fu">MAE</span>(predictions, test<span class="sc">$</span>Wardcount))</span>
<span id="cb642-15"><a href="advanced-r-maup-and-more-regression.html#cb642-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb642-16"><a href="advanced-r-maup-and-more-regression.html#cb642-16" aria-hidden="true" tabindex="-1"></a>t</span></code></pre></div>
<pre><code>## $type
## [1] &quot;lag&quot;
## 
## $dvars
## [1] 3 0
## 
## $rho
##        rho 
## 0.00515683 
## 
## $coefficients
##                                      (Intercept) 
##                                        202.34273 
## unauthorised_absence_in_all_schools_percent_2013 
##                                        -36.17560 
##                     log(median_house_price_2014) 
##                                         12.58783 
## 
## $rest.se
##                                      (Intercept) 
##                                        20.098676 
## unauthorised_absence_in_all_schools_percent_2013 
##                                         1.913596 
##                     log(median_house_price_2014) 
##                                         1.532730 
## 
## $LL
##           [,1]
## [1,] -2603.509
## 
## $s2
## [1] 239.8558
## 
## $SSE
## [1] 150149.8
## 
## $parameters
## [1] 5
## 
## $logLik_lm.model
## &#39;log Lik.&#39; -2603.74 (df=4)
## 
## $AIC_lm.model
## [1] 5215.479
## 
## $method
## [1] &quot;eigen&quot;
## 
## $call
## lagsarlm(formula = average_gcse_capped_point_scores_2014 ~ unauthorised_absence_in_all_schools_percent_2013 + 
##     log(median_house_price_2014), data = LonWardProfiles, listw = nb2listw(LWard_nb, 
##     style = &quot;C&quot;), method = &quot;eigen&quot;)
## 
## $residuals
##            1            2            3            4            5            6 
## -11.73596188  -0.63367392  -4.47433117   1.05446013  29.15335285   2.24902862 
##            7            8            9           10           11           12 
## -26.04107211  17.49757641   6.20390185 -11.27659527 -20.34103735  21.22211842 
##           13           14           15           16           17           18 
##  -5.23278885  20.80499949   5.52027405  27.02634870   3.05977914   1.05963172 
##           19           20           21           22           23           24 
##  13.00380955  -1.31276626   6.02027518  14.49871272  10.08022960  -5.01419859 
##           25           26           27           28           29           30 
##  11.25844001   8.18449918   8.39518643  -0.97833562   1.35512117   5.84356494 
##           31           32           33           34           35           36 
##  24.36933763 -13.28311774  -7.71192814  15.62712259  -4.70575162 -14.18589368 
##           37           38           39           40           41           42 
## -11.74168137   3.14444057   6.02401011   9.05385707  13.00023605   5.86640792 
##           43           44           45           46           47           48 
##   5.77720242  26.77569553 -12.53706722  12.28006770   0.39409040   2.13279085 
##           49           50           51           52           53           54 
##  14.55879605  23.63618774  -3.10838711  12.50485863  13.35240463 -23.41062118 
##           55           56           57           58           59           60 
##  -0.17617091   4.32527534   0.94332276   1.88269173  -2.33442524   0.90872880 
##           61           62           63           64           65           66 
## -10.22774422  -1.45359853   5.62429294 -13.42480188   2.35698770  -7.08197093 
##           67           68           69           70           71           72 
##   4.15516674  12.65958747  34.68404506   0.81886559  -8.17850936  -2.12733278 
##           73           74           75           76           77           78 
##  -3.78843487   4.49161244  26.43232854  13.28627188  16.62704835  16.41800806 
##           79           80           81           82           83           84 
##  -3.13749891  24.49842989   4.87497974   7.48232527 -12.26161561 -14.23783225 
##           85           86           87           88           89           90 
##   0.49204980 -27.38220170  -9.41819058  -9.09676623  19.04159349 -14.26257866 
##           91           92           93           94           95           96 
##  -5.14806595 -18.09914157  18.10471774   4.49869983 -23.81521703  -5.39536194 
##           97           98           99          100          101          102 
##  -1.13169931 -12.27866617   3.10485601   7.88675828  10.29082601 -10.49954891 
##          103          104          105          106          107          108 
##  11.84127927   1.26669641  -3.90708623  -0.18167234 -26.51923634 -19.22363401 
##          109          110          111          112          113          114 
##   0.64691258 -15.15456773 -15.77603648  -7.22908316 -15.93473561  -3.22566210 
##          115          116          117          118          119          120 
##  -8.34262931   4.62823504  -5.50442756 -35.62135928  -5.15278054 -18.68032511 
##          121          122          123          124          125          126 
##  -9.19974144 -16.18254267   0.33302710   8.73664089 -19.34332437  -8.70599129 
##          127          128          129          130          131          132 
## -14.56345206 -11.06120452 -20.38402010   6.15954251 -11.45029964   8.17507594 
##          133          134          135          136          137          138 
##  -2.34716913  -3.67695219 -12.02074889   3.77804302  -3.67035497 -12.53693550 
##          139          140          141          142          143          144 
##  11.81400534  -5.46388704   4.63616909 -10.15217090  -3.01939119  -2.55665210 
##          145          146          147          148          149          150 
##  -4.76869556  -0.38301327   7.32765800  -4.70588040   9.34299217  -7.59391929 
##          151          152          153          154          155          156 
##   9.35807409  -6.14061331   1.63166188 -20.45263569  -0.01966676  12.85690648 
##          157          158          159          160          161          162 
##  -8.60261314  17.03117618  11.83044250   9.51725704  -0.39801217  -4.58395893 
##          163          164          165          166          167          168 
##  10.03851371  -2.93515090 -12.87180862  -5.21244079   2.50688738 -18.05673508 
##          169          170          171          172          173          174 
##  14.13926036  -8.12925755  -3.58840627  -6.33080059  -5.25393078   6.85679756 
##          175          176          177          178          179          180 
##   1.26183159 -22.08363968  -7.10247612 -26.28876766   5.31501433  25.84206943 
##          181          182          183          184          185          186 
## -12.41408445 -13.06714215  17.90416472 -21.31596282 -21.54087347 -10.64975492 
##          187          188          189          190          191          192 
##  -4.66893454  -5.51807410   8.62098628   8.26492515   7.63956672  -8.51361154 
##          193          194          195          196          197          198 
##   5.69751711  17.57164132  19.56895517  11.30224668  -4.60742469  26.37547928 
##          199          200          201          202          203          204 
##  -8.20531617  22.02881634  10.13406331  20.35606769  11.10469064   0.65883544 
##          205          206          207          208          209          210 
##  -5.76308185  -3.30617216  24.35579540  28.42876343   1.59128766  24.02661651 
##          211          212          213          214          215          216 
##  -5.99698366   0.36273529 -10.22450619  -5.66661097 -39.83547997 -14.37639212 
##          217          218          219          220          221          222 
## -31.46491922 -14.23016264 -24.04502527 -18.02507332 -19.70110107  -5.76660004 
##          223          224          225          226          227          228 
##  -6.68044566 -15.24376368  -3.60437641  -6.78826782 -24.00693189 -15.93894984 
##          229          230          231          232          233          234 
##  -3.36772289  -5.09756179 -15.11679903  -4.23930242  -8.35121675   2.82986457 
##          235          236          237          238          239          240 
##  -8.26575530 -18.70659173  -1.63958172 -18.43150433  -3.14638306  -4.64890703 
##          241          242          243          244          245          246 
##   1.01545737   0.22420050   6.22456167  -1.51936363  -1.10154799  -4.89699119 
##          247          248          249          250          251          252 
##   3.86203453 -18.43948834   2.82418276  -8.71139524 -13.23177072 -23.30562773 
##          253          254          255          256          257          258 
## -15.31497895  -7.45819671 -19.38795372  -5.82334621   8.73681650 -11.27202743 
##          259          260          261          262          263          264 
## -20.89339412 -15.86032416 -17.42659969  -2.16888100 -12.67528983  -0.99558746 
##          265          266          267          268          269          270 
## -17.61840778   1.46212387   4.24021234  -7.49150807  31.41163606 -15.11718233 
##          271          272          273          274          275          276 
##  33.27890475  -5.16620960 -12.48535561   9.55096517  -7.06138517   5.60431683 
##          277          278          279          280          281          282 
##   3.35892855  10.00613367  -0.24279715   1.98749487  -0.99644942  -0.54977223 
##          283          284          285          286          287          288 
##  23.51786606  -2.30559168 -15.64141691  13.19804320   0.01126631  -0.81575397 
##          289          290          291          292          293          294 
##  11.31061415  13.35048667 -13.86711366 -21.26905716  -0.71288623 -13.96565102 
##          295          296          297          298          299          300 
## -16.16338836   2.54222262   3.47695493   3.63282562  11.86117056  10.37041425 
##          301          302          303          304          305          306 
##  -9.36264754 -20.19023204  -2.78808326  -5.22584620 -25.54417888 -28.87770772 
##          307          308          309          310          311          312 
##   4.14588146   9.01415391   3.66790032  14.16444846   2.17223518   7.78877776 
##          313          314          315          316          317          318 
##  11.89991997  23.51794698  31.86682124   3.87704507  11.56594306  12.90897733 
##          319          320          321          322          323          324 
##   5.73957259  11.11235307  24.77414899  22.24195226  20.82083758 -10.99367660 
##          325          326          327          328          329          330 
##  19.66040334  18.95442353  25.41577070 -11.81306636   7.01775661 -17.10079414 
##          331          332          333          334          335          336 
##   6.80494684   4.63342283   2.23394188   5.07547816 -14.97450090  -9.66970674 
##          337          338          339          340          341          342 
## -19.71794256 -10.53193502  -4.33114260   0.82801409 -10.45460599  -4.28383786 
##          343          344          345          346          347          348 
##   2.41787591  -4.97556371  18.42750211   7.13359125 -11.77887435  10.66181322 
##          349          350          351          352          353          354 
##  40.56106239  12.76204678   6.55339481  -2.16504356  -1.52874585   4.94747420 
##          355          356          357          358          359          360 
##  -8.59497373  -1.29714051  40.31281834  25.27361555  22.91177309  25.16685391 
##          361          362          363          364          365          366 
##   9.98942220  31.06581369  35.24481803   4.85074919  24.54272088   1.12289317 
##          367          368          369          370          371          372 
##   0.96825270  18.64692189  27.99446427  20.52227619   5.07219387  -2.09228129 
##          373          374          375          376          377          378 
##  -3.41449599  40.15841240   9.62032259   4.73407489  17.16410095  19.35905009 
##          379          380          381          382          383          384 
##   0.73783294  25.93772874  10.87822198   3.86412067   7.27400610  50.16773122 
##          385          386          387          388          389          390 
##  27.32249097  10.38446062 -11.01458560  27.19198822  27.91159637  -5.22586753 
##          391          392          393          394          395          396 
##  27.34186939   3.24150333  19.66271096  26.75345428  50.92266834  -0.92910221 
##          397          398          399          400          401          402 
## -24.31384241  23.25958375 -12.67373112   6.70616222  19.04183916  18.74842967 
##          403          404          405          406          407          408 
##  25.05794652 -14.59823707  17.99894235 -21.67937223  27.05931216 -15.83465174 
##          409          410          411          412          413          414 
##  11.06564499  19.36677736 -13.98385562  34.83100039  10.99389882   1.09206598 
##          415          416          417          418          419          420 
##  25.32526231 -11.41034389   5.79232533  -5.54307054   3.02869003  -3.19831014 
##          421          422          423          424          425          426 
##  16.16215882   2.36589496  -2.36024521  10.17405144 -18.16495203   0.08926718 
##          427          428          429          430          431          432 
##  -1.12565968 -24.56425017   6.72597293 -17.78311518  -1.80251214 -13.30756198 
##          433          434          435          436          437          438 
##  -5.90182639  -7.80659479 -28.07372838   5.76823976   3.19063626   2.39416441 
##          439          440          441          442          443          444 
##   9.48745872  -4.78512520   0.13599272  -9.64947258 -15.19030226 -13.16475208 
##          445          446          447          448          449          450 
## -35.72663249 -61.20259401 -10.85070535 -17.09642206 -37.79569627   6.31814044 
##          451          452          453          454          455          456 
##  -2.08229115  10.62135550   1.14534405 -11.12971493  -0.11774850  -4.21643266 
##          457          458          459          460          461          462 
##   8.29910220   7.77047366 -23.04566104  -0.12645349 -12.35330293  34.06448115 
##          463          464          465          466          467          468 
## -22.81987180  -9.47294159   0.83894539   4.76998759  33.50971370   1.98160671 
##          469          470          471          472          473          474 
##  22.71161839  24.51677998  -4.54515347 -19.05028143  16.86104145  16.85691143 
##          475          476          477          478          479          480 
## -15.84812969  13.77540090 -16.55340673 -73.47435662  -0.09901596  26.93075230 
##          481          482          483          484          485          486 
## -36.84005676  35.21358224  15.21461596 -20.46731294   8.94062306   3.56470011 
##          487          488          489          490          491          492 
##  23.93266129 -34.47872418 -15.93295818  47.57580623 -11.16449817  15.42513432 
##          493          494          495          496          497          498 
## -22.20944699  26.82011560  12.51223835 -18.33816531 -15.48073254  -1.61559747 
##          499          500          501          502          503          504 
## -36.80649549 -20.42251669 -25.45964531   8.33957330   5.22223539 -22.15398776 
##          505          506          507          508          509          510 
##  -9.17455361 -21.05727871 -13.83834739  -4.45472061   8.72068702 -11.66509645 
##          511          512          513          514          515          516 
##  43.88560236 -38.53233121  -7.80382751 -15.79358103 -32.79725572 -19.20749951 
##          517          518          519          520          521          522 
##  -6.65251498 -13.59965485 -12.57280738 -11.31422592 -16.89112518 -19.94004735 
##          523          524          525          526          527          528 
##   5.04703555  -7.00927945  -4.19775690   2.51985831 -32.31626952 -16.59913057 
##          529          530          531          532          533          534 
##  -3.94435919 -18.30617531  -4.97839366   1.72609401 -18.73653973 -15.87830539 
##          535          536          537          538          539          540 
##   1.82041899   8.98099810   3.26844662   6.03520034 -13.75348030  -2.63317773 
##          541          542          543          544          545          546 
##  -1.36510364 -12.55727762   5.37875223  -2.34989762   2.83635433  13.61196639 
##          547          548          549          550          551          552 
## -10.13476526  -4.76189208  -0.18054436 -30.12643262 -32.80858873  -3.37108218 
##          553          554          555          556          557          558 
## -30.75309504  -6.41115570  10.21877219  -1.03943734  -9.64035906  19.65603991 
##          559          560          561          562          563          564 
##   3.19740210 -16.28206448  -9.14285038  -2.04634324  -4.40025918   4.10443918 
##          565          566          567          568          569          570 
##  -4.64778354   1.94520155   1.42653830  16.68775337 -11.63923034 -11.02541355 
##          571          572          573          574          575          576 
##  35.66896085  21.51339787  21.13162483   9.76625953  28.14702223   2.09536012 
##          577          578          579          580          581          582 
##  31.27281311   6.09107025  -2.14211371   8.63214659   4.52516961 -13.21552724 
##          583          584          585          586          587          588 
##  -4.83347395  -5.31434388  15.08276862   4.01516210 -13.17947713  -3.34651244 
##          589          590          591          592          593          594 
##  13.94565398  18.33788883   8.94696946  -0.03845102   2.03955841   0.56050194 
##          595          596          597          598          599          600 
##   0.24119324  -3.15366854  -1.47797642  -1.83733534  18.73299779   4.68790584 
##          601          602          603          604          605          606 
##   4.23078104   5.97509012  17.00978846   7.17938596  10.97962637  11.71761426 
##          607          608          609          610          611          612 
##  -8.87615176  -9.88365882  -8.85956965 -10.96334113  -1.62584505  12.51509972 
##          613          614          615          616          617          618 
##   3.45502008   7.52491449 -12.02923124  -5.92637625  -8.51107150   2.91049206 
##          619          620          621          622          623          624 
##   2.64252075 -21.41728610  -9.03842358 -10.61010909  -8.69073102  -2.48750224 
##          625          626 
##   3.55479789   3.55479789 
## 
## $opt
## $opt$maximum
## [1] 0.00515683
## 
## $opt$objective
##           [,1]
## [1,] -2603.509
## 
## 
## $tarX
##     x(Intercept) xunauthorised_absence_in_all_schools_percent_2013
## 1              1                                               0.8
## 2              1                                               0.7
## 3              1                                               0.5
## 4              1                                               0.4
## 5              1                                               0.7
## 6              1                                               0.9
## 7              1                                               0.8
## 8              1                                               0.6
## 9              1                                               0.7
## 10             1                                               0.5
## 11             1                                               0.6
## 12             1                                               0.6
## 13             1                                               1.4
## 14             1                                               0.6
## 15             1                                               0.5
## 16             1                                               0.5
## 17             1                                               0.9
## 18             1                                               0.7
## 19             1                                               0.7
## 20             1                                               1.5
## 21             1                                               1.1
## 22             1                                               0.9
## 23             1                                               0.8
## 24             1                                               1.3
## 25             1                                               1.5
## 26             1                                               1.6
## 27             1                                               1.4
## 28             1                                               1.3
## 29             1                                               1.1
## 30             1                                               2.1
## 31             1                                               1.2
## 32             1                                               1.9
## 33             1                                               1.0
## 34             1                                               1.6
## 35             1                                               1.1
## 36             1                                               1.3
## 37             1                                               1.4
## 38             1                                               1.3
## 39             1                                               1.3
## 40             1                                               1.4
## 41             1                                               1.2
## 42             1                                               0.7
## 43             1                                               0.8
## 44             1                                               0.8
## 45             1                                               1.0
## 46             1                                               0.3
## 47             1                                               0.7
## 48             1                                               0.4
## 49             1                                               0.7
## 50             1                                               0.3
## 51             1                                               0.6
## 52             1                                               0.6
## 53             1                                               0.7
## 54             1                                               1.4
## 55             1                                               1.1
## 56             1                                               0.9
## 57             1                                               1.0
## 58             1                                               0.7
## 59             1                                               1.7
## 60             1                                               1.0
## 61             1                                               1.3
## 62             1                                               1.7
## 63             1                                               1.4
## 64             1                                               1.5
## 65             1                                               1.3
## 66             1                                               1.1
## 67             1                                               1.2
## 68             1                                               1.0
## 69             1                                               0.9
## 70             1                                               1.0
## 71             1                                               0.6
## 72             1                                               1.3
## 73             1                                               1.1
## 74             1                                               1.3
## 75             1                                               1.3
## 76             1                                               1.2
## 77             1                                               1.3
## 78             1                                               1.1
## 79             1                                               1.2
## 80             1                                               1.1
## 81             1                                               0.6
## 82             1                                               1.0
## 83             1                                               1.1
## 84             1                                               1.1
## 85             1                                               1.1
## 86             1                                               0.7
## 87             1                                               1.0
## 88             1                                               0.9
## 89             1                                               0.3
## 90             1                                               1.3
## 91             1                                               1.1
## 92             1                                               1.0
## 93             1                                               0.5
## 94             1                                               0.8
## 95             1                                               1.0
## 96             1                                               0.9
## 97             1                                               0.8
## 98             1                                               0.7
## 99             1                                               0.8
## 100            1                                               1.1
## 101            1                                               0.8
## 102            1                                               1.0
## 103            1                                               1.0
## 104            1                                               1.0
## 105            1                                               1.0
## 106            1                                               0.4
## 107            1                                               0.8
## 108            1                                               1.0
## 109            1                                               1.1
## 110            1                                               1.0
## 111            1                                               0.8
## 112            1                                               1.1
## 113            1                                               0.7
## 114            1                                               0.5
## 115            1                                               0.7
## 116            1                                               0.5
## 117            1                                               0.6
## 118            1                                               0.9
## 119            1                                               0.6
## 120            1                                               1.4
## 121            1                                               1.4
## 122            1                                               1.6
## 123            1                                               0.6
## 124            1                                               1.3
## 125            1                                               1.0
## 126            1                                               1.6
## 127            1                                               1.5
## 128            1                                               1.1
## 129            1                                               1.3
## 130            1                                               0.7
## 131            1                                               0.7
## 132            1                                               0.3
## 133            1                                               0.6
## 134            1                                               0.7
## 135            1                                               0.7
## 136            1                                               0.5
## 137            1                                               0.4
## 138            1                                               0.6
## 139            1                                               1.3
## 140            1                                               1.2
## 141            1                                               0.9
## 142            1                                               1.2
## 143            1                                               1.1
## 144            1                                               1.2
## 145            1                                               0.4
## 146            1                                               0.8
## 147            1                                               0.8
## 148            1                                               0.8
## 149            1                                               0.3
## 150            1                                               1.0
## 151            1                                               0.5
## 152            1                                               0.9
## 153            1                                               1.2
## 154            1                                               1.0
## 155            1                                               0.7
## 156            1                                               0.8
## 157            1                                               0.9
## 158            1                                               0.7
## 159            1                                               0.8
## 160            1                                               0.6
## 161            1                                               0.7
## 162            1                                               1.2
## 163            1                                               0.6
## 164            1                                               0.7
## 165            1                                               0.6
## 166            1                                               0.7
## 167            1                                               0.7
## 168            1                                               1.0
## 169            1                                               1.1
## 170            1                                               1.5
## 171            1                                               1.2
## 172            1                                               1.0
## 173            1                                               0.8
## 174            1                                               1.0
## 175            1                                               1.2
## 176            1                                               1.1
## 177            1                                               1.4
## 178            1                                               1.2
## 179            1                                               0.9
## 180            1                                               1.1
## 181            1                                               1.0
## 182            1                                               1.1
## 183            1                                               0.8
## 184            1                                               1.0
## 185            1                                               1.2
## 186            1                                               1.2
## 187            1                                               0.8
## 188            1                                               1.1
## 189            1                                               0.6
## 190            1                                               0.9
## 191            1                                               1.0
## 192            1                                               1.3
## 193            1                                               1.1
## 194            1                                               0.7
## 195            1                                               0.8
## 196            1                                               0.8
## 197            1                                               1.0
## 198            1                                               1.2
## 199            1                                               0.9
## 200            1                                               0.7
## 201            1                                               0.8
## 202            1                                               0.8
## 203            1                                               0.9
## 204            1                                               0.8
## 205            1                                               0.6
## 206            1                                               1.2
## 207            1                                               1.0
## 208            1                                               0.7
## 209            1                                               1.1
## 210            1                                               1.3
## 211            1                                               1.3
## 212            1                                               1.2
## 213            1                                               1.1
## 214            1                                               1.2
## 215            1                                               1.0
## 216            1                                               1.1
## 217            1                                               1.2
## 218            1                                               1.3
## 219            1                                               0.9
## 220            1                                               1.1
## 221            1                                               0.9
## 222            1                                               1.2
## 223            1                                               1.2
## 224            1                                               1.3
## 225            1                                               1.1
## 226            1                                               1.1
## 227            1                                               1.0
## 228            1                                               1.0
## 229            1                                               0.9
## 230            1                                               1.0
## 231            1                                               1.6
## 232            1                                               0.4
## 233            1                                               0.9
## 234            1                                               1.1
## 235            1                                               0.8
## 236            1                                               1.1
## 237            1                                               1.3
## 238            1                                               1.1
## 239            1                                               1.0
## 240            1                                               1.0
## 241            1                                               1.3
## 242            1                                               1.2
## 243            1                                               1.4
## 244            1                                               1.3
## 245            1                                               1.4
## 246            1                                               1.5
## 247            1                                               1.4
## 248            1                                               1.0
## 249            1                                               1.4
## 250            1                                               1.1
## 251            1                                               1.5
## 252            1                                               0.8
## 253            1                                               1.5
## 254            1                                               1.4
## 255            1                                               1.4
## 256            1                                               1.4
## 257            1                                               1.1
## 258            1                                               1.1
## 259            1                                               1.1
## 260            1                                               1.0
## 261            1                                               1.0
## 262            1                                               1.2
## 263            1                                               1.3
## 264            1                                               1.4
## 265            1                                               1.2
## 266            1                                               1.5
## 267            1                                               1.0
## 268            1                                               1.4
## 269            1                                               1.8
## 270            1                                               0.8
## 271            1                                               1.2
## 272            1                                               1.0
## 273            1                                               1.4
## 274            1                                               1.7
## 275            1                                               1.4
## 276            1                                               1.6
## 277            1                                               1.2
## 278            1                                               1.6
## 279            1                                               0.7
## 280            1                                               1.4
## 281            1                                               1.3
## 282            1                                               1.5
## 283            1                                               1.8
## 284            1                                               1.2
## 285            1                                               1.2
## 286            1                                               0.7
## 287            1                                               0.8
## 288            1                                               1.0
## 289            1                                               0.7
## 290            1                                               0.5
## 291            1                                               1.2
## 292            1                                               1.4
## 293            1                                               1.2
## 294            1                                               1.0
## 295            1                                               1.0
## 296            1                                               0.8
## 297            1                                               0.9
## 298            1                                               0.7
## 299            1                                               1.0
## 300            1                                               0.8
## 301            1                                               0.7
## 302            1                                               0.5
## 303            1                                               0.9
## 304            1                                               0.8
## 305            1                                               1.0
## 306            1                                               0.8
## 307            1                                               1.4
## 308            1                                               0.7
## 309            1                                               0.9
## 310            1                                               0.9
## 311            1                                               2.0
## 312            1                                               1.0
## 313            1                                               2.1
## 314            1                                               2.2
## 315            1                                               0.9
## 316            1                                               1.5
## 317            1                                               1.6
## 318            1                                               1.7
## 319            1                                               1.1
## 320            1                                               0.9
## 321            1                                               0.8
## 322            1                                               2.1
## 323            1                                               0.9
## 324            1                                               0.7
## 325            1                                               1.5
## 326            1                                               2.0
## 327            1                                               2.2
## 328            1                                               1.5
## 329            1                                               1.2
## 330            1                                               1.1
## 331            1                                               1.4
## 332            1                                               1.0
## 333            1                                               1.5
## 334            1                                               1.5
## 335            1                                               1.3
## 336            1                                               1.3
## 337            1                                               1.1
## 338            1                                               1.0
## 339            1                                               1.1
## 340            1                                               1.0
## 341            1                                               0.9
## 342            1                                               1.0
## 343            1                                               1.5
## 344            1                                               1.3
## 345            1                                               1.1
## 346            1                                               1.2
## 347            1                                               1.0
## 348            1                                               1.0
## 349            1                                               1.4
## 350            1                                               0.8
## 351            1                                               1.1
## 352            1                                               1.0
## 353            1                                               1.2
## 354            1                                               0.8
## 355            1                                               0.9
## 356            1                                               1.5
## 357            1                                               1.6
## 358            1                                               1.5
## 359            1                                               1.3
## 360            1                                               1.2
## 361            1                                               1.1
## 362            1                                               0.7
## 363            1                                               0.8
## 364            1                                               0.7
## 365            1                                               0.9
## 366            1                                               0.9
## 367            1                                               0.9
## 368            1                                               0.5
## 369            1                                               1.0
## 370            1                                               0.6
## 371            1                                               1.4
## 372            1                                               1.3
## 373            1                                               1.4
## 374            1                                               0.9
## 375            1                                               0.5
## 376            1                                               0.9
## 377            1                                               1.1
## 378            1                                               0.8
## 379            1                                               1.3
## 380            1                                               0.8
## 381            1                                               0.8
## 382            1                                               0.5
## 383            1                                               1.0
## 384            1                                               0.9
## 385            1                                               1.1
## 386            1                                               0.9
## 387            1                                               0.5
## 388            1                                               0.5
## 389            1                                               0.6
## 390            1                                               1.0
## 391            1                                               0.8
## 392            1                                               1.0
## 393            1                                               0.9
## 394            1                                               1.0
## 395            1                                               0.9
## 396            1                                               0.9
## 397            1                                               0.8
## 398            1                                               0.5
## 399            1                                               0.6
## 400            1                                               0.9
## 401            1                                               0.4
## 402            1                                               0.6
## 403            1                                               1.0
## 404            1                                               1.1
## 405            1                                               0.6
## 406            1                                               1.2
## 407            1                                               0.6
## 408            1                                               0.5
## 409            1                                               1.1
## 410            1                                               0.7
## 411            1                                               0.4
## 412            1                                               0.4
## 413            1                                               1.2
## 414            1                                               1.4
## 415            1                                               0.4
## 416            1                                               0.7
## 417            1                                               1.4
## 418            1                                               1.2
## 419            1                                               1.0
## 420            1                                               1.1
## 421            1                                               0.4
## 422            1                                               0.8
## 423            1                                               1.6
## 424            1                                               1.1
## 425            1                                               1.4
## 426            1                                               0.8
## 427            1                                               0.8
## 428            1                                               0.9
## 429            1                                               1.3
## 430            1                                               1.0
## 431            1                                               1.0
## 432            1                                               0.9
## 433            1                                               0.7
## 434            1                                               1.0
## 435            1                                               0.7
## 436            1                                               0.9
## 437            1                                               0.7
## 438            1                                               0.7
## 439            1                                               1.1
## 440            1                                               0.8
## 441            1                                               1.3
## 442            1                                               1.3
## 443            1                                               1.2
## 444            1                                               1.0
## 445            1                                               0.9
## 446            1                                               0.9
## 447            1                                               1.2
## 448            1                                               1.2
## 449            1                                               1.2
## 450            1                                               1.1
## 451            1                                               1.3
## 452            1                                               1.1
## 453            1                                               1.6
## 454            1                                               1.3
## 455            1                                               1.0
## 456            1                                               1.3
## 457            1                                               1.3
## 458            1                                               1.1
## 459            1                                               1.3
## 460            1                                               1.1
## 461            1                                               1.5
## 462            1                                               1.4
## 463            1                                               1.0
## 464            1                                               1.3
## 465            1                                               1.0
## 466            1                                               1.1
## 467            1                                               1.5
## 468            1                                               0.9
## 469            1                                               1.3
## 470            1                                               0.5
## 471            1                                               1.1
## 472            1                                               1.3
## 473            1                                               1.6
## 474            1                                               0.9
## 475            1                                               0.6
## 476            1                                               0.6
## 477            1                                               0.8
## 478            1                                               0.5
## 479            1                                               0.8
## 480            1                                               1.5
## 481            1                                               0.5
## 482            1                                               2.1
## 483            1                                               1.4
## 484            1                                               0.8
## 485            1                                               0.8
## 486            1                                               1.1
## 487            1                                               1.2
## 488            1                                               1.3
## 489            1                                               0.8
## 490            1                                               1.0
## 491            1                                               1.2
## 492            1                                               1.3
## 493            1                                               1.2
## 494            1                                               0.9
## 495            1                                               1.2
## 496            1                                               1.5
## 497            1                                               1.0
## 498            1                                               1.3
## 499            1                                               0.9
## 500            1                                               1.0
## 501            1                                               0.8
## 502            1                                               1.0
## 503            1                                               1.1
## 504            1                                               0.9
## 505            1                                               0.8
## 506            1                                               0.9
## 507            1                                               1.0
## 508            1                                               1.1
## 509            1                                               0.8
## 510            1                                               1.0
## 511            1                                               1.1
## 512            1                                               0.8
## 513            1                                               1.0
## 514            1                                               0.9
## 515            1                                               1.1
## 516            1                                               0.9
## 517            1                                               1.3
## 518            1                                               1.3
## 519            1                                               0.9
## 520            1                                               0.9
## 521            1                                               1.1
## 522            1                                               1.0
## 523            1                                               1.0
## 524            1                                               1.0
## 525            1                                               1.0
## 526            1                                               1.3
## 527            1                                               1.1
## 528            1                                               1.0
## 529            1                                               1.1
## 530            1                                               1.4
## 531            1                                               1.1
## 532            1                                               0.9
## 533            1                                               0.8
## 534            1                                               1.6
## 535            1                                               1.6
## 536            1                                               1.4
## 537            1                                               1.6
## 538            1                                               1.0
## 539            1                                               0.9
## 540            1                                               1.1
## 541            1                                               1.3
## 542            1                                               1.6
## 543            1                                               1.8
## 544            1                                               1.4
## 545            1                                               1.2
## 546            1                                               1.3
## 547            1                                               1.3
## 548            1                                               1.3
## 549            1                                               1.1
## 550            1                                               1.2
## 551            1                                               1.1
## 552            1                                               1.4
## 553            1                                               1.2
## 554            1                                               1.3
## 555            1                                               1.3
## 556            1                                               1.1
## 557            1                                               1.1
## 558            1                                               1.3
## 559            1                                               1.3
## 560            1                                               0.8
## 561            1                                               1.0
## 562            1                                               1.2
## 563            1                                               1.2
## 564            1                                               1.2
## 565            1                                               1.0
## 566            1                                               0.7
## 567            1                                               0.9
## 568            1                                               1.3
## 569            1                                               1.3
## 570            1                                               1.5
## 571            1                                               0.8
## 572            1                                               1.4
## 573            1                                               0.7
## 574            1                                               1.2
## 575            1                                               0.8
## 576            1                                               1.1
## 577            1                                               0.6
## 578            1                                               1.9
## 579            1                                               1.7
## 580            1                                               1.9
## 581            1                                               1.4
## 582            1                                               1.6
## 583            1                                               1.4
## 584            1                                               1.5
## 585            1                                               1.7
## 586            1                                               1.9
## 587            1                                               1.5
## 588            1                                               1.5
## 589            1                                               1.9
## 590            1                                               2.0
## 591            1                                               1.6
## 592            1                                               1.5
## 593            1                                               1.8
## 594            1                                               1.7
## 595            1                                               1.3
## 596            1                                               1.4
## 597            1                                               1.1
## 598            1                                               1.2
## 599            1                                               1.5
## 600            1                                               1.5
## 601            1                                               1.2
## 602            1                                               1.4
## 603            1                                               1.5
## 604            1                                               1.8
## 605            1                                               1.2
## 606            1                                               1.2
## 607            1                                               1.0
## 608            1                                               1.3
## 609            1                                               1.2
## 610            1                                               1.3
## 611            1                                               1.5
## 612            1                                               1.4
## 613            1                                               0.8
## 614            1                                               1.4
## 615            1                                               1.2
## 616            1                                               1.3
## 617            1                                               1.5
## 618            1                                               1.5
## 619            1                                               1.6
## 620            1                                               1.1
## 621            1                                               1.1
## 622            1                                               1.2
## 623            1                                               1.6
## 624            1                                               1.2
## 625            1                                               0.7
## 626            1                                               0.7
##     xlog(median_house_price_2014)
## 1                        12.66033
## 2                        12.72842
## 3                        12.79698
## 4                        12.91158
## 5                        12.98310
## 6                        13.08154
## 7                        12.64433
## 8                        12.89111
## 9                        12.88847
## 10                       12.88753
## 11                       12.89922
## 12                       13.01589
## 13                       12.74183
## 14                       13.08154
## 15                       13.00261
## 16                       13.21767
## 17                       12.83468
## 18                       12.74840
## 19                       12.79663
## 20                       12.40185
## 21                       12.73670
## 22                       12.67608
## 23                       12.88029
## 24                       12.46844
## 25                       12.37159
## 26                       12.35017
## 27                       12.36734
## 28                       12.41410
## 29                       12.76569
## 30                       12.40901
## 31                       12.42922
## 32                       12.30138
## 33                       12.67608
## 34                       12.26904
## 35                       12.75708
## 36                       12.42922
## 37                       12.42922
## 38                       12.57677
## 39                       12.38839
## 40                       12.42922
## 41                       13.00583
## 42                       12.99737
## 43                       12.76569
## 44                       12.89922
## 45                       12.50599
## 46                       13.07107
## 47                       12.64029
## 48                       12.95181
## 49                       12.88664
## 50                       13.05622
## 51                       12.69772
## 52                       13.08154
## 53                       13.09190
## 54                       12.42922
## 55                       12.67608
## 56                       12.66033
## 57                       12.59623
## 58                       12.88664
## 59                       12.42922
## 60                       12.73670
## 61                       12.42922
## 62                       12.39669
## 63                       12.34148
## 64                       12.42922
## 65                       12.33050
## 66                       12.80765
## 67                       12.54254
## 68                       12.42118
## 69                       12.75275
## 70                       12.82126
## 71                       13.55739
## 72                       12.32386
## 73                       12.42922
## 74                       12.50618
## 75                       12.42902
## 76                       12.50618
## 77                       12.75996
## 78                       12.83468
## 79                       12.61487
## 80                       12.42902
## 81                       13.38473
## 82                       13.35980
## 83                       12.45877
## 84                       12.40082
## 85                       12.32878
## 86                       12.48749
## 87                       12.42521
## 88                       12.75130
## 89                       13.32938
## 90                       12.87518
## 91                       12.42922
## 92                       12.92086
## 93                       13.32530
## 94                       12.56024
## 95                       12.61154
## 96                       12.86424
## 97                       13.12236
## 98                       12.63460
## 99                       12.81448
## 100                      13.19189
## 101                      13.03892
## 102                      12.99453
## 103                      13.56705
## 104                      13.25339
## 105                      13.15966
## 106                      12.94801
## 107                      12.38839
## 108                      12.39669
## 109                      12.42922
## 110                      12.24289
## 111                      12.32386
## 112                      12.42922
## 113                      12.59473
## 114                      12.59980
## 115                      12.51539
## 116                      12.80765
## 117                      12.54344
## 118                      12.42922
## 119                      12.67608
## 120                      12.42922
## 121                      12.28765
## 122                      12.34148
## 123                      12.52453
## 124                      12.25009
## 125                      12.64433
## 126                      12.42920
## 127                      12.32386
## 128                      12.46458
## 129                      12.51997
## 130                      12.76555
## 131                      12.64755
## 132                      13.16351
## 133                      12.72189
## 134                      13.06049
## 135                      12.62807
## 136                      12.82799
## 137                      13.12236
## 138                      12.93241
## 139                      12.54254
## 140                      12.42922
## 141                      12.52453
## 142                      12.54254
## 143                      12.42922
## 144                      12.42922
## 145                      12.89922
## 146                      12.77987
## 147                      12.74549
## 148                      12.89922
## 149                      13.16158
## 150                      12.51356
## 151                      12.96571
## 152                      12.50228
## 153                      12.85840
## 154                      13.22672
## 155                      12.90545
## 156                      12.84793
## 157                      12.57764
## 158                      12.80353
## 159                      13.12236
## 160                      12.68386
## 161                      12.98189
## 162                      12.64433
## 163                      12.98310
## 164                      12.84793
## 165                      12.87390
## 166                      12.78689
## 167                      13.06049
## 168                      12.42922
## 169                      12.76569
## 170                      12.42902
## 171                      12.58613
## 172                      12.71590
## 173                      12.48276
## 174                      12.42902
## 175                      12.42902
## 176                      13.12236
## 177                      12.62971
## 178                      12.92269
## 179                      13.42616
## 180                      13.04979
## 181                      13.00500
## 182                      12.68386
## 183                      12.99453
## 184                      13.11231
## 185                      12.63134
## 186                      13.01700
## 187                      12.81039
## 188                      12.87377
## 189                      12.94663
## 190                      12.75492
## 191                      13.22717
## 192                      12.61984
## 193                      13.13725
## 194                      13.62314
## 195                      13.17685
## 196                      12.98883
## 197                      13.02805
## 198                      13.16158
## 199                      12.89232
## 200                      13.34990
## 201                      12.81039
## 202                      12.82126
## 203                      12.72189
## 204                      12.98310
## 205                      12.81584
## 206                      12.42922
## 207                      12.76569
## 208                      12.86100
## 209                      12.83468
## 210                      12.73670
## 211                      12.75383
## 212                      12.77987
## 213                      13.14461
## 214                      12.79108
## 215                      13.33747
## 216                      12.94801
## 217                      12.94084
## 218                      12.98310
## 219                      13.11730
## 220                      12.97154
## 221                      13.45883
## 222                      12.88664
## 223                      12.76569
## 224                      12.93059
## 225                      12.97734
## 226                      13.28788
## 227                      13.32121
## 228                      12.87742
## 229                      13.11231
## 230                      12.76569
## 231                      13.27937
## 232                      13.65299
## 233                      12.88939
## 234                      13.25777
## 235                      12.95039
## 236                      12.64433
## 237                      12.75564
## 238                      12.91780
## 239                      12.78339
## 240                      12.56024
## 241                      12.84793
## 242                      12.66033
## 243                      12.66033
## 244                      12.57762
## 245                      12.57080
## 246                      13.27078
## 247                      13.12236
## 248                      12.95229
## 249                      12.93603
## 250                      12.99907
## 251                      12.48749
## 252                      12.79386
## 253                      12.39876
## 254                      12.42118
## 255                      12.86100
## 256                      12.76569
## 257                      12.73670
## 258                      12.77987
## 259                      12.50618
## 260                      12.71440
## 261                      13.02805
## 262                      12.82126
## 263                      12.57764
## 264                      12.70685
## 265                      12.39669
## 266                      12.42922
## 267                      12.90545
## 268                      12.66033
## 269                      12.58709
## 270                      12.69158
## 271                      12.57332
## 272                      12.50618
## 273                      12.84529
## 274                      12.49219
## 275                      13.01700
## 276                      12.66191
## 277                      12.96571
## 278                      12.46863
## 279                      12.75130
## 280                      12.80216
## 281                      12.49687
## 282                      12.42521
## 283                      12.32383
## 284                      12.15478
## 285                      12.42922
## 286                      12.42922
## 287                      12.54254
## 288                      12.56024
## 289                      12.54254
## 290                      12.66033
## 291                      12.35234
## 292                      12.22831
## 293                      12.10625
## 294                      12.09793
## 295                      12.15478
## 296                      12.54254
## 297                      12.46650
## 298                      12.52453
## 299                      12.49031
## 300                      12.52453
## 301                      12.54254
## 302                      12.66033
## 303                      12.42922
## 304                      12.42922
## 305                      12.41714
## 306                      12.45877
## 307                      12.68850
## 308                      12.98310
## 309                      13.06473
## 310                      12.83468
## 311                      12.42922
## 312                      12.77564
## 313                      12.25486
## 314                      12.42118
## 315                      12.79386
## 316                      12.42922
## 317                      12.42118
## 318                      12.42922
## 319                      12.67606
## 320                      13.12236
## 321                      12.75852
## 322                      12.46844
## 323                      12.79441
## 324                      12.76569
## 325                      12.48749
## 326                      12.42922
## 327                      12.28880
## 328                      12.44902
## 329                      12.71590
## 330                      12.69158
## 331                      12.56024
## 332                      12.70685
## 333                      12.71440
## 334                      12.55409
## 335                      12.68850
## 336                      12.63786
## 337                      12.90172
## 338                      12.77032
## 339                      12.79386
## 340                      12.86747
## 341                      12.73670
## 342                      12.57331
## 343                      12.69465
## 344                      12.72189
## 345                      12.64433
## 346                      12.56549
## 347                      12.75130
## 348                      13.03898
## 349                      12.81448
## 350                      12.66033
## 351                      12.61984
## 352                      12.64433
## 353                      12.63460
## 354                      12.66033
## 355                      12.73670
## 356                      12.42921
## 357                      12.17045
## 358                      12.36734
## 359                      12.62807
## 360                      12.32386
## 361                      12.59134
## 362                      12.79772
## 363                      12.87390
## 364                      12.73670
## 365                      12.81787
## 366                      12.73522
## 367                      12.42922
## 368                      13.12186
## 369                      12.94800
## 370                      12.83734
## 371                      12.86359
## 372                      12.42118
## 373                      12.40287
## 374                      12.57764
## 375                      12.87005
## 376                      12.73080
## 377                      12.42922
## 378                      12.50618
## 379                      12.38839
## 380                      12.66981
## 381                      12.61320
## 382                      12.75852
## 383                      12.45877
## 384                      12.41309
## 385                      12.51356
## 386                      12.57418
## 387                      13.30460
## 388                      13.12226
## 389                      13.02805
## 390                      12.84924
## 391                      13.03621
## 392                      13.12236
## 393                      13.34651
## 394                      13.35348
## 395                      13.80040
## 396                      13.52315
## 397                      12.72189
## 398                      13.08154
## 399                      13.01700
## 400                      12.94801
## 401                      13.22762
## 402                      13.30468
## 403                      13.39239
## 404                      14.12483
## 405                      13.02805
## 406                      12.40901
## 407                      14.24078
## 408                      13.50422
## 409                      12.67608
## 410                      13.07107
## 411                      13.12136
## 412                      13.24458
## 413                      12.54254
## 414                      12.56024
## 415                      13.16638
## 416                      13.08674
## 417                      12.42922
## 418                      12.57072
## 419                      12.86876
## 420                      12.59473
## 421                      13.24237
## 422                      13.11635
## 423                      12.54254
## 424                      12.76569
## 425                      12.83455
## 426                      13.45884
## 427                      13.24988
## 428                      12.88664
## 429                      13.11795
## 430                      13.18815
## 431                      12.99453
## 432                      12.99567
## 433                      13.15241
## 434                      13.20117
## 435                      13.29632
## 436                      12.92391
## 437                      13.11534
## 438                      13.29632
## 439                      13.12236
## 440                      13.58610
## 441                      12.89546
## 442                      13.18063
## 443                      13.35348
## 444                      13.45884
## 445                      13.76422
## 446                      13.52114
## 447                      13.62647
## 448                      14.10069
## 449                      13.59860
## 450                      13.46453
## 451                      13.51609
## 452                      13.33465
## 453                      13.12236
## 454                      12.96571
## 455                      12.99453
## 456                      13.03462
## 457                      13.44445
## 458                      13.57503
## 459                      13.23211
## 460                      13.25777
## 461                      13.86430
## 462                      14.13396
## 463                      14.11042
## 464                      13.18778
## 465                      13.81050
## 466                      13.91082
## 467                      14.50615
## 468                      14.48334
## 469                      14.07402
## 470                      13.93551
## 471                      13.56191
## 472                      13.74830
## 473                      13.37312
## 474                      13.57121
## 475                      14.09692
## 476                      14.37227
## 477                      14.27767
## 478                      14.15198
## 479                      14.04860
## 480                      13.70458
## 481                      15.06827
## 482                      13.65299
## 483                      13.91082
## 484                      13.64116
## 485                      14.21261
## 486                      13.12226
## 487                      13.79019
## 488                      13.75629
## 489                      13.52783
## 490                      13.90169
## 491                      13.20854
## 492                      13.65299
## 493                      13.66148
## 494                      13.48095
## 495                      13.12231
## 496                      13.67625
## 497                      13.55803
## 498                      12.99453
## 499                      13.51508
## 500                      13.38473
## 501                      13.05622
## 502                      13.23569
## 503                      13.43717
## 504                      13.04979
## 505                      13.60910
## 506                      13.23569
## 507                      13.34551
## 508                      13.26213
## 509                      13.76947
## 510                      13.30468
## 511                      13.98946
## 512                      13.35363
## 513                      13.34150
## 514                      13.65299
## 515                      13.21276
## 516                      13.30468
## 517                      12.94801
## 518                      12.84793
## 519                      12.82126
## 520                      13.02365
## 521                      12.83468
## 522                      12.78689
## 523                      12.86100
## 524                      12.85579
## 525                      12.80285
## 526                      12.69158
## 527                      12.58793
## 528                      12.61984
## 529                      12.93603
## 530                      12.69158
## 531                      13.10012
## 532                      13.12235
## 533                      13.14217
## 534                      13.50422
## 535                      13.01143
## 536                      13.38473
## 537                      12.91164
## 538                      13.41129
## 539                      13.12236
## 540                      13.04979
## 541                      13.36922
## 542                      13.41129
## 543                      13.21767
## 544                      13.48004
## 545                      13.11362
## 546                      13.02144
## 547                      12.92391
## 548                      13.01143
## 549                      13.17115
## 550                      13.02254
## 551                      12.99453
## 552                      13.08154
## 553                      13.04979
## 554                      12.73670
## 555                      13.09190
## 556                      13.08803
## 557                      12.97849
## 558                      12.83468
## 559                      12.73670
## 560                      12.83468
## 561                      12.85579
## 562                      13.07107
## 563                      13.06314
## 564                      13.01700
## 565                      12.93603
## 566                      13.12226
## 567                      12.94801
## 568                      12.56024
## 569                      13.50422
## 570                      12.97154
## 571                      13.04979
## 572                      12.71394
## 573                      13.24237
## 574                      13.07632
## 575                      13.61706
## 576                      12.94563
## 577                      13.34551
## 578                      12.76569
## 579                      12.75130
## 580                      12.82126
## 581                      12.82799
## 582                      12.69619
## 583                      12.76569
## 584                      12.43520
## 585                      12.49500
## 586                      12.69158
## 587                      12.43917
## 588                      12.62314
## 589                      12.42521
## 590                      12.36094
## 591                      12.38839
## 592                      12.54254
## 593                      12.54254
## 594                      12.42922
## 595                      12.42922
## 596                      12.51906
## 597                      12.42922
## 598                      12.48333
## 599                      12.42922
## 600                      12.42922
## 601                      12.42922
## 602                      12.46844
## 603                      12.42920
## 604                      12.42922
## 605                      12.65396
## 606                      12.42911
## 607                      12.34583
## 608                      12.20607
## 609                      12.29683
## 610                      12.23320
## 611                      12.21850
## 612                      12.06105
## 613                      12.65316
## 614                      12.30138
## 615                      12.23077
## 616                      12.26434
## 617                      12.25486
## 618                      12.27839
## 619                      12.27839
## 620                      12.27839
## 621                      12.36734
## 622                      12.38839
## 623                      12.39048
## 624                      12.26905
## 625                      13.54763
## 626                      13.54763
## attr(,&quot;assign&quot;)
## [1] 1 1 1
## 
## $tary
##        1        2        3        4        5        6        7        8 
## 321.0324 336.6093 340.8668 351.4557 369.6022 336.7019 306.5258 360.4061 
##        9       10       11       12       13       14       15       16 
## 345.4616 335.2043 322.6695 365.7013 306.8562 366.1106 353.4498 377.6631 
##       17       18       19       20       21       22       23       24 
## 334.4053 338.5541 351.1055 302.8789 328.8973 343.8477 345.6174 307.2508 
##       25       26       27       28       29       30       31       32 
## 315.0692 308.1082 315.7701 310.6027 324.5970 288.4201 339.7582 275.1737 
##       33       34       35       36       37       38       39       40 
## 318.0195 314.5294 318.4278 297.5854 296.4121 316.7732 317.2815 317.2076 
##       41       42       43       44       45       46       47       48 
## 335.6474 346.4949 339.8718 362.5511 311.0534 368.3065 336.5277 353.0405 
##       49       50       51       52       53       54       55       56 
## 353.7935 379.4758 337.3657 357.8105 355.1709 284.7431 321.9377 333.4760 
##       57       58       59       60       61       62       63       64 
## 325.6697 341.1174 294.9667 327.4033 301.5436 295.4381 312.6736 291.1114 
##       65       66       67       68       69       70       71       72 
## 312.8857 316.6882 320.9706 335.1825 364.9982 328.3778 343.1170 308.3177 
##       73       74       75       76       77       78       79       80 
## 315.2180 317.2317 338.2011 329.6439 332.5617 340.5284 314.5883 343.5023 
##       81       82       83       84       85       86       87       88 
## 353.9970 341.8204 307.1169 304.4111 318.2342 306.8280 313.1554 321.1991 
##       89       90       91       92       93       94       95       96 
## 378.3196 303.1225 313.8584 310.7136 370.0963 336.0072 301.1038 326.3222 
##       97       98       99      100      101      102      103      104 
## 337.4526 323.7834 337.8136 336.4936 347.8247 319.2405 348.7881 334.2653 
##      105      106      107      108      109      110      111      112 
## 327.9116 350.6782 302.8260 302.9910 319.6534 305.1239 312.7568 311.7774 
##      113      114      115      116      117      118      119      120 
## 319.6254 339.6334 326.2188 350.1037 333.0276 290.6202 335.0489 289.4734 
##      121      122      123      124      125      126      127      128 
## 297.1720 283.6317 338.6270 318.2531 305.9885 292.2125 288.6465 308.3904 
##      129      130      131      132      133      134      135      136 
## 292.5297 343.8699 324.7747 365.3651 338.4311 337.7461 323.9590 349.5096 
##      137      138      139      140      141      142      143      144 
## 349.3842 330.8915 325.0119 309.9250 332.0775 306.6633 315.9870 312.8322 
##      145      146      147      148      149      150      151      152 
## 345.4770 333.8901 341.1679 331.0696 366.5088 316.0918 356.8232 321.0207 
##      153      154      155      156      157      158      159      160 
## 322.4230 312.2102 339.4518 347.9867 319.5072 355.2197 350.4148 349.8169 
##      161      162      163      164      165      166      167      168 
## 340.0357 313.5127 354.1050 335.8122 329.8201 332.7666 343.9299 304.5673 
##      169      170      171      172      173      174      175      176 
## 337.3812 296.4044 313.7757 319.9019 325.2791 329.4783 316.6482 305.6480 
##      177      178      179      180      181      182      183      184 
## 303.5750 295.3119 344.1060 352.6602 317.4578 309.1447 354.8794 309.9067 
##      185      186      187      188      189      190      191      192 
## 296.3923 312.1381 329.9883 319.0844 352.2284 338.6063 340.3081 305.6572 
##      193      194      195      196      197      198      199      200 
## 333.6166 366.0772 358.8392 348.2057 325.5546 350.9833 323.8657 367.0949 
##      201      202      203      204      205      206      207      208 
## 344.7913 355.1501 341.0303 337.4902 336.1979 312.0827 351.2152 367.3406 
##      209      210      211      212      213      214      215      216 
## 325.7017 339.6685 309.8606 320.1656 317.7872 314.2773 294.2215 311.1605 
##      217      218      219      220      221      222      223      224 
## 290.3642 304.5134 310.8580 307.8081 319.5010 315.3803 312.9439 302.8388 
##      225      226      227      228      229      230      231      232 
## 322.3017 323.0269 309.8454 312.3270 331.4725 321.7619 296.5034 355.4947 
##      233      234      235      236      237      238      239      240 
## 323.6830 332.2660 328.1538 303.0076 314.2407 306.7251 323.9359 319.6245 
##      241      242      243      244      245      246      247      248 
## 318.0574 318.5223 317.2875 312.1200 308.8345 310.2327 320.7410 310.7688 
##      249      250      251      252      253      254      255      256 
## 317.3577 317.4682 292.0379 311.1436 288.8378 300.5945 294.2010 306.5659 
##      257      258      259      260      261      262      263      264 
## 331.6138 312.1484 299.0818 310.3535 312.7355 318.1550 300.9643 310.6530 
##      265      266      267      268      269      270      271      272 
## 297.3611 305.9983 332.8590 303.5714 327.0825 318.0445 350.4817 318.4266 
##      273      274      275      276      277      278      279      280 
## 300.9059 307.6448 308.4913 309.4521 325.5011 311.4209 337.2882 314.8358 
##      281      282      283      284      285      286      287      288 
## 311.6265 303.9360 315.8748 309.6287 299.7475 346.6747 331.2969 323.4576 
##      289      290      291      292      293      294      295      296 
## 346.2139 356.9715 300.5540 284.3557 310.6106 304.4882 303.0060 333.8279 
##      297      298      299      300      301      302      303      304 
## 330.1879 338.3093 335.2542 341.4293 325.5406 323.4308 323.4535 324.6333 
##      305      306      307      308      309      310      311      312 
## 296.9279 301.3535 315.5634 349.4630 337.9093 345.5099 288.6206 334.7735 
##      313      314      315      316      317      318      319      320 
## 292.5360 302.6301 362.6984 308.4132 312.3835 310.2101 327.8532 346.0791 
##      321      322      323      324      325      326      327      328 
## 358.7785 305.5665 351.6595 326.7185 324.9301 305.4028 302.8616 292.9724 
##      329      330      331      332      333      334      335      336 
## 326.0153 305.2082 316.6081 330.7522 310.3599 311.1835 300.0606 304.7279 
##      337      338      339      340      341      342      343      344 
## 305.2363 316.3858 319.2654 328.9687 319.6575 320.1540 310.2953 310.4798 
##      345      346      347      348      349      350      351      352 
## 340.1417 324.2379 314.8995 340.9614 353.5644 345.5304 327.9593 323.1667 
##      353      354      355      356      357      358      359      360 
## 316.4455 337.7158 321.5171 303.2390 337.9741 329.0309 337.1862 339.2295 
##      361      362      363      364      365      366      367      368 
## 331.0366 369.1812 370.7016 342.1980 355.6766 331.2164 327.2098 368.0776 
##      369      370      371      372      373      374      375      376 
## 357.1488 362.7540 318.6938 309.5779 304.4076 368.2683 355.8812 334.7719 
##      377      378      379      380      381      382      383      384 
## 336.1705 350.1869 311.9953 358.8254 343.0533 348.7211 330.2701 376.2063 
##      385      386      387      388      389      390      391      392 
## 347.3906 338.4508 340.7164 376.6277 372.5439 322.6853 364.8417 334.5907 
##      393      394      395      396      397      398      399      400 
## 357.4510 361.0119 394.4244 339.0827 309.2294 372.1827 331.8195 339.4782 
##      401      402      403      404      405      406      407      408 
## 373.4214 366.8629 359.8062 325.7523 362.6312 293.4552 386.9572 338.4091 
##      409      410      411      412      413      414      415      416 
## 333.1795 360.9230 339.0581 389.4240 327.8093 310.8952 378.9339 330.3431 
##      417      418      419      420      421      422      423      424 
## 313.9461 311.6270 331.1856 317.8916 370.7273 340.8745 299.9850 333.4159 
##      425      426      427      428      429      430      431      432 
## 295.0911 342.9091 339.0638 307.4353 327.1670 314.3942 327.9376 320.0644 
##      433      434      435      436      437      438      439      440 
## 336.6783 324.5347 316.3179 338.2369 345.3041 346.7858 337.2191 339.6366 
##      441      442      443      444      445      446      447      448 
## 317.7763 311.5805 311.8330 322.4199 307.3197 278.7839 319.6090 319.3327 
##      449      450      451      452      453      454      455      456 
## 292.3132 338.3570 323.3705 341.0252 310.7892 307.3949 329.6223 315.1757 
##      457      458      459      460      461      462      463      464 
## 332.8500 341.2002 298.8324 329.3097 310.2475 363.6773 320.9668 311.8470 
##      465      466      467      468      469      470      471      472 
## 340.8503 342.4266 364.1901 354.0801 355.1875 384.1896 328.7194 309.3255 
##      473      474      475      476      477      478      479      480 
## 329.6614 357.4737 342.2389 375.3284 336.5737 288.9233 350.1447 347.5210 
##      481      482      483      484      485      486      487      488 
## 337.0917 333.4491 342.0186 324.6475 361.2488 331.2951 356.4533 293.9976 
##      489      490      491      492      493      494      495      496 
## 327.7553 388.7350 314.0344 342.6011 308.6910 366.3007 336.6257 301.8955 
##      497      498      499      500      501      502      503      504 
## 321.3526 317.2718 303.1037 314.2293 312.2921 341.1154 336.9167 311.8993 
##      505      506      507      508      509      510      511      512 
## 335.5368 315.3361 320.3198 325.0362 355.4506 321.9791 382.5322 302.9632 
##      513      514      515      516      517      518      519      520 
## 326.3038 325.8527 296.0723 318.0543 311.6493 303.4423 318.6037 322.4099 
##      521      522      523      524      525      526      527      528 
## 307.2192 307.1863 333.1062 320.9844 323.1294 317.5938 288.6880 308.4244 
##      529      530      531      532      533      534      535      536 
## 321.4418 293.1502 322.4732 336.6927 320.0971 298.5723 310.0679 329.1626 
##      537      538      539      540      541      542      543      544 
## 310.2598 341.0214 321.2133 324.1850 322.2389 300.7236 308.9872 319.0314 
##      545      546      547      548      549      550      551      552 
## 326.8403 332.8381 307.8637 314.3383 328.1653 292.7311 293.3139 312.9940 
##      553      554      555      556      557      558      559      560 
## 292.4475 309.2307 330.3319 326.2600 316.2803 336.5313 318.8393 318.6810 
##      561      562      563      564      565      566      567      568 
## 318.8508 321.4221 318.9684 326.8923 324.3559 344.1458 334.1986 330.1084 
##      569      570      571      572      573      574      575      576 
## 313.6640 300.3375 373.3398 333.2513 364.8441 333.3008 372.9585 327.6023 
##      577      578      579      580      581      582      583      584 
## 379.9012 300.3925 299.2133 303.6331 317.6987 291.0637 307.5557 299.2972 
##      585      586      587      588      589      590      591      592 
## 313.2120 297.3837 291.4820 303.6307 303.9612 303.9268 309.3517 305.9243 
##      593      594      595      596      597      598      599      600 
## 297.1496 297.8616 312.0125 306.1310 317.5285 314.2327 323.2692 309.2241 
##      601      602      603      604      605      606      607      608 
## 319.6197 314.6226 321.5457 300.8629 329.1975 327.1052 312.6983 299.0788 
##      609      610      611      612      613      614      615      616 
## 304.8628 298.3406 300.2578 316.0344 336.1331 314.0695 300.8616 303.7695 
##      617      618      619      620      621      622      623      624 
## 293.8304 305.5482 301.6626 295.6906 309.1891 304.2649 291.7402 310.8852 
##      625      626 
## 351.1099 351.1099 
## 
## $y
##     1     2     3     4     5     6     7     8     9    10    11    12    13 
## 321.3 337.5 342.7 353.3 372.3 339.8 307.1 361.6 347.0 336.4 324.8 367.5 308.4 
##    14    15    16    17    18    19    20    21    22    23    24    25    26 
## 367.0 355.0 378.9 335.0 339.7 352.3 304.6 330.1 345.9 346.8 309.5 317.3 309.5 
##    27    28    29    30    31    32    33    34    35    36    37    38    39 
## 317.7 311.7 326.8 289.8 341.2 276.0 319.2 316.7 320.1 299.3 297.8 318.4 318.9 
##    40    41    42    43    44    45    46    47    48    49    50    51    52 
## 318.3 337.4 348.8 341.7 363.7 311.6 369.8 338.2 355.1 355.3 381.0 339.7 359.3 
##    53    54    55    56    57    58    59    60    61    62    63    64    65 
## 357.2 286.7 323.3 335.5 327.1 343.4 296.1 328.6 303.0 296.9 313.5 292.8 314.6 
##    66    67    68    69    70    71    72    73    74    75    76    77    78 
## 318.5 323.2 337.2 367.0 330.8 345.5 309.4 316.6 318.9 340.2 331.1 333.7 342.9 
##    79    80    81    82    83    84    85    86    87    88    89    90    91 
## 315.8 345.0 355.5 343.6 309.1 305.8 319.9 308.5 315.4 323.2 379.5 305.9 315.5 
##    92    93    94    95    96    97    98    99   100   101   102   103   104 
## 313.4 371.3 337.1 302.8 328.0 338.9 324.9 339.8 338.9 349.3 320.7 350.5 335.7 
##   105   106   107   108   109   110   111   112   113   114   115   116   117 
## 330.2 352.1 304.2 304.6 321.9 307.3 314.2 313.1 321.5 340.8 328.0 351.8 334.7 
##   118   119   120   121   122   123   124   125   126   127   128   129   130 
## 292.3 336.5 290.8 298.5 284.4 340.6 319.9 306.9 293.3 289.7 309.2 294.2 345.0 
##   131   132   133   134   135   136   137   138   139   140   141   142   143 
## 326.5 366.8 340.5 338.6 327.5 350.7 350.9 332.4 326.1 312.1 334.0 308.6 317.1 
##   144   145   146   147   148   149   150   151   152   153   154   155   156 
## 314.5 347.0 335.3 343.2 332.3 368.6 318.2 359.5 322.8 323.9 313.1 340.9 349.8 
##   157   158   159   160   161   162   163   164   165   166   167   168   169 
## 321.0 357.0 351.3 351.0 342.1 314.7 356.1 337.0 331.6 334.2 345.7 305.7 339.1 
##   170   171   172   173   174   175   176   177   178   179   180   181   182 
## 298.6 315.7 321.6 327.0 331.2 318.6 307.6 304.9 296.7 345.8 354.6 319.2 310.8 
##   183   184   185   186   187   188   189   190   191   192   193   194   195 
## 357.2 311.5 298.1 314.1 332.0 320.3 353.4 340.3 342.1 307.7 335.7 368.5 360.7 
##   196   197   198   199   200   201   202   203   204   205   206   207   208 
## 350.1 326.7 352.8 325.6 368.9 346.9 356.7 343.5 339.3 337.4 313.5 352.7 368.9 
##   209   210   211   212   213   214   215   216   217   218   219   220   221 
## 327.7 341.1 311.0 322.1 319.2 316.5 296.2 312.5 292.0 305.6 313.0 308.9 321.5 
##   222   223   224   225   226   227   228   229   230   231   232   233   234 
## 317.3 314.3 304.8 324.5 324.8 311.5 313.7 333.5 324.0 298.5 356.9 325.4 333.7 
##   235   236   237   238   239   240   241   242   243   244   245   246   247 
## 330.4 304.4 315.9 308.7 325.3 321.0 320.0 319.9 319.5 314.3 310.2 312.8 322.1 
##   248   249   250   251   252   253   254   255   256   257   258   259   260 
## 312.4 319.0 318.3 294.5 312.8 290.5 302.2 295.6 308.2 333.0 313.5 300.7 311.4 
##   261   262   263   264   265   266   267   268   269   270   271   272   273 
## 314.4 319.5 303.4 312.0 299.0 308.2 334.2 305.2 329.3 319.5 352.5 320.1 302.8 
##   274   275   276   277   278   279   280   281   282   283   284   285   286 
## 309.0 310.9 310.9 327.4 313.1 339.0 316.2 313.0 305.6 317.5 311.5 301.1 348.7 
##   287   288   289   290   291   292   293   294   295   296   297   298   299 
## 332.8 324.9 347.7 358.7 301.4 285.7 312.2 306.1 304.6 335.6 331.9 340.1 337.0 
##   300   301   302   303   304   305   306   307   308   309   310   311   312 
## 342.9 327.2 325.4 324.8 326.3 298.3 303.0 317.0 351.0 339.7 347.0 290.8 336.5 
##   313   314   315   316   317   318   319   320   321   322   323   324   325 
## 293.6 304.0 364.5 310.4 313.5 311.3 329.8 348.5 360.6 307.5 353.4 327.9 327.2 
##   326   327   328   329   330   331   332   333   334   335   336   337   338 
## 306.5 303.4 294.6 328.5 307.1 318.5 332.2 311.7 313.4 300.9 305.8 307.2 317.5 
##   339   340   341   342   343   344   345   346   347   348   349   350   351 
## 321.2 330.7 321.6 321.9 311.7 311.9 341.8 325.7 316.6 343.9 355.1 347.6 330.1 
##   352   353   354   355   356   357   358   359   360   361   362   363   364 
## 324.3 318.7 340.0 322.7 304.6 339.7 330.5 338.6 341.0 332.2 370.9 372.2 343.7 
##   365   366   367   368   369   370   371   372   373   374   375   376   377 
## 357.2 333.0 328.6 369.8 359.6 364.0 320.2 311.3 306.1 369.5 357.1 336.3 337.7 
##   378   379   380   381   382   383   384   385   386   387   388   389   390 
## 352.0 313.5 360.3 344.5 351.1 332.0 377.4 349.2 340.7 342.8 378.2 374.4 324.4 
##   391   392   393   394   395   396   397   398   399   400   401   402   403 
## 366.1 337.5 359.6 362.8 396.2 341.8 310.4 373.7 333.9 341.0 375.6 369.3 361.4 
##   404   405   406   407   408   409   410   411   412   413   414   415   416 
## 327.8 364.2 296.0 388.7 340.5 334.7 363.4 341.0 391.6 329.6 312.6 380.7 332.4 
##   417   418   419   420   421   422   423   424   425   426   427   428   429 
## 315.6 313.0 332.9 319.3 372.3 342.7 301.1 335.4 297.2 344.9 340.5 308.9 328.3 
##   430   431   432   433   434   435   436   437   438   439   440   441   442 
## 316.1 329.4 322.4 338.1 326.0 317.8 339.7 347.6 348.2 339.8 341.9 319.2 313.3 
##   443   444   445   446   447   448   449   450   451   452   453   454   455 
## 314.7 323.8 309.3 279.9 321.3 321.3 294.3 339.5 325.4 343.1 312.8 308.5 331.9 
##   456   457   458   459   460   461   462   463   464   465   466   467   468 
## 317.4 333.9 343.1 300.0 330.5 311.7 365.4 323.0 314.4 342.3 344.5 366.2 355.6 
##   469   470   471   472   473   474   475   476   477   478   479   480   481 
## 357.0 385.6 330.4 311.1 330.5 359.2 344.1 376.8 337.8 291.1 352.8 349.0 340.7 
##   482   483   484   485   486   487   488   489   490   491   492   493   494 
## 335.5 343.5 326.4 363.1 333.0 358.5 296.6 329.1 390.2 314.9 344.1 310.2 368.0 
##   495   496   497   498   499   500   501   502   503   504   505   506   507 
## 338.6 303.9 323.3 318.4 305.1 316.0 314.0 342.9 339.0 313.6 337.7 317.0 322.0 
##   508   509   510   511   512   513   514   515   516   517   518   519   520 
## 326.2 357.2 323.4 384.3 305.2 328.3 327.6 297.2 319.8 313.0 305.3 320.0 324.4 
##   521   522   523   524   525   526   527   528   529   530   531   532   533 
## 309.4 308.9 334.5 322.9 324.8 319.5 290.3 310.3 323.1 294.8 324.5 338.4 321.2 
##   534   535   536   537   538   539   540   541   542   543   544   545   546 
## 300.6 312.0 331.1 312.2 343.0 322.6 325.6 324.2 302.4 310.4 320.4 328.5 334.5 
##   547   548   549   550   551   552   553   554   555   556   557   558   559 
## 309.8 315.8 329.6 295.3 295.0 314.9 294.4 310.6 332.3 327.7 318.0 338.5 320.5 
##   560   561   562   563   564   565   566   567   568   569   570   571   572 
## 320.4 320.5 322.5 320.6 328.0 326.3 345.6 335.9 331.8 315.8 302.8 375.2 335.0 
##   573   574   575   576   577   578   579   580   581   582   583   584   585 
## 366.3 335.0 374.5 329.4 382.0 302.1 300.6 304.7 319.6 292.4 309.4 300.9 314.8 
##   586   587   588   589   590   591   592   593   594   595   596   597   598 
## 298.7 292.8 305.5 306.1 305.8 311.5 308.9 299.0 299.2 313.9 307.5 318.9 315.9 
##   599   600   601   602   603   604   605   606   607   608   609   610   611 
## 325.2 310.6 321.0 316.3 323.2 302.5 330.6 328.8 314.7 300.7 307.0 300.2 301.6 
##   612   613   614   615   616   617   618   619   620   621   622   623   624 
## 317.7 337.8 315.7 302.2 305.4 295.5 307.4 303.0 297.3 310.8 305.9 293.4 312.2 
##   625   626 
## 354.5 354.5 
## 
## $X
##     (Intercept) unauthorised_absence_in_all_schools_percent_2013
## 1             1                                              0.8
## 2             1                                              0.7
## 3             1                                              0.5
## 4             1                                              0.4
## 5             1                                              0.7
## 6             1                                              0.9
## 7             1                                              0.8
## 8             1                                              0.6
## 9             1                                              0.7
## 10            1                                              0.5
## 11            1                                              0.6
## 12            1                                              0.6
## 13            1                                              1.4
## 14            1                                              0.6
## 15            1                                              0.5
## 16            1                                              0.5
## 17            1                                              0.9
## 18            1                                              0.7
## 19            1                                              0.7
## 20            1                                              1.5
## 21            1                                              1.1
## 22            1                                              0.9
## 23            1                                              0.8
## 24            1                                              1.3
## 25            1                                              1.5
## 26            1                                              1.6
## 27            1                                              1.4
## 28            1                                              1.3
## 29            1                                              1.1
## 30            1                                              2.1
## 31            1                                              1.2
## 32            1                                              1.9
## 33            1                                              1.0
## 34            1                                              1.6
## 35            1                                              1.1
## 36            1                                              1.3
## 37            1                                              1.4
## 38            1                                              1.3
## 39            1                                              1.3
## 40            1                                              1.4
## 41            1                                              1.2
## 42            1                                              0.7
## 43            1                                              0.8
## 44            1                                              0.8
## 45            1                                              1.0
## 46            1                                              0.3
## 47            1                                              0.7
## 48            1                                              0.4
## 49            1                                              0.7
## 50            1                                              0.3
## 51            1                                              0.6
## 52            1                                              0.6
## 53            1                                              0.7
## 54            1                                              1.4
## 55            1                                              1.1
## 56            1                                              0.9
## 57            1                                              1.0
## 58            1                                              0.7
## 59            1                                              1.7
## 60            1                                              1.0
## 61            1                                              1.3
## 62            1                                              1.7
## 63            1                                              1.4
## 64            1                                              1.5
## 65            1                                              1.3
## 66            1                                              1.1
## 67            1                                              1.2
## 68            1                                              1.0
## 69            1                                              0.9
## 70            1                                              1.0
## 71            1                                              0.6
## 72            1                                              1.3
## 73            1                                              1.1
## 74            1                                              1.3
## 75            1                                              1.3
## 76            1                                              1.2
## 77            1                                              1.3
## 78            1                                              1.1
## 79            1                                              1.2
## 80            1                                              1.1
## 81            1                                              0.6
## 82            1                                              1.0
## 83            1                                              1.1
## 84            1                                              1.1
## 85            1                                              1.1
## 86            1                                              0.7
## 87            1                                              1.0
## 88            1                                              0.9
## 89            1                                              0.3
## 90            1                                              1.3
## 91            1                                              1.1
## 92            1                                              1.0
## 93            1                                              0.5
## 94            1                                              0.8
## 95            1                                              1.0
## 96            1                                              0.9
## 97            1                                              0.8
## 98            1                                              0.7
## 99            1                                              0.8
## 100           1                                              1.1
## 101           1                                              0.8
## 102           1                                              1.0
## 103           1                                              1.0
## 104           1                                              1.0
## 105           1                                              1.0
## 106           1                                              0.4
## 107           1                                              0.8
## 108           1                                              1.0
## 109           1                                              1.1
## 110           1                                              1.0
## 111           1                                              0.8
## 112           1                                              1.1
## 113           1                                              0.7
## 114           1                                              0.5
## 115           1                                              0.7
## 116           1                                              0.5
## 117           1                                              0.6
## 118           1                                              0.9
## 119           1                                              0.6
## 120           1                                              1.4
## 121           1                                              1.4
## 122           1                                              1.6
## 123           1                                              0.6
## 124           1                                              1.3
## 125           1                                              1.0
## 126           1                                              1.6
## 127           1                                              1.5
## 128           1                                              1.1
## 129           1                                              1.3
## 130           1                                              0.7
## 131           1                                              0.7
## 132           1                                              0.3
## 133           1                                              0.6
## 134           1                                              0.7
## 135           1                                              0.7
## 136           1                                              0.5
## 137           1                                              0.4
## 138           1                                              0.6
## 139           1                                              1.3
## 140           1                                              1.2
## 141           1                                              0.9
## 142           1                                              1.2
## 143           1                                              1.1
## 144           1                                              1.2
## 145           1                                              0.4
## 146           1                                              0.8
## 147           1                                              0.8
## 148           1                                              0.8
## 149           1                                              0.3
## 150           1                                              1.0
## 151           1                                              0.5
## 152           1                                              0.9
## 153           1                                              1.2
## 154           1                                              1.0
## 155           1                                              0.7
## 156           1                                              0.8
## 157           1                                              0.9
## 158           1                                              0.7
## 159           1                                              0.8
## 160           1                                              0.6
## 161           1                                              0.7
## 162           1                                              1.2
## 163           1                                              0.6
## 164           1                                              0.7
## 165           1                                              0.6
## 166           1                                              0.7
## 167           1                                              0.7
## 168           1                                              1.0
## 169           1                                              1.1
## 170           1                                              1.5
## 171           1                                              1.2
## 172           1                                              1.0
## 173           1                                              0.8
## 174           1                                              1.0
## 175           1                                              1.2
## 176           1                                              1.1
## 177           1                                              1.4
## 178           1                                              1.2
## 179           1                                              0.9
## 180           1                                              1.1
## 181           1                                              1.0
## 182           1                                              1.1
## 183           1                                              0.8
## 184           1                                              1.0
## 185           1                                              1.2
## 186           1                                              1.2
## 187           1                                              0.8
## 188           1                                              1.1
## 189           1                                              0.6
## 190           1                                              0.9
## 191           1                                              1.0
## 192           1                                              1.3
## 193           1                                              1.1
## 194           1                                              0.7
## 195           1                                              0.8
## 196           1                                              0.8
## 197           1                                              1.0
## 198           1                                              1.2
## 199           1                                              0.9
## 200           1                                              0.7
## 201           1                                              0.8
## 202           1                                              0.8
## 203           1                                              0.9
## 204           1                                              0.8
## 205           1                                              0.6
## 206           1                                              1.2
## 207           1                                              1.0
## 208           1                                              0.7
## 209           1                                              1.1
## 210           1                                              1.3
## 211           1                                              1.3
## 212           1                                              1.2
## 213           1                                              1.1
## 214           1                                              1.2
## 215           1                                              1.0
## 216           1                                              1.1
## 217           1                                              1.2
## 218           1                                              1.3
## 219           1                                              0.9
## 220           1                                              1.1
## 221           1                                              0.9
## 222           1                                              1.2
## 223           1                                              1.2
## 224           1                                              1.3
## 225           1                                              1.1
## 226           1                                              1.1
## 227           1                                              1.0
## 228           1                                              1.0
## 229           1                                              0.9
## 230           1                                              1.0
## 231           1                                              1.6
## 232           1                                              0.4
## 233           1                                              0.9
## 234           1                                              1.1
## 235           1                                              0.8
## 236           1                                              1.1
## 237           1                                              1.3
## 238           1                                              1.1
## 239           1                                              1.0
## 240           1                                              1.0
## 241           1                                              1.3
## 242           1                                              1.2
## 243           1                                              1.4
## 244           1                                              1.3
## 245           1                                              1.4
## 246           1                                              1.5
## 247           1                                              1.4
## 248           1                                              1.0
## 249           1                                              1.4
## 250           1                                              1.1
## 251           1                                              1.5
## 252           1                                              0.8
## 253           1                                              1.5
## 254           1                                              1.4
## 255           1                                              1.4
## 256           1                                              1.4
## 257           1                                              1.1
## 258           1                                              1.1
## 259           1                                              1.1
## 260           1                                              1.0
## 261           1                                              1.0
## 262           1                                              1.2
## 263           1                                              1.3
## 264           1                                              1.4
## 265           1                                              1.2
## 266           1                                              1.5
## 267           1                                              1.0
## 268           1                                              1.4
## 269           1                                              1.8
## 270           1                                              0.8
## 271           1                                              1.2
## 272           1                                              1.0
## 273           1                                              1.4
## 274           1                                              1.7
## 275           1                                              1.4
## 276           1                                              1.6
## 277           1                                              1.2
## 278           1                                              1.6
## 279           1                                              0.7
## 280           1                                              1.4
## 281           1                                              1.3
## 282           1                                              1.5
## 283           1                                              1.8
## 284           1                                              1.2
## 285           1                                              1.2
## 286           1                                              0.7
## 287           1                                              0.8
## 288           1                                              1.0
## 289           1                                              0.7
## 290           1                                              0.5
## 291           1                                              1.2
## 292           1                                              1.4
## 293           1                                              1.2
## 294           1                                              1.0
## 295           1                                              1.0
## 296           1                                              0.8
## 297           1                                              0.9
## 298           1                                              0.7
## 299           1                                              1.0
## 300           1                                              0.8
## 301           1                                              0.7
## 302           1                                              0.5
## 303           1                                              0.9
## 304           1                                              0.8
## 305           1                                              1.0
## 306           1                                              0.8
## 307           1                                              1.4
## 308           1                                              0.7
## 309           1                                              0.9
## 310           1                                              0.9
## 311           1                                              2.0
## 312           1                                              1.0
## 313           1                                              2.1
## 314           1                                              2.2
## 315           1                                              0.9
## 316           1                                              1.5
## 317           1                                              1.6
## 318           1                                              1.7
## 319           1                                              1.1
## 320           1                                              0.9
## 321           1                                              0.8
## 322           1                                              2.1
## 323           1                                              0.9
## 324           1                                              0.7
## 325           1                                              1.5
## 326           1                                              2.0
## 327           1                                              2.2
## 328           1                                              1.5
## 329           1                                              1.2
## 330           1                                              1.1
## 331           1                                              1.4
## 332           1                                              1.0
## 333           1                                              1.5
## 334           1                                              1.5
## 335           1                                              1.3
## 336           1                                              1.3
## 337           1                                              1.1
## 338           1                                              1.0
## 339           1                                              1.1
## 340           1                                              1.0
## 341           1                                              0.9
## 342           1                                              1.0
## 343           1                                              1.5
## 344           1                                              1.3
## 345           1                                              1.1
## 346           1                                              1.2
## 347           1                                              1.0
## 348           1                                              1.0
## 349           1                                              1.4
## 350           1                                              0.8
## 351           1                                              1.1
## 352           1                                              1.0
## 353           1                                              1.2
## 354           1                                              0.8
## 355           1                                              0.9
## 356           1                                              1.5
## 357           1                                              1.6
## 358           1                                              1.5
## 359           1                                              1.3
## 360           1                                              1.2
## 361           1                                              1.1
## 362           1                                              0.7
## 363           1                                              0.8
## 364           1                                              0.7
## 365           1                                              0.9
## 366           1                                              0.9
## 367           1                                              0.9
## 368           1                                              0.5
## 369           1                                              1.0
## 370           1                                              0.6
## 371           1                                              1.4
## 372           1                                              1.3
## 373           1                                              1.4
## 374           1                                              0.9
## 375           1                                              0.5
## 376           1                                              0.9
## 377           1                                              1.1
## 378           1                                              0.8
## 379           1                                              1.3
## 380           1                                              0.8
## 381           1                                              0.8
## 382           1                                              0.5
## 383           1                                              1.0
## 384           1                                              0.9
## 385           1                                              1.1
## 386           1                                              0.9
## 387           1                                              0.5
## 388           1                                              0.5
## 389           1                                              0.6
## 390           1                                              1.0
## 391           1                                              0.8
## 392           1                                              1.0
## 393           1                                              0.9
## 394           1                                              1.0
## 395           1                                              0.9
## 396           1                                              0.9
## 397           1                                              0.8
## 398           1                                              0.5
## 399           1                                              0.6
## 400           1                                              0.9
## 401           1                                              0.4
## 402           1                                              0.6
## 403           1                                              1.0
## 404           1                                              1.1
## 405           1                                              0.6
## 406           1                                              1.2
## 407           1                                              0.6
## 408           1                                              0.5
## 409           1                                              1.1
## 410           1                                              0.7
## 411           1                                              0.4
## 412           1                                              0.4
## 413           1                                              1.2
## 414           1                                              1.4
## 415           1                                              0.4
## 416           1                                              0.7
## 417           1                                              1.4
## 418           1                                              1.2
## 419           1                                              1.0
## 420           1                                              1.1
## 421           1                                              0.4
## 422           1                                              0.8
## 423           1                                              1.6
## 424           1                                              1.1
## 425           1                                              1.4
## 426           1                                              0.8
## 427           1                                              0.8
## 428           1                                              0.9
## 429           1                                              1.3
## 430           1                                              1.0
## 431           1                                              1.0
## 432           1                                              0.9
## 433           1                                              0.7
## 434           1                                              1.0
## 435           1                                              0.7
## 436           1                                              0.9
## 437           1                                              0.7
## 438           1                                              0.7
## 439           1                                              1.1
## 440           1                                              0.8
## 441           1                                              1.3
## 442           1                                              1.3
## 443           1                                              1.2
## 444           1                                              1.0
## 445           1                                              0.9
## 446           1                                              0.9
## 447           1                                              1.2
## 448           1                                              1.2
## 449           1                                              1.2
## 450           1                                              1.1
## 451           1                                              1.3
## 452           1                                              1.1
## 453           1                                              1.6
## 454           1                                              1.3
## 455           1                                              1.0
## 456           1                                              1.3
## 457           1                                              1.3
## 458           1                                              1.1
## 459           1                                              1.3
## 460           1                                              1.1
## 461           1                                              1.5
## 462           1                                              1.4
## 463           1                                              1.0
## 464           1                                              1.3
## 465           1                                              1.0
## 466           1                                              1.1
## 467           1                                              1.5
## 468           1                                              0.9
## 469           1                                              1.3
## 470           1                                              0.5
## 471           1                                              1.1
## 472           1                                              1.3
## 473           1                                              1.6
## 474           1                                              0.9
## 475           1                                              0.6
## 476           1                                              0.6
## 477           1                                              0.8
## 478           1                                              0.5
## 479           1                                              0.8
## 480           1                                              1.5
## 481           1                                              0.5
## 482           1                                              2.1
## 483           1                                              1.4
## 484           1                                              0.8
## 485           1                                              0.8
## 486           1                                              1.1
## 487           1                                              1.2
## 488           1                                              1.3
## 489           1                                              0.8
## 490           1                                              1.0
## 491           1                                              1.2
## 492           1                                              1.3
## 493           1                                              1.2
## 494           1                                              0.9
## 495           1                                              1.2
## 496           1                                              1.5
## 497           1                                              1.0
## 498           1                                              1.3
## 499           1                                              0.9
## 500           1                                              1.0
## 501           1                                              0.8
## 502           1                                              1.0
## 503           1                                              1.1
## 504           1                                              0.9
## 505           1                                              0.8
## 506           1                                              0.9
## 507           1                                              1.0
## 508           1                                              1.1
## 509           1                                              0.8
## 510           1                                              1.0
## 511           1                                              1.1
## 512           1                                              0.8
## 513           1                                              1.0
## 514           1                                              0.9
## 515           1                                              1.1
## 516           1                                              0.9
## 517           1                                              1.3
## 518           1                                              1.3
## 519           1                                              0.9
## 520           1                                              0.9
## 521           1                                              1.1
## 522           1                                              1.0
## 523           1                                              1.0
## 524           1                                              1.0
## 525           1                                              1.0
## 526           1                                              1.3
## 527           1                                              1.1
## 528           1                                              1.0
## 529           1                                              1.1
## 530           1                                              1.4
## 531           1                                              1.1
## 532           1                                              0.9
## 533           1                                              0.8
## 534           1                                              1.6
## 535           1                                              1.6
## 536           1                                              1.4
## 537           1                                              1.6
## 538           1                                              1.0
## 539           1                                              0.9
## 540           1                                              1.1
## 541           1                                              1.3
## 542           1                                              1.6
## 543           1                                              1.8
## 544           1                                              1.4
## 545           1                                              1.2
## 546           1                                              1.3
## 547           1                                              1.3
## 548           1                                              1.3
## 549           1                                              1.1
## 550           1                                              1.2
## 551           1                                              1.1
## 552           1                                              1.4
## 553           1                                              1.2
## 554           1                                              1.3
## 555           1                                              1.3
## 556           1                                              1.1
## 557           1                                              1.1
## 558           1                                              1.3
## 559           1                                              1.3
## 560           1                                              0.8
## 561           1                                              1.0
## 562           1                                              1.2
## 563           1                                              1.2
## 564           1                                              1.2
## 565           1                                              1.0
## 566           1                                              0.7
## 567           1                                              0.9
## 568           1                                              1.3
## 569           1                                              1.3
## 570           1                                              1.5
## 571           1                                              0.8
## 572           1                                              1.4
## 573           1                                              0.7
## 574           1                                              1.2
## 575           1                                              0.8
## 576           1                                              1.1
## 577           1                                              0.6
## 578           1                                              1.9
## 579           1                                              1.7
## 580           1                                              1.9
## 581           1                                              1.4
## 582           1                                              1.6
## 583           1                                              1.4
## 584           1                                              1.5
## 585           1                                              1.7
## 586           1                                              1.9
## 587           1                                              1.5
## 588           1                                              1.5
## 589           1                                              1.9
## 590           1                                              2.0
## 591           1                                              1.6
## 592           1                                              1.5
## 593           1                                              1.8
## 594           1                                              1.7
## 595           1                                              1.3
## 596           1                                              1.4
## 597           1                                              1.1
## 598           1                                              1.2
## 599           1                                              1.5
## 600           1                                              1.5
## 601           1                                              1.2
## 602           1                                              1.4
## 603           1                                              1.5
## 604           1                                              1.8
## 605           1                                              1.2
## 606           1                                              1.2
## 607           1                                              1.0
## 608           1                                              1.3
## 609           1                                              1.2
## 610           1                                              1.3
## 611           1                                              1.5
## 612           1                                              1.4
## 613           1                                              0.8
## 614           1                                              1.4
## 615           1                                              1.2
## 616           1                                              1.3
## 617           1                                              1.5
## 618           1                                              1.5
## 619           1                                              1.6
## 620           1                                              1.1
## 621           1                                              1.1
## 622           1                                              1.2
## 623           1                                              1.6
## 624           1                                              1.2
## 625           1                                              0.7
## 626           1                                              0.7
##     log(median_house_price_2014)
## 1                       12.66033
## 2                       12.72842
## 3                       12.79698
## 4                       12.91158
## 5                       12.98310
## 6                       13.08154
## 7                       12.64433
## 8                       12.89111
## 9                       12.88847
## 10                      12.88753
## 11                      12.89922
## 12                      13.01589
## 13                      12.74183
## 14                      13.08154
## 15                      13.00261
## 16                      13.21767
## 17                      12.83468
## 18                      12.74840
## 19                      12.79663
## 20                      12.40185
## 21                      12.73670
## 22                      12.67608
## 23                      12.88029
## 24                      12.46844
## 25                      12.37159
## 26                      12.35017
## 27                      12.36734
## 28                      12.41410
## 29                      12.76569
## 30                      12.40901
## 31                      12.42922
## 32                      12.30138
## 33                      12.67608
## 34                      12.26904
## 35                      12.75708
## 36                      12.42922
## 37                      12.42922
## 38                      12.57677
## 39                      12.38839
## 40                      12.42922
## 41                      13.00583
## 42                      12.99737
## 43                      12.76569
## 44                      12.89922
## 45                      12.50599
## 46                      13.07107
## 47                      12.64029
## 48                      12.95181
## 49                      12.88664
## 50                      13.05622
## 51                      12.69772
## 52                      13.08154
## 53                      13.09190
## 54                      12.42922
## 55                      12.67608
## 56                      12.66033
## 57                      12.59623
## 58                      12.88664
## 59                      12.42922
## 60                      12.73670
## 61                      12.42922
## 62                      12.39669
## 63                      12.34148
## 64                      12.42922
## 65                      12.33050
## 66                      12.80765
## 67                      12.54254
## 68                      12.42118
## 69                      12.75275
## 70                      12.82126
## 71                      13.55739
## 72                      12.32386
## 73                      12.42922
## 74                      12.50618
## 75                      12.42902
## 76                      12.50618
## 77                      12.75996
## 78                      12.83468
## 79                      12.61487
## 80                      12.42902
## 81                      13.38473
## 82                      13.35980
## 83                      12.45877
## 84                      12.40082
## 85                      12.32878
## 86                      12.48749
## 87                      12.42521
## 88                      12.75130
## 89                      13.32938
## 90                      12.87518
## 91                      12.42922
## 92                      12.92086
## 93                      13.32530
## 94                      12.56024
## 95                      12.61154
## 96                      12.86424
## 97                      13.12236
## 98                      12.63460
## 99                      12.81448
## 100                     13.19189
## 101                     13.03892
## 102                     12.99453
## 103                     13.56705
## 104                     13.25339
## 105                     13.15966
## 106                     12.94801
## 107                     12.38839
## 108                     12.39669
## 109                     12.42922
## 110                     12.24289
## 111                     12.32386
## 112                     12.42922
## 113                     12.59473
## 114                     12.59980
## 115                     12.51539
## 116                     12.80765
## 117                     12.54344
## 118                     12.42922
## 119                     12.67608
## 120                     12.42922
## 121                     12.28765
## 122                     12.34148
## 123                     12.52453
## 124                     12.25009
## 125                     12.64433
## 126                     12.42920
## 127                     12.32386
## 128                     12.46458
## 129                     12.51997
## 130                     12.76555
## 131                     12.64755
## 132                     13.16351
## 133                     12.72189
## 134                     13.06049
## 135                     12.62807
## 136                     12.82799
## 137                     13.12236
## 138                     12.93241
## 139                     12.54254
## 140                     12.42922
## 141                     12.52453
## 142                     12.54254
## 143                     12.42922
## 144                     12.42922
## 145                     12.89922
## 146                     12.77987
## 147                     12.74549
## 148                     12.89922
## 149                     13.16158
## 150                     12.51356
## 151                     12.96571
## 152                     12.50228
## 153                     12.85840
## 154                     13.22672
## 155                     12.90545
## 156                     12.84793
## 157                     12.57764
## 158                     12.80353
## 159                     13.12236
## 160                     12.68386
## 161                     12.98189
## 162                     12.64433
## 163                     12.98310
## 164                     12.84793
## 165                     12.87390
## 166                     12.78689
## 167                     13.06049
## 168                     12.42922
## 169                     12.76569
## 170                     12.42902
## 171                     12.58613
## 172                     12.71590
## 173                     12.48276
## 174                     12.42902
## 175                     12.42902
## 176                     13.12236
## 177                     12.62971
## 178                     12.92269
## 179                     13.42616
## 180                     13.04979
## 181                     13.00500
## 182                     12.68386
## 183                     12.99453
## 184                     13.11231
## 185                     12.63134
## 186                     13.01700
## 187                     12.81039
## 188                     12.87377
## 189                     12.94663
## 190                     12.75492
## 191                     13.22717
## 192                     12.61984
## 193                     13.13725
## 194                     13.62314
## 195                     13.17685
## 196                     12.98883
## 197                     13.02805
## 198                     13.16158
## 199                     12.89232
## 200                     13.34990
## 201                     12.81039
## 202                     12.82126
## 203                     12.72189
## 204                     12.98310
## 205                     12.81584
## 206                     12.42922
## 207                     12.76569
## 208                     12.86100
## 209                     12.83468
## 210                     12.73670
## 211                     12.75383
## 212                     12.77987
## 213                     13.14461
## 214                     12.79108
## 215                     13.33747
## 216                     12.94801
## 217                     12.94084
## 218                     12.98310
## 219                     13.11730
## 220                     12.97154
## 221                     13.45883
## 222                     12.88664
## 223                     12.76569
## 224                     12.93059
## 225                     12.97734
## 226                     13.28788
## 227                     13.32121
## 228                     12.87742
## 229                     13.11231
## 230                     12.76569
## 231                     13.27937
## 232                     13.65299
## 233                     12.88939
## 234                     13.25777
## 235                     12.95039
## 236                     12.64433
## 237                     12.75564
## 238                     12.91780
## 239                     12.78339
## 240                     12.56024
## 241                     12.84793
## 242                     12.66033
## 243                     12.66033
## 244                     12.57762
## 245                     12.57080
## 246                     13.27078
## 247                     13.12236
## 248                     12.95229
## 249                     12.93603
## 250                     12.99907
## 251                     12.48749
## 252                     12.79386
## 253                     12.39876
## 254                     12.42118
## 255                     12.86100
## 256                     12.76569
## 257                     12.73670
## 258                     12.77987
## 259                     12.50618
## 260                     12.71440
## 261                     13.02805
## 262                     12.82126
## 263                     12.57764
## 264                     12.70685
## 265                     12.39669
## 266                     12.42922
## 267                     12.90545
## 268                     12.66033
## 269                     12.58709
## 270                     12.69158
## 271                     12.57332
## 272                     12.50618
## 273                     12.84529
## 274                     12.49219
## 275                     13.01700
## 276                     12.66191
## 277                     12.96571
## 278                     12.46863
## 279                     12.75130
## 280                     12.80216
## 281                     12.49687
## 282                     12.42521
## 283                     12.32383
## 284                     12.15478
## 285                     12.42922
## 286                     12.42922
## 287                     12.54254
## 288                     12.56024
## 289                     12.54254
## 290                     12.66033
## 291                     12.35234
## 292                     12.22831
## 293                     12.10625
## 294                     12.09793
## 295                     12.15478
## 296                     12.54254
## 297                     12.46650
## 298                     12.52453
## 299                     12.49031
## 300                     12.52453
## 301                     12.54254
## 302                     12.66033
## 303                     12.42922
## 304                     12.42922
## 305                     12.41714
## 306                     12.45877
## 307                     12.68850
## 308                     12.98310
## 309                     13.06473
## 310                     12.83468
## 311                     12.42922
## 312                     12.77564
## 313                     12.25486
## 314                     12.42118
## 315                     12.79386
## 316                     12.42922
## 317                     12.42118
## 318                     12.42922
## 319                     12.67606
## 320                     13.12236
## 321                     12.75852
## 322                     12.46844
## 323                     12.79441
## 324                     12.76569
## 325                     12.48749
## 326                     12.42922
## 327                     12.28880
## 328                     12.44902
## 329                     12.71590
## 330                     12.69158
## 331                     12.56024
## 332                     12.70685
## 333                     12.71440
## 334                     12.55409
## 335                     12.68850
## 336                     12.63786
## 337                     12.90172
## 338                     12.77032
## 339                     12.79386
## 340                     12.86747
## 341                     12.73670
## 342                     12.57331
## 343                     12.69465
## 344                     12.72189
## 345                     12.64433
## 346                     12.56549
## 347                     12.75130
## 348                     13.03898
## 349                     12.81448
## 350                     12.66033
## 351                     12.61984
## 352                     12.64433
## 353                     12.63460
## 354                     12.66033
## 355                     12.73670
## 356                     12.42921
## 357                     12.17045
## 358                     12.36734
## 359                     12.62807
## 360                     12.32386
## 361                     12.59134
## 362                     12.79772
## 363                     12.87390
## 364                     12.73670
## 365                     12.81787
## 366                     12.73522
## 367                     12.42922
## 368                     13.12186
## 369                     12.94800
## 370                     12.83734
## 371                     12.86359
## 372                     12.42118
## 373                     12.40287
## 374                     12.57764
## 375                     12.87005
## 376                     12.73080
## 377                     12.42922
## 378                     12.50618
## 379                     12.38839
## 380                     12.66981
## 381                     12.61320
## 382                     12.75852
## 383                     12.45877
## 384                     12.41309
## 385                     12.51356
## 386                     12.57418
## 387                     13.30460
## 388                     13.12226
## 389                     13.02805
## 390                     12.84924
## 391                     13.03621
## 392                     13.12236
## 393                     13.34651
## 394                     13.35348
## 395                     13.80040
## 396                     13.52315
## 397                     12.72189
## 398                     13.08154
## 399                     13.01700
## 400                     12.94801
## 401                     13.22762
## 402                     13.30468
## 403                     13.39239
## 404                     14.12483
## 405                     13.02805
## 406                     12.40901
## 407                     14.24078
## 408                     13.50422
## 409                     12.67608
## 410                     13.07107
## 411                     13.12136
## 412                     13.24458
## 413                     12.54254
## 414                     12.56024
## 415                     13.16638
## 416                     13.08674
## 417                     12.42922
## 418                     12.57072
## 419                     12.86876
## 420                     12.59473
## 421                     13.24237
## 422                     13.11635
## 423                     12.54254
## 424                     12.76569
## 425                     12.83455
## 426                     13.45884
## 427                     13.24988
## 428                     12.88664
## 429                     13.11795
## 430                     13.18815
## 431                     12.99453
## 432                     12.99567
## 433                     13.15241
## 434                     13.20117
## 435                     13.29632
## 436                     12.92391
## 437                     13.11534
## 438                     13.29632
## 439                     13.12236
## 440                     13.58610
## 441                     12.89546
## 442                     13.18063
## 443                     13.35348
## 444                     13.45884
## 445                     13.76422
## 446                     13.52114
## 447                     13.62647
## 448                     14.10069
## 449                     13.59860
## 450                     13.46453
## 451                     13.51609
## 452                     13.33465
## 453                     13.12236
## 454                     12.96571
## 455                     12.99453
## 456                     13.03462
## 457                     13.44445
## 458                     13.57503
## 459                     13.23211
## 460                     13.25777
## 461                     13.86430
## 462                     14.13396
## 463                     14.11042
## 464                     13.18778
## 465                     13.81050
## 466                     13.91082
## 467                     14.50615
## 468                     14.48334
## 469                     14.07402
## 470                     13.93551
## 471                     13.56191
## 472                     13.74830
## 473                     13.37312
## 474                     13.57121
## 475                     14.09692
## 476                     14.37227
## 477                     14.27767
## 478                     14.15198
## 479                     14.04860
## 480                     13.70458
## 481                     15.06827
## 482                     13.65299
## 483                     13.91082
## 484                     13.64116
## 485                     14.21261
## 486                     13.12226
## 487                     13.79019
## 488                     13.75629
## 489                     13.52783
## 490                     13.90169
## 491                     13.20854
## 492                     13.65299
## 493                     13.66148
## 494                     13.48095
## 495                     13.12231
## 496                     13.67625
## 497                     13.55803
## 498                     12.99453
## 499                     13.51508
## 500                     13.38473
## 501                     13.05622
## 502                     13.23569
## 503                     13.43717
## 504                     13.04979
## 505                     13.60910
## 506                     13.23569
## 507                     13.34551
## 508                     13.26213
## 509                     13.76947
## 510                     13.30468
## 511                     13.98946
## 512                     13.35363
## 513                     13.34150
## 514                     13.65299
## 515                     13.21276
## 516                     13.30468
## 517                     12.94801
## 518                     12.84793
## 519                     12.82126
## 520                     13.02365
## 521                     12.83468
## 522                     12.78689
## 523                     12.86100
## 524                     12.85579
## 525                     12.80285
## 526                     12.69158
## 527                     12.58793
## 528                     12.61984
## 529                     12.93603
## 530                     12.69158
## 531                     13.10012
## 532                     13.12235
## 533                     13.14217
## 534                     13.50422
## 535                     13.01143
## 536                     13.38473
## 537                     12.91164
## 538                     13.41129
## 539                     13.12236
## 540                     13.04979
## 541                     13.36922
## 542                     13.41129
## 543                     13.21767
## 544                     13.48004
## 545                     13.11362
## 546                     13.02144
## 547                     12.92391
## 548                     13.01143
## 549                     13.17115
## 550                     13.02254
## 551                     12.99453
## 552                     13.08154
## 553                     13.04979
## 554                     12.73670
## 555                     13.09190
## 556                     13.08803
## 557                     12.97849
## 558                     12.83468
## 559                     12.73670
## 560                     12.83468
## 561                     12.85579
## 562                     13.07107
## 563                     13.06314
## 564                     13.01700
## 565                     12.93603
## 566                     13.12226
## 567                     12.94801
## 568                     12.56024
## 569                     13.50422
## 570                     12.97154
## 571                     13.04979
## 572                     12.71394
## 573                     13.24237
## 574                     13.07632
## 575                     13.61706
## 576                     12.94563
## 577                     13.34551
## 578                     12.76569
## 579                     12.75130
## 580                     12.82126
## 581                     12.82799
## 582                     12.69619
## 583                     12.76569
## 584                     12.43520
## 585                     12.49500
## 586                     12.69158
## 587                     12.43917
## 588                     12.62314
## 589                     12.42521
## 590                     12.36094
## 591                     12.38839
## 592                     12.54254
## 593                     12.54254
## 594                     12.42922
## 595                     12.42922
## 596                     12.51906
## 597                     12.42922
## 598                     12.48333
## 599                     12.42922
## 600                     12.42922
## 601                     12.42922
## 602                     12.46844
## 603                     12.42920
## 604                     12.42922
## 605                     12.65396
## 606                     12.42911
## 607                     12.34583
## 608                     12.20607
## 609                     12.29683
## 610                     12.23320
## 611                     12.21850
## 612                     12.06105
## 613                     12.65316
## 614                     12.30138
## 615                     12.23077
## 616                     12.26434
## 617                     12.25486
## 618                     12.27839
## 619                     12.27839
## 620                     12.27839
## 621                     12.36734
## 622                     12.38839
## 623                     12.39048
## 624                     12.26905
## 625                     13.54763
## 626                     13.54763
## attr(,&quot;assign&quot;)
## [1] 0 1 2
## 
## $fitted.values
##        1        2        3        4        5        6        7        8 
## 333.0360 338.1337 347.1743 352.2455 343.1466 337.5510 333.1411 344.1024 
##        9       10       11       12       13       14       15       16 
## 340.7961 347.6766 345.1410 346.2779 313.6328 346.1950 349.4797 351.8737 
##       17       18       19       20       21       22       23       24 
## 331.9402 338.6404 339.2962 305.9128 324.0797 331.4013 336.7198 314.5142 
##       25       26       27       28       29       30       31       32 
## 306.0416 301.3155 309.3048 312.6783 325.4449 283.9564 316.8307 289.2831 
##       33       34       35       36       37       38       39       40 
## 326.9119 301.0729 324.8058 313.4859 309.5417 315.2556 312.8760 309.2461 
##       41       42       43       44       45       46       47       48 
## 324.3998 342.9336 335.9228 336.9243 324.1371 357.5199 337.8059 352.9672 
##       49       50       51       52       53       54       55       56 
## 340.7412 357.3638 342.8084 346.7951 343.8476 310.1106 323.4762 331.1747 
##       57       58       59       60       61       62       63       64 
## 326.1567 341.5173 298.4344 327.6913 313.2277 298.3536 307.8757 306.2248 
##       65       66       67       68       69       70       71       72 
## 312.2430 325.5820 319.0448 324.5404 332.3160 329.9811 353.6785 311.5273 
##       73       74       75       76       77       78       79       80 
## 320.3884 314.4084 313.7677 317.8137 317.0730 326.4820 318.9375 320.5016 
##       81       82       83       84       85       86       87       88 
## 350.6250 336.1177 321.3616 320.0378 319.4080 335.8822 324.8182 332.2968 
##       89       90       91       92       93       94       95       96 
## 360.4584 320.1626 320.6481 331.4991 353.1953 332.6013 326.6152 333.3954 
##       97       98       99      100      101      102      103      104 
## 340.0317 337.1787 336.6951 331.0132 339.0092 331.1995 338.6587 334.4333 
##      105      106      107      108      109      110      111      112 
## 334.1071 352.2817 330.7192 323.8236 321.2531 322.4546 329.9760 320.3291 
##      113      114      115      116      117      118      119      120 
## 337.4347 344.0257 336.3426 347.1718 340.2044 327.9214 341.6528 309.4803 
##      121      122      123      124      125      126      127      128 
## 307.6997 300.5825 340.2670 311.1634 326.2433 302.0060 304.2635 320.2612 
##      129      130      131      132      133      134      135      136 
## 314.5840 338.8405 337.9503 358.6249 342.8472 342.2770 339.5207 346.9220 
##      137      138      139      140      141      142      143      144 
## 354.5704 344.9369 314.2860 317.5639 329.3638 318.7522 320.1194 317.0567 
##      145      146      147      148      149      150      151      152 
## 351.7687 335.6830 335.8723 337.0059 359.2570 325.7939 350.1419 328.9406 
##      153      154      155      156      157      158      159      160 
## 322.2683 333.5526 340.9197 336.9431 329.6026 339.9688 339.4696 341.4827 
##      161      162      163      164      165      166      167      168 
## 342.4980 319.2840 346.0615 339.9352 344.4718 339.4124 343.1931 323.7567 
##      169      170      171      172      173      174      175      176 
## 324.9607 306.7293 319.2884 327.9308 332.2539 324.3432 317.3382 329.6836 
##      177      178      179      180      181      182      183      184 
## 312.0025 322.9888 340.4850 328.7579 331.6141 323.8671 339.2958 332.8160 
##      185      186      187      188      189      190      191      192 
## 319.6409 324.7498 336.6689 325.8181 344.7790 332.0351 334.4604 316.2136 
##      193      194      195      196      197      198      199      200 
## 330.0025 350.9284 341.1310 338.7978 331.3074 326.4245 333.8053 346.8712 
##      201      202      203      204      205      206      207      208 
## 336.7659 336.3439 332.3953 338.6412 343.1631 316.8062 328.3442 340.4712 
##      209      210      211      212      213      214      215      216 
## 326.1087 317.0734 316.9970 321.7373 329.4245 322.1666 336.0355 326.8764 
##      217      218      219      220      221      222      223      224 
## 323.4649 319.8302 337.0450 326.9251 341.2011 323.0666 320.9804 320.0438 
##      225      226      227      228      229      230      231      232 
## 328.1044 331.5883 335.5069 329.6389 336.8677 329.0976 313.6168 361.1393 
##      233      234      235      236      237      238      239      240 
## 333.7512 330.8701 338.6658 323.1066 317.5396 327.1315 328.4464 325.6489 
##      241      242      243      244      245      246      247      248 
## 318.9845 319.6758 313.2754 315.8194 311.3015 317.6970 318.2380 330.8395 
##      249      250      251      252      253      254      255      256 
## 316.1758 327.0114 307.7318 336.1056 305.8150 309.6582 314.9880 314.0233 
##      257      258      259      260      261      262      263      264 
## 324.2632 324.7720 321.5934 327.2603 331.8266 321.6689 316.0753 312.9956 
##      265      266      267      268      269      270      271      272 
## 316.6184 306.7379 329.9598 312.6915 297.8884 334.6172 319.2211 325.2662 
##      273      274      275      276      277      278      279      280 
## 315.2854 299.4490 317.9614 305.2957 324.0411 303.0939 339.2428 314.2125 
##      281      282      283      284      285      286      287      288 
## 313.9964 306.1498 293.9821 313.8056 316.7414 335.5020 332.7887 325.7158 
##      289      290      291      292      293      294      295      296 
## 336.3894 345.3495 315.2671 306.9691 312.9129 320.0657 320.7634 333.0578 
##      297      298      299      300      301      302      303      304 
## 328.4230 336.4672 325.1388 332.5296 336.5626 345.5902 327.5881 331.5258 
##      305      306      307      308      309      310      311      312 
## 323.8442 331.8777 312.8541 341.9858 336.0321 332.8356 288.6278 328.7112 
##      313      314      315      316      317      318      319      320 
## 281.7001 280.4821 332.6332 306.5230 301.9341 298.3910 324.0604 337.3876 
##      321      322      323      324      325      326      327      328 
## 335.8259 285.2580 332.5792 338.8937 307.5396 287.5456 277.9842 306.4131 
##      329      330      331      332      333      334      335      336 
## 321.4822 324.2008 311.6951 327.5666 309.4661 308.3245 315.8745 315.4697 
##      337      338      339      340      341      342      343      344 
## 326.9179 328.0319 325.5311 329.8720 332.0546 326.1838 309.2821 316.8756 
##      345      346      347      348      349      350      351      352 
## 323.3725 318.5664 328.3789 333.2382 314.5389 334.8380 323.5466 326.4650 
##      353      354      355      356      357      358      359      360 
## 320.2287 335.0525 331.2950 305.8971 299.3872 305.2264 315.6882 315.8331 
##      361      362      363      364      365      366      367      368 
## 322.2106 339.8342 336.9552 338.8493 332.6573 331.8771 327.6317 351.1531 
##      369      370      371      372      373      374      375      376 
## 331.6055 343.4777 315.1278 313.3923 309.5145 329.3416 347.4797 331.5659 
##      377      378      379      380      381      382      383      384 
## 320.5359 332.6409 312.7622 334.3623 333.6218 347.2359 324.7260 327.2323 
##      385      386      387      388      389      390      391      392 
## 321.8775 330.3155 353.8146 351.0080 346.4884 329.6259 338.7581 334.2585 
##      393      394      395      396      397      398      399      400 
## 339.9373 336.0465 345.2773 342.7291 334.7138 350.4404 346.5737 334.2938 
##      401      402      403      404      405      406      407      408 
## 356.5582 350.5516 336.3421 342.3982 346.2011 317.6794 361.6407 356.3347 
##      409      410      411      412      413      414      415      416 
## 323.6344 344.0332 354.9839 356.7690 318.6061 311.5079 355.3747 343.8103 
##      417      418      419      420      421      422      423      424 
## 309.8077 318.5431 329.8713 322.4983 356.1378 340.3341 303.4602 325.2259 
##      425      426      427      428      429      430      431      432 
## 315.3650 344.8107 341.6257 333.4643 321.5740 333.8831 331.2025 335.7076 
##      433      434      435      436      437      438      439      440 
## 344.0018 333.8066 345.8737 333.9318 344.4094 345.8058 330.3125 346.6851 
##      441      442      443      444      445      446      447      448 
## 319.0640 322.9495 329.8903 336.9648 345.0266 341.1026 332.1507 338.3964 
##      449      450      451      452      453      454      455      456 
## 332.0957 333.1819 327.4823 332.4786 311.6547 319.6297 332.0177 321.6164 
##      457      458      459      460      461      462      463      464 
## 325.6009 335.3295 323.0457 330.6265 324.0533 331.3355 345.8199 323.8729 
##      465      466      467      468      469      470      471      472 
## 341.4611 339.7300 332.6903 353.6184 334.2884 361.0832 334.9452 330.1503 
##      473      474      475      476      477      478      479      480 
## 313.6390 342.3431 359.9481 363.0246 354.3534 364.5744 352.8990 322.0692 
##      481      482      483      484      485      486      487      488 
## 377.5401 300.2864 328.2854 346.8673 354.1594 329.4353 334.5673 331.0787 
##      489      490      491      492      493      494      495      496 
## 345.0330 342.6242 326.0645 328.6749 332.4094 341.1799 326.0878 322.2382 
##      497      498      499      500      501      502      503      504 
## 338.7807 320.0156 341.9065 336.4225 339.4596 334.5604 333.7778 335.7540 
##      505      506      507      508      509      510      511      512 
## 346.8746 338.0573 335.8383 330.6547 348.4793 335.0651 340.4144 343.7323 
##      513      514      515      516      517      518      519      520 
## 336.1038 343.3936 329.9973 339.0075 319.6525 318.8997 332.5728 335.7142 
##      521      522      523      524      525      526      527      528 
## 326.2911 328.8400 329.4530 329.9093 328.9978 316.9801 322.6163 326.8991 
##      529      530      531      532      533      534      535      536 
## 327.0444 313.1062 329.4784 336.6739 339.9365 316.4783 310.1796 322.1190 
##      537      538      539      540      541      542      543      544 
## 308.9316 336.9648 336.3535 328.2332 325.5651 314.9573 305.0212 322.7499 
##      545      546      547      548      549      550      551      552 
## 325.6636 320.8880 319.9348 320.5619 329.7805 325.4264 327.8086 318.2711 
##      553      554      555      556      557      558      559      560 
## 325.1531 317.0112 322.0812 328.7394 327.6404 318.8440 317.3026 336.6821 
##      561      562      563      564      565      566      567      568 
## 329.6429 324.5463 325.0003 323.8956 330.9478 343.6548 334.4735 315.1122 
##      569      570      571      572      573      574      575      576 
## 327.4392 313.8254 339.5310 313.4866 345.1684 325.2337 346.3530 327.3046 
##      577      578      579      580      581      582      583      584 
## 350.7272 296.0089 302.7421 296.0679 315.0748 305.6155 314.2335 306.2143 
##      585      586      587      588      589      590      591      592 
## 299.7172 294.6848 305.9795 308.8465 292.1543 287.4621 302.5530 308.9385 
##      593      594      595      596      597      598      599      600 
## 296.9604 298.6395 313.6588 310.6537 320.3780 317.7373 306.4670 305.9121 
##      601      602      603      604      605      606      607      608 
## 316.7692 310.3249 306.1902 295.3206 319.6204 317.0824 323.5762 310.5837 
##      609      610      611      612      613      614      615      616 
## 315.8596 311.1633 303.2258 305.1849 334.3450 308.1751 314.2292 311.3264 
##      617      618      619      620      621      622      623      624 
## 304.0111 304.4895 300.3575 318.7173 319.8384 316.5101 302.0907 314.6875 
##      625      626 
## 350.9452 350.9452 
## 
## $se.fit
## NULL
## 
## $similar
## [1] FALSE
## 
## $ase
## [1] TRUE
## 
## $rho.se
## [1] 0.007592944
## 
## $LMtest
##          [,1]
## [1,] 131.8225
## 
## $resvar
##                                                          sigma           rho
## sigma                                             1.838046e+02 -2.414780e-05
## rho                                              -2.414780e-05  5.765279e-05
## (Intercept)                                      -5.007196e-03  1.195467e-02
## unauthorised_absence_in_all_schools_percent_2013 -6.810427e-05  1.625987e-04
## log(median_house_price_2014)                      1.009315e-03 -2.409736e-03
##                                                    (Intercept)
## sigma                                             -0.005007196
## rho                                                0.011954667
## (Intercept)                                      403.956769762
## unauthorised_absence_in_all_schools_percent_2013 -15.273779984
## log(median_house_price_2014)                     -30.388363907
##                                                  unauthorised_absence_in_all_schools_percent_2013
## sigma                                                                               -6.810427e-05
## rho                                                                                  1.625987e-04
## (Intercept)                                                                         -1.527378e+01
## unauthorised_absence_in_all_schools_percent_2013                                     3.661850e+00
## log(median_house_price_2014)                                                         8.778507e-01
##                                                  log(median_house_price_2014)
## sigma                                                             0.001009315
## rho                                                              -0.002409736
## (Intercept)                                                     -30.388363907
## unauthorised_absence_in_all_schools_percent_2013                  0.877850651
## log(median_house_price_2014)                                      2.349262523
## 
## $zero.policy
## [1] FALSE
## 
## $aliased
##                                      (Intercept) 
##                                            FALSE 
## unauthorised_absence_in_all_schools_percent_2013 
##                                            FALSE 
##                     log(median_house_price_2014) 
##                                            FALSE 
## 
## $listw_style
## [1] &quot;C&quot;
## 
## $interval
## [1] -1.5332828  0.8341298
## 
## $fdHess
## [1] FALSE
## 
## $optimHess
## [1] FALSE
## 
## $insert
## [1] FALSE
## 
## $trs
## NULL
## 
## $LLNullLlm
## &#39;log Lik.&#39; -2810.398 (df=2)
## 
## $timings
##              user.self elapsed
## set_up            0.02    0.01
## eigen_set_up      0.14    0.14
## eigen_opt         0.00    0.00
## coefs             0.00    0.00
## eigen_se          1.33    1.36
## 
## $f_calls
## [1] 14
## 
## $hf_calls
## [1] 0
## 
## $intern_classic
## NULL
## 
## $Wald1
## 
##  Wald diagnostics for spatial dependence
## 
## data:  
## Wald statistic = 0.46126, df = 1, p-value = 0.497
## sample estimates:
##        rho 
## 0.00515683 
## 
## 
## $LR1
## 
##  Likelihood Ratio diagnostics for spatial dependence
## 
## data:  
## Likelihood ratio = 0.46178, df = 1, p-value = 0.4968
## sample estimates:
## Log likelihood of spatial lag model         Log likelihood of OLS fit y 
##                           -2603.509                           -2603.740 
## 
## 
## $coeftitle
## [1] &quot;(asymptotic standard errors)&quot;
## 
## $Coef
##                                                   Estimate Std. Error
## (Intercept)                                      202.34273  20.098676
## unauthorised_absence_in_all_schools_percent_2013 -36.17560   1.913596
## log(median_house_price_2014)                      12.58783   1.532730
##                                                     z value     Pr(&gt;|z|)
## (Intercept)                                       10.067466 0.000000e+00
## unauthorised_absence_in_all_schools_percent_2013 -18.904511 0.000000e+00
## log(median_house_price_2014)                       8.212684 2.220446e-16
## 
## attr(,&quot;class&quot;)
## [1] &quot;summary.Sarlm&quot; &quot;Sarlm&quot;</code></pre>
<div class="sourceCode" id="cb644"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb644-1"><a href="advanced-r-maup-and-more-regression.html#cb644-1" aria-hidden="true" tabindex="-1"></a><span class="co">#for some reason this will show in RStudio</span></span>
<span id="cb644-2"><a href="advanced-r-maup-and-more-regression.html#cb644-2" aria-hidden="true" tabindex="-1"></a><span class="co">#but not the bookdown (this practical) output.</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li>We can use the R2, Root Mean Square Error and Mean Absolute Error.</li>
</ol>
<ul>
<li><p><span class="math inline">\(R^2\)</span> is the variation of y explained by x</p></li>
<li><p>Mean Absolute Error measures the average magnitude of the errors (distance of points from the regression line) using:</p></li>
</ul>
<p><span class="math display">\[MAE = {\frac{1}{n}\Sigma_{i=1}^{n}{\Big({d_i -f_i\Big)}}}\]</span></p>
<ul>
<li>Root Mean Square Error (RMSE) is the standard deviation of the resuiduals, this means how far away the points are from the regression lineâ€¦</li>
</ul>
<p><span class="math display">\[RMSE= \sqrt{\frac{1}{n}\Sigma_{i=1}^{n}{\Big({d_i -f_i}\Big)^2}}\]</span>
Where <span class="math inline">\(d_i\)</span> is the actual value, <span class="math inline">\(d_f\)</span> is the predicted value, and <span class="math inline">\(n\)</span> is the number of data points</p>
<p>We could also just run a correlation between the data we left out and the predicted data to assess the accuracyâ€¦</p>
<div class="sourceCode" id="cb645"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb645-1"><a href="advanced-r-maup-and-more-regression.html#cb645-1" aria-hidden="true" tabindex="-1"></a>actuals_preds <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(<span class="at">actuals=</span>test<span class="sc">$</span>Wardcount,</span>
<span id="cb645-2"><a href="advanced-r-maup-and-more-regression.html#cb645-2" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">predicteds=</span>predictions))</span>
<span id="cb645-3"><a href="advanced-r-maup-and-more-regression.html#cb645-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb645-4"><a href="advanced-r-maup-and-more-regression.html#cb645-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb645-5"><a href="advanced-r-maup-and-more-regression.html#cb645-5" aria-hidden="true" tabindex="-1"></a>actuals_preds_correlation <span class="ot">&lt;-</span> actuals_preds <span class="sc">%&gt;%</span></span>
<span id="cb645-6"><a href="advanced-r-maup-and-more-regression.html#cb645-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">correlate</span>() <span class="sc">%&gt;%</span></span>
<span id="cb645-7"><a href="advanced-r-maup-and-more-regression.html#cb645-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code></pre></div>
<pre><code>## # A tibble: 2 Ã— 3
##   term       actuals predicteds
##   &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;
## 1 actuals     NA          0.783
## 2 predicteds   0.783     NA</code></pre>
<p>This shows us that we have a strong and significant relationship between our model output and the test data.</p>
<ol style="list-style-type: decimal">
<li>We can also use min-max accuracy to see how close the actual and predicted values areâ€¦using the equationâ€¦</li>
</ol>
<p><span class="math display">\[MinMaxAccuracy= mean\left( \frac{min(actuals, predicteds}{max(actuals, predicteds)} \right)\]</span></p>
<div class="sourceCode" id="cb647"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb647-1"><a href="advanced-r-maup-and-more-regression.html#cb647-1" aria-hidden="true" tabindex="-1"></a>min_max_accuracy <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">apply</span>(actuals_preds, <span class="dv">1</span>, min, <span class="at">na.rm=</span><span class="cn">TRUE</span>) <span class="sc">/</span></span>
<span id="cb647-2"><a href="advanced-r-maup-and-more-regression.html#cb647-2" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">apply</span>(actuals_preds, <span class="dv">1</span>, max, <span class="at">na.rm=</span><span class="cn">TRUE</span>))  </span>
<span id="cb647-3"><a href="advanced-r-maup-and-more-regression.html#cb647-3" aria-hidden="true" tabindex="-1"></a>min_max_accuracy</span></code></pre></div>
<pre><code>## [1] 0.6199742</code></pre>
<ol style="list-style-type: decimal">
<li>This gives around a 60% accuracyâ€¦another alternative is mean absolute percentage deviation which is a statistical measure showing how accurate the prediciton wasâ€¦through the equationâ€¦</li>
</ol>
<p><span class="math display">\[MAPE= mean\left( \frac{abs(predicteds - actuals}{actuals} \right)\]</span></p>
<div class="sourceCode" id="cb649"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb649-1"><a href="advanced-r-maup-and-more-regression.html#cb649-1" aria-hidden="true" tabindex="-1"></a>mape <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>((actuals_preds<span class="sc">$</span>predicteds <span class="sc">-</span></span>
<span id="cb649-2"><a href="advanced-r-maup-and-more-regression.html#cb649-2" aria-hidden="true" tabindex="-1"></a>                    actuals_preds<span class="sc">$</span>actuals))<span class="sc">/</span></span>
<span id="cb649-3"><a href="advanced-r-maup-and-more-regression.html#cb649-3" aria-hidden="true" tabindex="-1"></a>               actuals_preds<span class="sc">$</span>actuals, <span class="at">na.rm=</span><span class="cn">TRUE</span>)  </span>
<span id="cb649-4"><a href="advanced-r-maup-and-more-regression.html#cb649-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb649-5"><a href="advanced-r-maup-and-more-regression.html#cb649-5" aria-hidden="true" tabindex="-1"></a>mape</span></code></pre></div>
<pre><code>## [1] Inf</code></pre>
<p>Here weâ€™ve got a very high MAPE â€” this is most likely because of the range of values of the wards for individual boroughsâ€¦</p>
</div>
<div id="cross-validation" class="section level3 hasAnchor" number="10.6.8">
<h3><span class="header-section-number">10.6.8</span> Cross validation<a href="advanced-r-maup-and-more-regression.html#cross-validation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li>Our validation approach so far was OK, but what if the test data was a different 20% â€” would it still hold up? We can test this by dividing all our data into blocks and then running the analysis several times, each time selecting a different block to be the test dataâ€¦this is called cross validation â€¦</li>
</ol>
<p><img src="prac10_images/cross_validation.jpg" width="600" style="display: block; margin: auto;" /></p>
<ol style="list-style-type: decimal">
<li>To start with weâ€™ll remove the geomtery, set up a data frame and replace any NAs with 0 â€” this is appropraite here as if there are no Airbnbs within the ward they would be 0.</li>
</ol>
<div class="sourceCode" id="cb651"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb651-1"><a href="advanced-r-maup-and-more-regression.html#cb651-1" aria-hidden="true" tabindex="-1"></a>joined_CV <span class="ot">&lt;-</span> joined <span class="sc">%&gt;%</span></span>
<span id="cb651-2"><a href="advanced-r-maup-and-more-regression.html#cb651-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()<span class="sc">%&gt;%</span></span>
<span id="cb651-3"><a href="advanced-r-maup-and-more-regression.html#cb651-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Wardcount =</span> <span class="fu">replace_na</span>(Wardcount, <span class="dv">0</span>))</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Now letâ€™s change our training dataâ€¦ here iâ€™ve got 5 iterations then the whole lot is repeated 3 times. Search literautre for the right number to use, i think 10 iterations with no repeats is a good place to start.</li>
</ol>
<div class="sourceCode" id="cb652"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb652-1"><a href="advanced-r-maup-and-more-regression.html#cb652-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb652-2"><a href="advanced-r-maup-and-more-regression.html#cb652-2" aria-hidden="true" tabindex="-1"></a>model<span class="ot">&lt;-</span> <span class="fu">train</span>(Wardcount <span class="sc">~</span> Boroughcount, </span>
<span id="cb652-3"><a href="advanced-r-maup-and-more-regression.html#cb652-3" aria-hidden="true" tabindex="-1"></a>              joined_CV,</span>
<span id="cb652-4"><a href="advanced-r-maup-and-more-regression.html#cb652-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">method=</span><span class="st">&quot;lm&quot;</span>, </span>
<span id="cb652-5"><a href="advanced-r-maup-and-more-regression.html#cb652-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">trControl=</span><span class="fu">trainControl</span>(<span class="at">method=</span><span class="st">&quot;repeatedcv&quot;</span>,</span>
<span id="cb652-6"><a href="advanced-r-maup-and-more-regression.html#cb652-6" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">number=</span><span class="dv">5</span>,</span>
<span id="cb652-7"><a href="advanced-r-maup-and-more-regression.html#cb652-7" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">repeats=</span><span class="dv">3</span>,</span>
<span id="cb652-8"><a href="advanced-r-maup-and-more-regression.html#cb652-8" aria-hidden="true" tabindex="-1"></a>                                     <span class="co"># change to true to</span></span>
<span id="cb652-9"><a href="advanced-r-maup-and-more-regression.html#cb652-9" aria-hidden="true" tabindex="-1"></a>                                     <span class="co"># see it iterate</span></span>
<span id="cb652-10"><a href="advanced-r-maup-and-more-regression.html#cb652-10" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">verboseIter=</span><span class="cn">FALSE</span>))</span>
<span id="cb652-11"><a href="advanced-r-maup-and-more-regression.html#cb652-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb652-12"><a href="advanced-r-maup-and-more-regression.html#cb652-12" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = .outcome ~ ., data = dat)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -252.56  -31.20   -2.19   17.14  648.44 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  -7.90792    4.85007   -1.63    0.104    
## Boroughcount  0.05430    0.00185   29.35   &lt;2e-16 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 75.44 on 554 degrees of freedom
## Multiple R-squared:  0.6086, Adjusted R-squared:  0.6079 
## F-statistic: 861.3 on 1 and 554 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb654"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb654-1"><a href="advanced-r-maup-and-more-regression.html#cb654-1" aria-hidden="true" tabindex="-1"></a><span class="co">#print R2, MAE and RMSE</span></span>
<span id="cb654-2"><a href="advanced-r-maup-and-more-regression.html#cb654-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(model)</span></code></pre></div>
<pre><code>## Linear Regression 
## 
## 556 samples
##   1 predictor
## 
## No pre-processing
## Resampling: Cross-Validated (5 fold, repeated 3 times) 
## Summary of sample sizes: 445, 445, 445, 444, 445, 445, ... 
## Resampling results:
## 
##   RMSE     Rsquared   MAE     
##   74.8757  0.6252889  44.23358
## 
## Tuning parameter &#39;intercept&#39; was held constant at a value of TRUE</code></pre>
<p>Results show that our cross validated model accounts for around 60% of varaince of the number of Airbnbs per wardâ€¦compare this to the results from the standard linear regressionâ€¦</p>
</div>
</div>
<div id="advanced-regression" class="section level2 hasAnchor" number="10.7">
<h2><span class="header-section-number">10.7</span> Advanced regression<a href="advanced-r-maup-and-more-regression.html#advanced-regression" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="more-data" class="section level3 hasAnchor" number="10.7.1">
<h3><span class="header-section-number">10.7.1</span> More data<a href="advanced-r-maup-and-more-regression.html#more-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li>Weâ€™re going to have a look at Ridge and LASSO regression nextâ€¦however, they require us to have more than 1 predictor variable, so weâ€™ll load a few in and demonstrate how to use them in normal regression firstâ€¦</li>
</ol>
<p>Weâ€™ll get our OSM data, project it, extract only hotels, join it with the boroughs, set any NAs to 0, join it with the wards, rename the new â€˜freqâ€™ coloumn to Hotel count, remove the geometry and then set any more NAs to 0â€¦</p>
<div class="sourceCode" id="cb656"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb656-1"><a href="advanced-r-maup-and-more-regression.html#cb656-1" aria-hidden="true" tabindex="-1"></a><span class="co"># read in OSM data</span></span>
<span id="cb656-2"><a href="advanced-r-maup-and-more-regression.html#cb656-2" aria-hidden="true" tabindex="-1"></a>OSM <span class="ot">&lt;-</span> <span class="fu">st_read</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;prac10_data&quot;</span>, <span class="st">&quot;geofabrik&quot;</span>, <span class="st">&quot;gis_osm_pois_a_free_1.shp&quot;</span>))</span></code></pre></div>
<pre><code>## Reading layer `gis_osm_pois_a_free_1&#39; from data source 
##   `C:\Users\Andy\OneDrive - University College London\Teaching\CASA0005\2020_2021\CASA0005repo\prac10_data\geofabrik\gis_osm_pois_a_free_1.shp&#39; 
##   using driver `ESRI Shapefile&#39;
## Simple feature collection with 35273 features and 4 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -0.5108706 ymin: 51.28117 xmax: 0.322123 ymax: 51.68948
## Geodetic CRS:  WGS 84</code></pre>
<div class="sourceCode" id="cb658"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb658-1"><a href="advanced-r-maup-and-more-regression.html#cb658-1" aria-hidden="true" tabindex="-1"></a><span class="co"># project and filter</span></span>
<span id="cb658-2"><a href="advanced-r-maup-and-more-regression.html#cb658-2" aria-hidden="true" tabindex="-1"></a>OSM <span class="ot">&lt;-</span> OSM <span class="sc">%&gt;%</span></span>
<span id="cb658-3"><a href="advanced-r-maup-and-more-regression.html#cb658-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(., <span class="dv">27700</span>) <span class="sc">%&gt;%</span></span>
<span id="cb658-4"><a href="advanced-r-maup-and-more-regression.html#cb658-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fclass <span class="sc">==</span> <span class="st">&quot;hotel&quot;</span>)</span>
<span id="cb658-5"><a href="advanced-r-maup-and-more-regression.html#cb658-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-6"><a href="advanced-r-maup-and-more-regression.html#cb658-6" aria-hidden="true" tabindex="-1"></a><span class="co"># join hotels with the boroughs</span></span>
<span id="cb658-7"><a href="advanced-r-maup-and-more-regression.html#cb658-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-8"><a href="advanced-r-maup-and-more-regression.html#cb658-8" aria-hidden="true" tabindex="-1"></a>Hotels_borough <span class="ot">&lt;-</span> OSM <span class="sc">%&gt;%</span></span>
<span id="cb658-9"><a href="advanced-r-maup-and-more-regression.html#cb658-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">Joinfun</span>(., boroughsandwardssf[[<span class="dv">1</span>]]) <span class="sc">%&gt;%</span></span>
<span id="cb658-10"><a href="advanced-r-maup-and-more-regression.html#cb658-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># rename hotels</span></span>
<span id="cb658-11"><a href="advanced-r-maup-and-more-regression.html#cb658-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">hotels =</span> airbnbs) <span class="sc">%&gt;%</span></span>
<span id="cb658-12"><a href="advanced-r-maup-and-more-regression.html#cb658-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># replae NA with 0</span></span>
<span id="cb658-13"><a href="advanced-r-maup-and-more-regression.html#cb658-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hotels =</span> <span class="fu">replace_na</span>(hotels, <span class="dv">0</span>))</span>
<span id="cb658-14"><a href="advanced-r-maup-and-more-regression.html#cb658-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-15"><a href="advanced-r-maup-and-more-regression.html#cb658-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb658-16"><a href="advanced-r-maup-and-more-regression.html#cb658-16" aria-hidden="true" tabindex="-1"></a>joined2<span class="ot">&lt;-</span>joined <span class="sc">%&gt;%</span></span>
<span id="cb658-17"><a href="advanced-r-maup-and-more-regression.html#cb658-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()<span class="sc">%&gt;%</span></span>
<span id="cb658-18"><a href="advanced-r-maup-and-more-regression.html#cb658-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., </span>
<span id="cb658-19"><a href="advanced-r-maup-and-more-regression.html#cb658-19" aria-hidden="true" tabindex="-1"></a>            Hotels_borough,</span>
<span id="cb658-20"><a href="advanced-r-maup-and-more-regression.html#cb658-20" aria-hidden="true" tabindex="-1"></a>            <span class="at">by=</span> <span class="fu">c</span>(<span class="st">&quot;GSS_CODE.x&quot;</span> <span class="ot">=</span> <span class="st">&quot;GSS_CODE&quot;</span>))<span class="sc">%&gt;%</span></span>
<span id="cb658-21"><a href="advanced-r-maup-and-more-regression.html#cb658-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(NAME.y,GSS_CODE.x, Boroughcount, Wardcount, hotels)<span class="sc">%&gt;%</span></span>
<span id="cb658-22"><a href="advanced-r-maup-and-more-regression.html#cb658-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>()<span class="sc">%&gt;%</span></span>
<span id="cb658-23"><a href="advanced-r-maup-and-more-regression.html#cb658-23" aria-hidden="true" tabindex="-1"></a>  <span class="co">#replace NA in wards with 0</span></span>
<span id="cb658-24"><a href="advanced-r-maup-and-more-regression.html#cb658-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Wardcount =</span> <span class="fu">replace_na</span>(Wardcount, <span class="dv">0</span>))</span></code></pre></div>
</div>
<div id="multiple-linear-regression" class="section level3 hasAnchor" number="10.7.2">
<h3><span class="header-section-number">10.7.2</span> Multiple linear regression<a href="advanced-r-maup-and-more-regression.html#multiple-linear-regression" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ol style="list-style-type: decimal">
<li>Re run the model including Hotel countâ€¦you simply use a +</li>
</ol>
<div class="sourceCode" id="cb659"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb659-1"><a href="advanced-r-maup-and-more-regression.html#cb659-1" aria-hidden="true" tabindex="-1"></a>model2<span class="ot">&lt;-</span> <span class="fu">train</span>(Wardcount <span class="sc">~</span> Boroughcount<span class="sc">+</span>hotels, </span>
<span id="cb659-2"><a href="advanced-r-maup-and-more-regression.html#cb659-2" aria-hidden="true" tabindex="-1"></a>              joined2,</span>
<span id="cb659-3"><a href="advanced-r-maup-and-more-regression.html#cb659-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">method=</span><span class="st">&quot;lm&quot;</span>, </span>
<span id="cb659-4"><a href="advanced-r-maup-and-more-regression.html#cb659-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">trControl=</span><span class="fu">trainControl</span>(<span class="at">method=</span><span class="st">&quot;repeatedcv&quot;</span>,</span>
<span id="cb659-5"><a href="advanced-r-maup-and-more-regression.html#cb659-5" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">number=</span><span class="dv">5</span>,</span>
<span id="cb659-6"><a href="advanced-r-maup-and-more-regression.html#cb659-6" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">repeats=</span><span class="dv">3</span>,</span>
<span id="cb659-7"><a href="advanced-r-maup-and-more-regression.html#cb659-7" aria-hidden="true" tabindex="-1"></a>                                     <span class="co"># change to true to see it </span></span>
<span id="cb659-8"><a href="advanced-r-maup-and-more-regression.html#cb659-8" aria-hidden="true" tabindex="-1"></a>                                     <span class="co"># iterate</span></span>
<span id="cb659-9"><a href="advanced-r-maup-and-more-regression.html#cb659-9" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">verboseIter=</span><span class="cn">FALSE</span>))</span>
<span id="cb659-10"><a href="advanced-r-maup-and-more-regression.html#cb659-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb659-11"><a href="advanced-r-maup-and-more-regression.html#cb659-11" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = .outcome ~ ., data = dat)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -243.74  -31.14   -2.01   17.43  657.26 
## 
## Coefficients:
##               Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)  -8.521466   4.969743  -1.715    0.087 .  
## Boroughcount  0.055125   0.002348  23.476   &lt;2e-16 ***
## hotels       -0.048900   0.085343  -0.573    0.567    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 75.49 on 553 degrees of freedom
## Multiple R-squared:  0.6088, Adjusted R-squared:  0.6074 
## F-statistic: 430.3 on 2 and 553 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>The summary here shows that the hotel count predictor is not statistically significant so we should remove itâ€¦how about we add some population and house price dataâ€¦.download <a href="https://data.london.gov.uk/dataset/ward-profiles-and-atlas">the excel data from here</a></p>
<div class="sourceCode" id="cb661"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb661-1"><a href="advanced-r-maup-and-more-regression.html#cb661-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb661-2"><a href="advanced-r-maup-and-more-regression.html#cb661-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb661-3"><a href="advanced-r-maup-and-more-regression.html#cb661-3" aria-hidden="true" tabindex="-1"></a><span class="co"># read the excel sheet</span></span>
<span id="cb661-4"><a href="advanced-r-maup-and-more-regression.html#cb661-4" aria-hidden="true" tabindex="-1"></a>my_data <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;prac10_data&quot;</span>,<span class="st">&quot;ward-profiles-excel-version.xls&quot;</span>),</span>
<span id="cb661-5"><a href="advanced-r-maup-and-more-regression.html#cb661-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">sheet=</span><span class="dv">2</span>,</span>
<span id="cb661-6"><a href="advanced-r-maup-and-more-regression.html#cb661-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">col_names=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb661-7"><a href="advanced-r-maup-and-more-regression.html#cb661-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set it as a data frame</span></span>
<span id="cb661-8"><a href="advanced-r-maup-and-more-regression.html#cb661-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()<span class="sc">%&gt;%</span></span>
<span id="cb661-9"><a href="advanced-r-maup-and-more-regression.html#cb661-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>()<span class="sc">%&gt;%</span></span>
<span id="cb661-10"><a href="advanced-r-maup-and-more-regression.html#cb661-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extract everything that begins with E</span></span>
<span id="cb661-11"><a href="advanced-r-maup-and-more-regression.html#cb661-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(new_code, <span class="st">&quot;^E&quot;</span>))</span>
<span id="cb661-12"><a href="advanced-r-maup-and-more-regression.html#cb661-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb661-13"><a href="advanced-r-maup-and-more-regression.html#cb661-13" aria-hidden="true" tabindex="-1"></a><span class="co"># is our data num</span></span>
<span id="cb661-14"><a href="advanced-r-maup-and-more-regression.html#cb661-14" aria-hidden="true" tabindex="-1"></a>Datatypelist <span class="ot">&lt;-</span> my_data <span class="sc">%&gt;%</span> </span>
<span id="cb661-15"><a href="advanced-r-maup-and-more-regression.html#cb661-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_all</span>(class) <span class="sc">%&gt;%</span></span>
<span id="cb661-16"><a href="advanced-r-maup-and-more-regression.html#cb661-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), </span>
<span id="cb661-17"><a href="advanced-r-maup-and-more-regression.html#cb661-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to=</span><span class="st">&quot;All_variables&quot;</span>, </span>
<span id="cb661-18"><a href="advanced-r-maup-and-more-regression.html#cb661-18" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to=</span><span class="st">&quot;Variable_class&quot;</span>)</span>
<span id="cb661-19"><a href="advanced-r-maup-and-more-regression.html#cb661-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb661-20"><a href="advanced-r-maup-and-more-regression.html#cb661-20" aria-hidden="true" tabindex="-1"></a><span class="co"># make sure the variables are numeric</span></span>
<span id="cb661-21"><a href="advanced-r-maup-and-more-regression.html#cb661-21" aria-hidden="true" tabindex="-1"></a>my_data <span class="ot">&lt;-</span> my_data <span class="sc">%&gt;%</span></span>
<span id="cb661-22"><a href="advanced-r-maup-and-more-regression.html#cb661-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="at">.cols =</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">67</span>, as.numeric))</span>
<span id="cb661-23"><a href="advanced-r-maup-and-more-regression.html#cb661-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb661-24"><a href="advanced-r-maup-and-more-regression.html#cb661-24" aria-hidden="true" tabindex="-1"></a><span class="co"># merge the new data to the existing data</span></span>
<span id="cb661-25"><a href="advanced-r-maup-and-more-regression.html#cb661-25" aria-hidden="true" tabindex="-1"></a>joined3 <span class="ot">&lt;-</span>joined2 <span class="sc">%&gt;%</span></span>
<span id="cb661-26"><a href="advanced-r-maup-and-more-regression.html#cb661-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(.,</span>
<span id="cb661-27"><a href="advanced-r-maup-and-more-regression.html#cb661-27" aria-hidden="true" tabindex="-1"></a>            my_data,</span>
<span id="cb661-28"><a href="advanced-r-maup-and-more-regression.html#cb661-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">by=</span> <span class="fu">c</span>(<span class="st">&quot;GSS_CODE.x&quot;</span> <span class="ot">=</span> <span class="st">&quot;new_code&quot;</span>))</span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Now run the model again</li>
</ol>
<div class="sourceCode" id="cb662"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb662-1"><a href="advanced-r-maup-and-more-regression.html#cb662-1" aria-hidden="true" tabindex="-1"></a>model3<span class="ot">&lt;-</span> <span class="fu">train</span>(Wardcount <span class="sc">~</span> Boroughcount<span class="sc">+</span>population_2015</span>
<span id="cb662-2"><a href="advanced-r-maup-and-more-regression.html#cb662-2" aria-hidden="true" tabindex="-1"></a>               <span class="sc">+</span>median_house_price_2014,</span>
<span id="cb662-3"><a href="advanced-r-maup-and-more-regression.html#cb662-3" aria-hidden="true" tabindex="-1"></a>              joined3,</span>
<span id="cb662-4"><a href="advanced-r-maup-and-more-regression.html#cb662-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">method=</span><span class="st">&quot;lm&quot;</span>, </span>
<span id="cb662-5"><a href="advanced-r-maup-and-more-regression.html#cb662-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">trControl=</span><span class="fu">trainControl</span>(<span class="at">method=</span><span class="st">&quot;repeatedcv&quot;</span>,</span>
<span id="cb662-6"><a href="advanced-r-maup-and-more-regression.html#cb662-6" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">number=</span><span class="dv">5</span>,</span>
<span id="cb662-7"><a href="advanced-r-maup-and-more-regression.html#cb662-7" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">repeats=</span><span class="dv">3</span>,</span>
<span id="cb662-8"><a href="advanced-r-maup-and-more-regression.html#cb662-8" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">verboseIter=</span><span class="cn">FALSE</span>))</span>
<span id="cb662-9"><a href="advanced-r-maup-and-more-regression.html#cb662-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb662-10"><a href="advanced-r-maup-and-more-regression.html#cb662-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model3)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = .outcome ~ ., data = dat)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -256.68  -28.28   -4.98   17.65  644.32 
## 
## Coefficients:
##                           Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)              2.537e+01  2.168e+01   1.170   0.2423    
## Boroughcount             5.312e-02  2.680e-03  19.819   &lt;2e-16 ***
## population_2015         -1.268e-04  5.966e-05  -2.126   0.0339 *  
## median_house_price_2014  9.546e-06  2.674e-05   0.357   0.7212    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 75.03 on 553 degrees of freedom
## Multiple R-squared:  0.614,  Adjusted R-squared:  0.6119 
## F-statistic: 293.2 on 3 and 553 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>Our R squared and adjusted R squared have increased (albeit slightly) and all predictors are statistically significant.</p>
<blockquote>
<p><strong>Note</strong> that whilst i have selected variables pretty randomly here for demonstration, if you use something like this in practice itâ€™s important to have supported (referenced) reasoning behind your selections.</p>
</blockquote>
</div>
<div id="ridge-regression" class="section level3 hasAnchor" number="10.7.3">
<h3><span class="header-section-number">10.7.3</span> Ridge regression<a href="advanced-r-maup-and-more-regression.html#ridge-regression" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><img src="prac10_images/ridge.jpg" width="300" style="display: block; margin: auto;" /></p>
<p>Least squares regression tries to minimise how far each point is away from the lineâ€¦but if you look in this figureâ€¦the red dots are the training data and the green dots are the test data. Here normal OLS has been fitted to the training data perfectlyâ€¦the sum of the squared residuals (squared error distance from the line) is very small, probably 0. But when applied to the test data the sum of the squared residuals is large â€” it therefore has high variance and would be termed to be overfitting the training data.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-524"></span>
<img src="prac10_images/ridge_eg.png" alt="This is a screenshot from the YouTube video Regularization Part 1: Ridge Regression by StatQuest" width="300" />
<p class="caption">
Figure 10.1: This is a screenshot from the YouTube video Regularization Part 1: Ridge Regression by StatQuest
</p>
</div>
<p>Ridge regression probably wonâ€™t fit our training data as well, because we introduce a small amount of bias (adding value to the intercept â€” which is the Y value when X=0, normally making the line of best fit more horizontal) to give us less overall variance (the difference between the point and line value)â€¦So essentially when the values are calculated the formula is trying to get the line of best fit through all the points with each point having minimum distance to the line. This is usually useful in trying to get predicitions from the model.</p>
<p>Ridge regression also tries to minimise the sum of the squared residuals (distance to the line) but then adds <span class="math inline">\(\lambda\)</span> x <span class="math inline">\(slope^2\)</span> â€” this is the bias changing the line of best fit</p>
<p>Ok so letâ€™s try and look at this with numbersâ€¦</p>
<p>The goal here is to minimise the sum of the squared residualsâ€¦plus the ridge regression penalty <span class="math inline">\(\lambda * slope^2\)</span>â€¦</p>
<p>Firstly letâ€™s assume you have a perfectly fit line â€” the sum of the least sqaure residuals would be 0 (the line overlaps the points). Assume <span class="math inline">\(\lambda\)</span> is 0.5 and the slope is 1.2, we have 0 (residuals) + 0.5 (<span class="math inline">\(\lambda\)</span>) * 1.44 (slope squared) = 0.72</p>
<p>Now we use ridge regression that shifts the line away from the perfect fit (with a bias penalty) that we had in least square regressionâ€¦this would create residual values as the points no longer perfectly fit the line, assume these add to 0.2, <span class="math inline">\(\lambda\)</span> is 0.5, and the slope is 0.7â€¦so this would giveâ€¦.0.2 (residuals) + 0.5 (<span class="math inline">\(\lambda\)</span>) * 0.49 (slope squared) = 0.445.</p>
<p>So if we were trying to minimise the sum of the squared residuals plus the ridge regression penalty the ridge regression wins with a lower value.</p>
<p>The penalty <span class="math inline">\(\lambda * slope^2\)</span> adds a bias (value to the intercept) to reduce the slope of the line as it tries to the minimise the sum of the distance of the points from the line and hopefully the variance between the line and the pointsâ€¦like this â€” Ridge is the blue line that has become slightly more horizontalâ€¦</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-525"></span>
<img src="prac10_images/ridge_eg2.png" alt="This is a screenshot from the YouTube video Regularization Part 1: Ridge Regression by StatQuest" width="300" />
<p class="caption">
Figure 10.2: This is a screenshot from the YouTube video Regularization Part 1: Ridge Regression by StatQuest
</p>
</div>
<p>But waitâ€¦. how do we calculate <span class="math inline">\(\lambda\)</span>, well we try a load of values and use cross validation (10 fold) to get the overall lowest variance from the line to the data points! COOL!!!!</p>
<ol style="list-style-type: decimal">
<li>Letâ€™s see an example to show that if <span class="math inline">\(\lambda\)</span> is 0, then we have our box standard linear regressionâ€¦as the penalty <span class="math inline">\(\lambda * the slope^2\)</span> will be 0, so we will just be minimising the sum of the squared residuals.</li>
</ol>
<div class="sourceCode" id="cb664"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb664-1"><a href="advanced-r-maup-and-more-regression.html#cb664-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb664-2"><a href="advanced-r-maup-and-more-regression.html#cb664-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb664-3"><a href="advanced-r-maup-and-more-regression.html#cb664-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb664-4"><a href="advanced-r-maup-and-more-regression.html#cb664-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb664-5"><a href="advanced-r-maup-and-more-regression.html#cb664-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb664-6"><a href="advanced-r-maup-and-more-regression.html#cb664-6" aria-hidden="true" tabindex="-1"></a><span class="co"># sort the data our for ridge regression</span></span>
<span id="cb664-7"><a href="advanced-r-maup-and-more-regression.html#cb664-7" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> joined3<span class="sc">$</span>Wardcount <span class="sc">%&gt;%</span></span>
<span id="cb664-8"><a href="advanced-r-maup-and-more-regression.html#cb664-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set NAs to 0</span></span>
<span id="cb664-9"><a href="advanced-r-maup-and-more-regression.html#cb664-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_na</span>(., <span class="dv">0</span>)</span>
<span id="cb664-10"><a href="advanced-r-maup-and-more-regression.html#cb664-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb664-11"><a href="advanced-r-maup-and-more-regression.html#cb664-11" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> joined3 <span class="sc">%&gt;%</span> </span>
<span id="cb664-12"><a href="advanced-r-maup-and-more-regression.html#cb664-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Boroughcount, hotels,</span>
<span id="cb664-13"><a href="advanced-r-maup-and-more-regression.html#cb664-13" aria-hidden="true" tabindex="-1"></a>                                 population_2015,</span>
<span id="cb664-14"><a href="advanced-r-maup-and-more-regression.html#cb664-14" aria-hidden="true" tabindex="-1"></a>                                 median_house_price_2014) <span class="sc">%&gt;%</span></span>
<span id="cb664-15"><a href="advanced-r-maup-and-more-regression.html#cb664-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.matrix</span>()<span class="sc">%&gt;%</span></span>
<span id="cb664-16"><a href="advanced-r-maup-and-more-regression.html#cb664-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set NAs to 0</span></span>
<span id="cb664-17"><a href="advanced-r-maup-and-more-regression.html#cb664-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_na</span>(., <span class="dv">0</span>)</span>
<span id="cb664-18"><a href="advanced-r-maup-and-more-regression.html#cb664-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb664-19"><a href="advanced-r-maup-and-more-regression.html#cb664-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb664-20"><a href="advanced-r-maup-and-more-regression.html#cb664-20" aria-hidden="true" tabindex="-1"></a><span class="co"># set seed means that if we re run this </span></span>
<span id="cb664-21"><a href="advanced-r-maup-and-more-regression.html#cb664-21" aria-hidden="true" tabindex="-1"></a><span class="co"># we will get the same results</span></span>
<span id="cb664-22"><a href="advanced-r-maup-and-more-regression.html#cb664-22" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">489</span>)</span>
<span id="cb664-23"><a href="advanced-r-maup-and-more-regression.html#cb664-23" aria-hidden="true" tabindex="-1"></a><span class="co"># this gives us a 50/50 split between</span></span>
<span id="cb664-24"><a href="advanced-r-maup-and-more-regression.html#cb664-24" aria-hidden="true" tabindex="-1"></a><span class="co"># training and test data</span></span>
<span id="cb664-25"><a href="advanced-r-maup-and-more-regression.html#cb664-25" aria-hidden="true" tabindex="-1"></a>train <span class="ot">=</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(x), <span class="fu">nrow</span>(x)<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb664-26"><a href="advanced-r-maup-and-more-regression.html#cb664-26" aria-hidden="true" tabindex="-1"></a>test <span class="ot">=</span> (<span class="sc">-</span>train)</span>
<span id="cb664-27"><a href="advanced-r-maup-and-more-regression.html#cb664-27" aria-hidden="true" tabindex="-1"></a>ytest <span class="ot">=</span> y[test]</span>
<span id="cb664-28"><a href="advanced-r-maup-and-more-regression.html#cb664-28" aria-hidden="true" tabindex="-1"></a>xtest <span class="ot">=</span>x[test]</span>
<span id="cb664-29"><a href="advanced-r-maup-and-more-regression.html#cb664-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb664-30"><a href="advanced-r-maup-and-more-regression.html#cb664-30" aria-hidden="true" tabindex="-1"></a><span class="co"># run normmal regression</span></span>
<span id="cb664-31"><a href="advanced-r-maup-and-more-regression.html#cb664-31" aria-hidden="true" tabindex="-1"></a>normallm <span class="ot">&lt;-</span> <span class="fu">lm</span>(Wardcount <span class="sc">~</span> hotels<span class="sc">+</span>Boroughcount<span class="sc">+</span>population_2015</span>
<span id="cb664-32"><a href="advanced-r-maup-and-more-regression.html#cb664-32" aria-hidden="true" tabindex="-1"></a>               <span class="sc">+</span>median_house_price_2014,</span>
<span id="cb664-33"><a href="advanced-r-maup-and-more-regression.html#cb664-33" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> joined3)</span>
<span id="cb664-34"><a href="advanced-r-maup-and-more-regression.html#cb664-34" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(normallm)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Wardcount ~ hotels + Boroughcount + population_2015 + 
##     median_house_price_2014, data = joined3)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -242.33  -30.22   -4.59   18.04  658.67 
## 
## Coefficients:
##                           Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)              2.298e+01  2.183e+01   1.052   0.2931    
## hotels                  -8.156e-02  8.688e-02  -0.939   0.3483    
## Boroughcount             5.412e-02  2.885e-03  18.758   &lt;2e-16 ***
## population_2015         -1.265e-04  5.967e-05  -2.120   0.0344 *  
## median_house_price_2014  1.448e-05  2.725e-05   0.531   0.5953    
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 75.04 on 552 degrees of freedom
## Multiple R-squared:  0.6146, Adjusted R-squared:  0.6118 
## F-statistic: 220.1 on 4 and 552 DF,  p-value: &lt; 2.2e-16</code></pre>
<div class="sourceCode" id="cb666"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb666-1"><a href="advanced-r-maup-and-more-regression.html#cb666-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make a variable for loads of lambda values</span></span>
<span id="cb666-2"><a href="advanced-r-maup-and-more-regression.html#cb666-2" aria-hidden="true" tabindex="-1"></a><span class="co"># just for the example here</span></span>
<span id="cb666-3"><a href="advanced-r-maup-and-more-regression.html#cb666-3" aria-hidden="true" tabindex="-1"></a>lambda <span class="ot">&lt;-</span> <span class="dv">10</span><span class="sc">^</span><span class="fu">seq</span>(<span class="dv">10</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="at">length =</span> <span class="dv">100</span>)</span>
<span id="cb666-4"><a href="advanced-r-maup-and-more-regression.html#cb666-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb666-5"><a href="advanced-r-maup-and-more-regression.html#cb666-5" aria-hidden="true" tabindex="-1"></a><span class="co">#run ridge regression, here we use x to predict y</span></span>
<span id="cb666-6"><a href="advanced-r-maup-and-more-regression.html#cb666-6" aria-hidden="true" tabindex="-1"></a>ridge_mod <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(x, y, <span class="at">alpha =</span> <span class="dv">0</span>, <span class="at">lambda =</span> lambda)</span>
<span id="cb666-7"><a href="advanced-r-maup-and-more-regression.html#cb666-7" aria-hidden="true" tabindex="-1"></a><span class="co"># x and y are our original data,</span></span>
<span id="cb666-8"><a href="advanced-r-maup-and-more-regression.html#cb666-8" aria-hidden="true" tabindex="-1"></a><span class="co">#s is the size of the penalty which is 0</span></span>
<span id="cb666-9"><a href="advanced-r-maup-and-more-regression.html#cb666-9" aria-hidden="true" tabindex="-1"></a><span class="co"># and we want the coefficients out</span></span>
<span id="cb666-10"><a href="advanced-r-maup-and-more-regression.html#cb666-10" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(ridge_mod, <span class="at">x=</span>x,<span class="at">y=</span>y, <span class="at">s =</span> <span class="dv">0</span>, <span class="at">exact =</span> T, <span class="at">type =</span> <span class="st">&#39;coefficients&#39;</span>)</span></code></pre></div>
<pre><code>## 5 x 1 sparse Matrix of class &quot;dgCMatrix&quot;
##                                    s1
## (Intercept)             22.9512724488
## Boroughcount             0.0541196642
## hotels                  -0.0815697994
## population_2015         -0.0001264325
## median_house_price_2014  0.0000145227</code></pre>
<ol style="list-style-type: decimal">
<li>The coefficient estaimtes should be the same or very very similarâ€¦now letâ€™s try and use ridge regression to improve upon our least squares regressionâ€¦first letâ€™s show linear regression for comparison using the train data..</li>
</ol>
<div class="sourceCode" id="cb668"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb668-1"><a href="advanced-r-maup-and-more-regression.html#cb668-1" aria-hidden="true" tabindex="-1"></a>normallm2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Wardcount <span class="sc">~</span> hotels<span class="sc">+</span>Boroughcount<span class="sc">+</span>population_2015</span>
<span id="cb668-2"><a href="advanced-r-maup-and-more-regression.html#cb668-2" aria-hidden="true" tabindex="-1"></a>               <span class="sc">+</span>median_house_price_2014, </span>
<span id="cb668-3"><a href="advanced-r-maup-and-more-regression.html#cb668-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> joined3, </span>
<span id="cb668-4"><a href="advanced-r-maup-and-more-regression.html#cb668-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">subset =</span> train)</span>
<span id="cb668-5"><a href="advanced-r-maup-and-more-regression.html#cb668-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb668-6"><a href="advanced-r-maup-and-more-regression.html#cb668-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb668-7"><a href="advanced-r-maup-and-more-regression.html#cb668-7" aria-hidden="true" tabindex="-1"></a>s_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(normallm2, <span class="at">newdata =</span> joined3[test,])</span>
<span id="cb668-8"><a href="advanced-r-maup-and-more-regression.html#cb668-8" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((s_pred<span class="sc">-</span>ytest)<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 4572.147</code></pre>
<ol style="list-style-type: decimal">
<li>Now we will find the best value for <span class="math inline">\(\lambda\)</span> using cross validation</li>
</ol>
<div class="sourceCode" id="cb670"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb670-1"><a href="advanced-r-maup-and-more-regression.html#cb670-1" aria-hidden="true" tabindex="-1"></a><span class="co">#find the best lambda from our list via cross-validation</span></span>
<span id="cb670-2"><a href="advanced-r-maup-and-more-regression.html#cb670-2" aria-hidden="true" tabindex="-1"></a><span class="co"># family = gaussian means linear regression</span></span>
<span id="cb670-3"><a href="advanced-r-maup-and-more-regression.html#cb670-3" aria-hidden="true" tabindex="-1"></a><span class="co"># type.measure = how cross evaluation will be evaluated </span></span>
<span id="cb670-4"><a href="advanced-r-maup-and-more-regression.html#cb670-4" aria-hidden="true" tabindex="-1"></a><span class="co"># mse is mean square error</span></span>
<span id="cb670-5"><a href="advanced-r-maup-and-more-regression.html#cb670-5" aria-hidden="true" tabindex="-1"></a>cv_out <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(x[train,], </span>
<span id="cb670-6"><a href="advanced-r-maup-and-more-regression.html#cb670-6" aria-hidden="true" tabindex="-1"></a>                    y[train],</span>
<span id="cb670-7"><a href="advanced-r-maup-and-more-regression.html#cb670-7" aria-hidden="true" tabindex="-1"></a>                    <span class="at">alpha =</span> <span class="dv">0</span>, </span>
<span id="cb670-8"><a href="advanced-r-maup-and-more-regression.html#cb670-8" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family=</span><span class="st">&quot;gaussian&quot;</span>,</span>
<span id="cb670-9"><a href="advanced-r-maup-and-more-regression.html#cb670-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">type.measure =</span> <span class="st">&quot;mse&quot;</span>)</span></code></pre></div>
<p>Combined, this will fit a linear regression with a ridge regression penatly using 10-fold cross validation to find the best <span class="math inline">\(\lambda\)</span> value that minimises mean square error (average squared distance of the data points to the line). Letâ€™s apply it to the modelâ€¦</p>
<div class="sourceCode" id="cb671"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb671-1"><a href="advanced-r-maup-and-more-regression.html#cb671-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cv_out)</span></code></pre></div>
<p><img src="CASA0005_files/figure-html/unnamed-chunk-529-1.png" width="672" /></p>
<div class="sourceCode" id="cb672"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb672-1"><a href="advanced-r-maup-and-more-regression.html#cb672-1" aria-hidden="true" tabindex="-1"></a><span class="co"># best value </span></span>
<span id="cb672-2"><a href="advanced-r-maup-and-more-regression.html#cb672-2" aria-hidden="true" tabindex="-1"></a>opt_lambda <span class="ot">&lt;-</span> cv_out<span class="sc">$</span>lambda.min</span>
<span id="cb672-3"><a href="advanced-r-maup-and-more-regression.html#cb672-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb672-4"><a href="advanced-r-maup-and-more-regression.html#cb672-4" aria-hidden="true" tabindex="-1"></a><span class="co"># prediction to the testing data</span></span>
<span id="cb672-5"><a href="advanced-r-maup-and-more-regression.html#cb672-5" aria-hidden="true" tabindex="-1"></a><span class="co"># s is set to optimal lambda</span></span>
<span id="cb672-6"><a href="advanced-r-maup-and-more-regression.html#cb672-6" aria-hidden="true" tabindex="-1"></a><span class="co"># you could also use lambda.1se as</span></span>
<span id="cb672-7"><a href="advanced-r-maup-and-more-regression.html#cb672-7" aria-hidden="true" tabindex="-1"></a><span class="co"># technically they are indistinguishable </span></span>
<span id="cb672-8"><a href="advanced-r-maup-and-more-regression.html#cb672-8" aria-hidden="true" tabindex="-1"></a>ridge_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(ridge_mod, <span class="at">s =</span> opt_lambda, <span class="at">newx =</span> x[test,])</span>
<span id="cb672-9"><a href="advanced-r-maup-and-more-regression.html#cb672-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb672-10"><a href="advanced-r-maup-and-more-regression.html#cb672-10" aria-hidden="true" tabindex="-1"></a><span class="co"># rsquared</span></span>
<span id="cb672-11"><a href="advanced-r-maup-and-more-regression.html#cb672-11" aria-hidden="true" tabindex="-1"></a>ridge_r <span class="ot">&lt;-</span> <span class="fu">cor</span>(y[test], ridge_pred)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb672-12"><a href="advanced-r-maup-and-more-regression.html#cb672-12" aria-hidden="true" tabindex="-1"></a>ridge_r</span></code></pre></div>
<pre><code>##             s1
## [1,] 0.6470829</code></pre>
<div class="sourceCode" id="cb674"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb674-1"><a href="advanced-r-maup-and-more-regression.html#cb674-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mean square error</span></span>
<span id="cb674-2"><a href="advanced-r-maup-and-more-regression.html#cb674-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((ridge_pred<span class="sc">-</span>ytest)<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 4097.263</code></pre>
<p>You can also doing this in a few less steps with the <code>ridge</code> package</p>
</div>
<div id="lasso" class="section level3 hasAnchor" number="10.7.4">
<h3><span class="header-section-number">10.7.4</span> LASSO<a href="advanced-r-maup-and-more-regression.html#lasso" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><img src="prac10_images/LASSO.jpg" width="200" style="display: block; margin: auto;" /></p>
<p>Least absolute shrinkage and selection operator (LASSO) performs variable selection and regularisation to increase prediction accuracy of the modelâ€¦the only difference to ridge is that the regularisation term is an absolute value. So instead of squaring the slope (like i mentioned in Ridge regression), we take the absolute value (of the slope, as opposed the the squared value in Ridge) and as the slope can be 0 it can be removed from the model. As a result LASSO regression can increase <span class="math inline">\(\lambda\)</span> then set irrelevant parameters to 0 (Ridge will just shrink them but not set to 0) â€” relevant parameters might shrink a little bit in both too. The advantage here is that LASSO can exclude useless variables â€” so if you have a lot of variables it might be preferable. However, if most variables are useful then Ridge regression would probably work better.</p>
<ul>
<li><p>LASSO has an absolute penalty (also known as L1 penalty)</p></li>
<li><p>Ridge has a square penalty (also known as L2 penalty)</p></li>
</ul>
<div class="sourceCode" id="cb676"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb676-1"><a href="advanced-r-maup-and-more-regression.html#cb676-1" aria-hidden="true" tabindex="-1"></a><span class="co">#find the best lambda from our list via cross-validation</span></span>
<span id="cb676-2"><a href="advanced-r-maup-and-more-regression.html#cb676-2" aria-hidden="true" tabindex="-1"></a>cv_out <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(x[train,], </span>
<span id="cb676-3"><a href="advanced-r-maup-and-more-regression.html#cb676-3" aria-hidden="true" tabindex="-1"></a>                    y[train], </span>
<span id="cb676-4"><a href="advanced-r-maup-and-more-regression.html#cb676-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">alpha =</span> <span class="dv">1</span>, </span>
<span id="cb676-5"><a href="advanced-r-maup-and-more-regression.html#cb676-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">family=</span><span class="st">&quot;gaussian&quot;</span>, </span>
<span id="cb676-6"><a href="advanced-r-maup-and-more-regression.html#cb676-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">type.measure =</span> <span class="st">&quot;mse&quot;</span>)</span>
<span id="cb676-7"><a href="advanced-r-maup-and-more-regression.html#cb676-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb676-8"><a href="advanced-r-maup-and-more-regression.html#cb676-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cv_out)</span></code></pre></div>
<p><img src="CASA0005_files/figure-html/unnamed-chunk-531-1.png" width="672" /></p>
<div class="sourceCode" id="cb677"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb677-1"><a href="advanced-r-maup-and-more-regression.html#cb677-1" aria-hidden="true" tabindex="-1"></a><span class="co"># best value </span></span>
<span id="cb677-2"><a href="advanced-r-maup-and-more-regression.html#cb677-2" aria-hidden="true" tabindex="-1"></a>opt_lambda <span class="ot">&lt;-</span> cv_out<span class="sc">$</span>lambda.min</span>
<span id="cb677-3"><a href="advanced-r-maup-and-more-regression.html#cb677-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb677-4"><a href="advanced-r-maup-and-more-regression.html#cb677-4" aria-hidden="true" tabindex="-1"></a><span class="co"># make the model</span></span>
<span id="cb677-5"><a href="advanced-r-maup-and-more-regression.html#cb677-5" aria-hidden="true" tabindex="-1"></a>lasso_mod <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(x[train,], y[train], <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">lambda =</span> opt_lambda)</span>
<span id="cb677-6"><a href="advanced-r-maup-and-more-regression.html#cb677-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb677-7"><a href="advanced-r-maup-and-more-regression.html#cb677-7" aria-hidden="true" tabindex="-1"></a><span class="co"># make the prediction </span></span>
<span id="cb677-8"><a href="advanced-r-maup-and-more-regression.html#cb677-8" aria-hidden="true" tabindex="-1"></a>lasso_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(lasso_mod, <span class="at">s =</span> opt_lambda, <span class="at">newx =</span> x[test,])</span>
<span id="cb677-9"><a href="advanced-r-maup-and-more-regression.html#cb677-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb677-10"><a href="advanced-r-maup-and-more-regression.html#cb677-10" aria-hidden="true" tabindex="-1"></a><span class="co"># r sqaured</span></span>
<span id="cb677-11"><a href="advanced-r-maup-and-more-regression.html#cb677-11" aria-hidden="true" tabindex="-1"></a>LASSO_r <span class="ot">&lt;-</span> <span class="fu">cor</span>(y[test], lasso_pred)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb677-12"><a href="advanced-r-maup-and-more-regression.html#cb677-12" aria-hidden="true" tabindex="-1"></a>LASSO_r</span></code></pre></div>
<pre><code>##             s1
## [1,] 0.6326079</code></pre>
<div class="sourceCode" id="cb679"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb679-1"><a href="advanced-r-maup-and-more-regression.html#cb679-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mean square error</span></span>
<span id="cb679-2"><a href="advanced-r-maup-and-more-regression.html#cb679-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>((lasso_pred<span class="sc">-</span>ytest)<span class="sc">^</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## [1] 4337.546</code></pre>
</div>
<div id="elastic-net-regression" class="section level3 hasAnchor" number="10.7.5">
<h3><span class="header-section-number">10.7.5</span> Elastic net regression<a href="advanced-r-maup-and-more-regression.html#elastic-net-regression" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When you donâ€™t know much about our variables in a model you can use Elastic-Net Regression. It starts with least squares then adds the LASSO and ridge regression penalty, allowing you to use the strengths of both. Both the LASSO penalty and ridge penalty get their own <span class="math inline">\(\lambda\)</span> values, <span class="math inline">\(\lambda_1\)</span> for LASSO, <span class="math inline">\(\lambda_2\)</span> for ridge. Cross validation runs for both <span class="math inline">\(\lambda_1\)</span> and <span class="math inline">\(\lambda_2\)</span>. If both <span class="math inline">\(\lambda_1\)</span> and <span class="math inline">\(\lambda_2\)</span> &gt; 0 then we get a hybrid approach, this is good when we have correlated variables. LASSO will pick just one correlated variable and eliminate the other, whereas ridge will just shrink all of them. Using both LASSO and ridge we can group and shrink correlated variables or remove them all at the same time.</p>
<p>In R, Elastic-Net Regression is where you change the alpha value between 0 and 1. You would use elastic net regression to see if it is possible to reduce the mean square error any further. Have a look at <a href="https://www.youtube.com/watch?v=ctmNq7FgbvI">this video</a> to see how to use a for loop to test different values for alpha.</p>
</div>
<div id="whats-the-best-here" class="section level3 hasAnchor" number="10.7.6">
<h3><span class="header-section-number">10.7.6</span> Whatâ€™s the best here<a href="advanced-r-maup-and-more-regression.html#whats-the-best-here" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Letâ€™s compare the results of the MSE and r sqaured for the normallm2, LASSO and Ridge as we used the same predictorsâ€¦this is the code to get the values we donâ€™t already haveâ€¦</p>
<div class="sourceCode" id="cb681"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb681-1"><a href="advanced-r-maup-and-more-regression.html#cb681-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(normallm2)<span class="sc">$</span>r.squared</span></code></pre></div>
<pre><code>## [1] 0.6076268</code></pre>
<p>Our lowest MSE and highest R sqaured value here is provided by Ridge regressionâ€¦so from this analysis iâ€™d select Ridge regression to predict any missing or future values of Airbnbs within the London wardsâ€¦iâ€™d probably also consider exploring using machine learning methods that are linked to belowâ€¦</p>
<blockquote>
<p><strong>Warning</strong> The data used within this practical is purely for demonstration purposes!</p>
</blockquote>
</div>
<div id="what-should-i-use" class="section level3 hasAnchor" number="10.7.7">
<h3><span class="header-section-number">10.7.7</span> What should i use<a href="advanced-r-maup-and-more-regression.html#what-should-i-use" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>It depends, just because Ridge regression seems to be the best for this application, it might not be for yours. Itâ€™s important to check the suitability of each method for both your data and analysis.</p>
</div>
<div id="so-how-do-i-predict" class="section level3 hasAnchor" number="10.7.8">
<h3><span class="header-section-number">10.7.8</span> So how do i predict<a href="advanced-r-maup-and-more-regression.html#so-how-do-i-predict" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Easyâ€¦just go back through the code and use the the <code>predict()</code> function â€” this will also work for linear modelsâ€¦</p>
<div class="sourceCode" id="cb683"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb683-1"><a href="advanced-r-maup-and-more-regression.html#cb683-1" aria-hidden="true" tabindex="-1"></a><span class="co"># replace with your data - this is just an example</span></span>
<span id="cb683-2"><a href="advanced-r-maup-and-more-regression.html#cb683-2" aria-hidden="true" tabindex="-1"></a><span class="co"># setting intervals specifies confidence intervals</span></span>
<span id="cb683-3"><a href="advanced-r-maup-and-more-regression.html#cb683-3" aria-hidden="true" tabindex="-1"></a><span class="co"># at the required level</span></span>
<span id="cb683-4"><a href="advanced-r-maup-and-more-regression.html#cb683-4" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(linearmodel, newdata, <span class="at">interval=</span><span class="st">&quot;confidence&quot;</span>, <span class="at">level=</span><span class="fl">0.95</span>) </span></code></pre></div>
<blockquote>
<p><strong>WARNING</strong> Never try and predict data outside the range of your values, for example in the first regression model we ran when the count within Boroughs was 0 we had -3.8188 for Airbnbs within wards and itâ€™s impossible to have negative Airbnbs.</p>
</blockquote>
</div>
<div id="should-i-write-advanced-code" class="section level3 hasAnchor" number="10.7.9">
<h3><span class="header-section-number">10.7.9</span> Should i write advanced code<a href="advanced-r-maup-and-more-regression.html#should-i-write-advanced-code" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>It would be great if you could write your analysis in as least possible lines of code as possibleâ€¦<strong>BUT</strong> you are not marked on how concise or efficient your code is in this course. My advice would be to get something that works and addresses all of the marking criteria and listen to Hadley Wickhamâ€¦.</p>
<blockquote class="twitter-tweet tw-align-center">
<p lang="en" dir="ltr">
The only way to write good code is to write tons of shitty code first. Feeling shame about bad code stops you from getting to good code
</p>
â€” Hadley Wickham (<span class="citation">(<a href="#ref-hadleywickham" role="doc-biblioref"><strong>hadleywickham?</strong></a>)</span>) <a href="https://twitter.com/hadleywickham/status/589068687669243905?ref_src=twsrc%5Etfw">April 17, 2015</a>
</blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p><br/></p>
</div>
</div>
<div id="more-resources" class="section level2 hasAnchor" number="10.8">
<h2><span class="header-section-number">10.8</span> More resources<a href="advanced-r-maup-and-more-regression.html#more-resources" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=Q81RR3yKn30&amp;t=443s">Ridge regression</a></li>
<li><a href="https://www.youtube.com/watch?v=NGf0voTMlcs&amp;t=351s">LASSO regression</a></li>
<li><a href="https://www.youtube.com/watch?v=1dKRdX9bfIo">Elastic net regression</a></li>
<li><a href="https://www.youtube.com/watch?v=ctmNq7FgbvI">All of them in R</a></li>
<li><a href="https://towardsdatascience.com/how-to-select-the-right-evaluation-metric-for-machine-learning-models-part-1-regrression-metrics-3606e25beae0">Evaluation methods</a></li>
<li><a href="https://ucl-new-primo.hosted.exlibrisgroup.com/primo-explore/fulldisplay?docid=UCL_LMS_DS21130746790004761&amp;context=L&amp;vid=UCL_VU2&amp;lang=en_US&amp;search_scope=CSCOP_UCL&amp;adaptor=Local%20Search%20Engine&amp;tab=local&amp;query=any,contains,An%20introduction%20to%20statistical%20learning:%20with%20applications%20in%20R%20-%20section%20on%20Ridge%20and%20LASSO%20-%20Gareth%20James,%20Daniela%20Witten,%20Trevor%20Hastie,%20Robert%20Tibshirani%20,%202013,%20%C2%A92013&amp;offset=0">An Introduction to Statistical Learning with Applications in R</a></li>
</ul>
</div>
<div id="extension-2" class="section level2 hasAnchor" number="10.9">
<h2><span class="header-section-number">10.9</span> Extension<a href="advanced-r-maup-and-more-regression.html#extension-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>If you are already familiar with these regression methods try the following:</p>
<ul>
<li>Apply them to a dataset of your choice to see if you can predict a specific variable</li>
<li>This <a href="https://supervised-ml-course.netlify.com/">free course by Julia Silge</a> on supversied machine learning is pretty great</li>
<li>Explore and apply machine learning techniques for predicting data such as <a href="https://www.guru99.com/r-random-forest-tutorial.html">Random Forest</a>, <a href="https://machinelearningmastery.com/machine-learning-in-r-step-by-step/">Classification and Regression Trees, Support Vector Machine and others</a></li>
<li>Try out <a href="https://www.r-bloggers.com/fitting-a-model-by-maximum-likelihood/">maximum likelihood</a> for estimating model parameters</li>
<li>Have a look at the <a href="https://rviews.rstudio.com/2019/06/19/a-gentle-intro-to-tidymodels/">new tidymodels package</a></li>
<li>Check out <a href="https://www.youtube.com/watch?v=EuBBz3bI-aA">Machine learning fundamentals</a> too.</li>
</ul>
</div>
<div id="acknowledgement-1" class="section level2 hasAnchor" number="10.10">
<h2><span class="header-section-number">10.10</span> Acknowledgement<a href="advanced-r-maup-and-more-regression.html#acknowledgement-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Iâ€™m certainly not an expert statistician but <a href="https://www.youtube.com/channel/UCtYLUTtgS3k1Fg4y5tAhLbw">StatQuest with Josh Starmer</a> really helped me explain all this.</p>
</div>
<div id="feedback-9" class="section level2 hasAnchor" number="10.11">
<h2><span class="header-section-number">10.11</span> Feedback<a href="advanced-r-maup-and-more-regression.html#feedback-9" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Was anything that we explained unclear this week or was something really clearâ€¦let us know using the <a href="https://forms.gle/w2GUDYc7tSavGy7r6">feedback form</a>. Itâ€™s anonymous and weâ€™ll use the responses to clear any issues up in the future / adapt the material.</p>

</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="gwr-and-spatially-lagged-regression.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="assignment-resources-1.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/andrewmaclachlan/CASA0005repo/edit/master/10-prac10.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["https://github.com/andrewmaclachlan/CASA0005repo/raw/master/10-prac10.Rmd"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
